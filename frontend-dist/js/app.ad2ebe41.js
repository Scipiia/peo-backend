(function(){"use strict";var e={485:function(e,l,t){var a=t(5130),n=t(6768),o=t.p+"img/logo_pasport_new.62978c94.jpg";const u={id:"app"},r={class:"navbar no-print"},s={class:"nav-container"},i={class:"nav-menu"},d={class:"nav-item"},p={class:"nav-item"},c={class:"nav-item"},v={class:"main-content"};function m(e,l,t,a,m,k){const _=(0,n.g2)("router-link"),y=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",u,[(0,n.Lk)("nav",r,[(0,n.Lk)("div",s,[l[3]||(l[3]=(0,n.Lk)("div",{class:"nav-logo"},[(0,n.Lk)("img",{src:o,alt:"Логотип NormApp",class:"logo-img"}),(0,n.Lk)("span")],-1)),(0,n.Lk)("ul",i,[(0,n.Lk)("li",d,[(0,n.bF)(_,{to:"/orders",class:"nav-link"},{default:(0,n.k6)(()=>[...l[0]||(l[0]=[(0,n.eW)("Заказы из ДЕМ",-1)])]),_:1})]),(0,n.Lk)("li",p,[(0,n.bF)(_,{to:"/norm/orders/",class:"nav-link"},{default:(0,n.k6)(()=>[...l[1]||(l[1]=[(0,n.eW)("Нормированные наряды",-1)])]),_:1})]),(0,n.Lk)("li",c,[(0,n.bF)(_,{to:"/final/orders/",class:"nav-link"},{default:(0,n.k6)(()=>[...l[2]||(l[2]=[(0,n.eW)("Отчёты для ПЭО",-1)])]),_:1})])])])]),(0,n.Lk)("main",v,[(0,n.bF)(y)])])}var k={name:"App"},_=t(1241);const y=(0,_.A)(k,[["render",m]]);var L=y,b=t(8728),h=(t(4114),t(4232)),f=t(144),g=t(4373);const C={class:"orders-page"},w={class:"filters"},E=["value"],F={key:0,class:"table-container"},x=["onClick"],X={key:1,class:"error"},V={key:2,class:"no-orders"};var U={__name:"OrdersList",setup(e){const l=(0,b.rd)(),t=(0,f.KR)([]),o=(0,f.KR)(""),u=(0,f.KR)((new Date).getFullYear()),r=(0,f.KR)((new Date).getMonth()+1),s=(0,f.KR)(""),i=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];async function d(){try{t.value=[],o.value="";const e={};s.value?e.search=s.value:(e.year=u.value,e.month=r.value);const l=await g.A.get("/api/orders",{params:e});l.data.error?o.value=l.data.error:t.value=l.data.orders}catch(e){o.value="Не удалось загрузить заказы.",console.error(e)}}function p(e){l.push({name:"OrdersDetails",params:{orderNum:e.order_num}})}return(0,n.sV)(()=>{d()}),(0,n.wB)([u,r,s],()=>{d()}),(e,l)=>((0,n.uX)(),(0,n.CE)("div",C,[l[7]||(l[7]=(0,n.Lk)("h1",null,"Заказы",-1)),(0,n.Lk)("div",w,[(0,n.Lk)("div",null,[l[3]||(l[3]=(0,n.Lk)("label",null,"Год:",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),type:"number",min:"2020",max:"2030"},null,512),[[a.Jo,u.value,void 0,{number:!0}]])]),(0,n.Lk)("div",null,[l[4]||(l[4]=(0,n.Lk)("label",null,"Месяц:",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>r.value=e)},[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(i,(e,l)=>(0,n.Lk)("option",{key:l+1,value:l+1},(0,h.v_)(e),9,E)),64))],512),[[a.u1,r.value]])]),(0,n.Lk)("div",null,[l[5]||(l[5]=(0,n.Lk)("label",null,"Поиск:",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>s.value=e),placeholder:"Поиск по номеру..."},null,512),[[a.Jo,s.value]])])]),t.value&&t.value.length>0?((0,n.uX)(),(0,n.CE)("div",F,[(0,n.Lk)("table",null,[l[6]||(l[6]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Заказ"),(0,n.Lk)("th",null,"Заказчик"),(0,n.Lk)("th",null,"Примечание")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id,onClick:l=>p(e),style:{cursor:"pointer"}},[(0,n.Lk)("td",null,(0,h.v_)(e.order_num),1),(0,n.Lk)("td",null,(0,h.v_)(e.customer),1),(0,n.Lk)("td",null,(0,h.v_)(e.ms_note),1)],8,x))),128))])])])):o.value?((0,n.uX)(),(0,n.CE)("div",X,(0,h.v_)(o.value),1)):((0,n.uX)(),(0,n.CE)("div",V,"Заказы не найдены"))]))}};const z=(0,_.A)(U,[["__scopeId","data-v-cd526f56"]]);var K=z;t(8111),t(2489),t(116),t(7588),t(1701),t(8237),t(9112),t(3110),t(4603),t(7566),t(8721);const I={class:"form-container"},R={class:"card-info"},$={key:0,class:"image-preview-container"},q=["src"],S=["src"],W={class:"composite-toggle"},N={key:1,class:"parent-selection"},T=["value"],j={key:0,class:"text-muted"},J={class:"parent-selection"},O={class:"forms-section"},A={class:"category-title"},P={class:"templates-list"},D=["onClick"],Q={key:2,class:"full-form"},M={class:"part-type-badge"},H={key:0},G={class:"norm-table"},B=["value","onInput"],Y=["value","disabled","onInput"],Z={class:"text-center"},ee={class:"custom-operations-input"},le={class:"norm-table"},te=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],ne={class:"text-center"},oe=["onClick"],ue={class:"total-summary"},re={key:0,class:"calculation-info"},se={class:"form-actions"},ie=["disabled"],de=["disabled"];var pe={__name:"FormSendPeo",setup(e){const l=(0,b.lq)(),t=`orderDetail_${l.params.orderNum}_${l.params.position}`,o=(0,f.KR)({order_num:"Неизвестно",name:"Неизвестно",count:0,color:"Не указан",image:"",sqr:0,position:"",customer:""});(0,n.sV)(()=>{const e=sessionStorage.getItem(t);if(e)try{const l=JSON.parse(e);return void(o.value={...l})}catch(u){console.error("Ошибка парсинга данных из sessionStorage:",u)}const a={order_num:l.query.orderNum||"Неизвестно",name:l.query.name||"Неизвестно",count:parseInt(l.query.count)||1,color:l.query.color||"Не указан",customer:l.query.customer||"Не указан",sqr:parseFloat(l.query.sqr)||0,position:l.query.position||"",image:l.query.image||""};sessionStorage.setItem(t,JSON.stringify(a)),o.value=a;const n={...l.query};delete n.image,window.history.replaceState({},"",`${location.pathname}?${new URLSearchParams(n).toString()}`)});const u=(0,f.KR)([]),r=(0,f.KR)(null),s=(0,f.KR)(!1),i=(0,f.KR)(!1),d=(0,f.KR)(!1),p=(0,f.KR)(null),c=(0,f.KR)([]),v=(0,f.KR)(null),m=(0,f.KR)(null),k=(0,f.KR)(!1),_=(0,f.KR)(""),y=(0,f.KR)(""),L={window:"Окна",glyhar:"Глухари",door:"Двери",loggia:"Лоджии",vitrage:"Витражи"};(0,n.wB)(d,async e=>{if(e&&o.value.order_num)try{const e=await fetch(`/api/orders/order-norm/by-order?order_num=${o.value.order_num}`);if(e.ok){const l=await e.json();c.value=l.filter(e=>"main"===e.part_type)}else c.value=[]}catch(l){console.error("Ошибка загрузки родителей:",l),c.value=[]}else p.value=null});const g=(0,n.EW)(()=>{const e={},l=Object.keys(L);return l.forEach(l=>{e[l]=[]}),u.value?.Template?.forEach(t=>{const a=t.category?.toLowerCase().trim();l.includes(a)&&e[a].push(t)}),Object.keys(e).forEach(l=>{0===e[l].length&&delete e[l]}),e});(0,n.sV)(async()=>{try{const e=await fetch("/api/all_templates");if(!e.ok)throw new Error("Не удалось загрузить шаблоны");u.value=await e.json()}catch(e){console.error("Ошибка загрузки шаблонов:",e),alert("Не удалось загрузить шаблоны. Проверьте подключение.")}});const C=(0,n.EW)(()=>{const e=r.value?.operations?.reduce((e,l)=>"number"===typeof l.dynamicValue?e+l.dynamicValue:e,0)||0,l=K.value.reduce((e,l)=>{if(!l.name?.trim())return e;const t=l.minutes/60||0;return e+t},0);return(e+l).toFixed(3)}),w=(0,n.EW)(()=>Math.round(60*parseFloat(C.value)));function E(e,l){const t=parseFloat(l);if(isNaN(t))return;const a=r.value.operations[e];a.dynamicValue=t,a.count>0?a.rate=t/a.count:a.rate=t,a.minutes=Number(60*a.dynamicValue).toFixed(1)}function F(e,l){const t=parseFloat(l);if(isNaN(t))return;const a=r.value.operations[e];a.count=t;const n=a.group;if(!n)return a.dynamicValue=t*a.rate,void(a.minutes=parseFloat((60*a.dynamicValue).toFixed(1)));const o=r.value.operations.filter(e=>e.group===n);o.forEach(e=>{e.count=t,e.dynamicValue=t*e.rate,e.minutes=parseFloat((60*e.dynamicValue).toFixed(1))})}function x(){const e=parseInt(o.value?.count)||1;r.value?.operations&&r.value.operations.forEach(l=>{if(l.group&&["ign"].includes(l.group))return void(l.count=1);const t=l.count;l.count=t*e,l.dynamicValue=l.count*l.rate,l.minutes=parseFloat((60*l.dynamicValue).toFixed(1))})}async function X(e){s.value=!0;try{const l=await fetch(`/api/template?code=${e.code}`);if(!l.ok)throw new Error("Не удалось загрузить форму");r.value=await l.json(),r.value.type=e.category,r.value.code=e.code,d.value&&p.value?(r.value.part_type="sub",r.value.parent_product_id=p.value):(r.value.part_type="main",r.value.parent_product_id=null),r.value.operations=r.value.operations.map(e=>({...e,count:e.count??0,baseValue:e.value??0,rate:e.value??0,dynamicValue:(e.count??0)*(e.value??0)}));const t={};r.value.operations.forEach(e=>{e.group&&(t[e.group]=t[e.group]||[],t[e.group].push(e))}),r.value.operationsByGroup=t,m.value=e.code}catch(l){console.error("Ошибка загрузки формы:",l),alert("Не удалось загрузить форму. Попробуйте снова.")}finally{s.value=!1}}function V(){const e=r.value.operations.filter(e=>"number"===typeof e.dynamicValue&&e.dynamicValue>0).map(e=>({operation_name:e.name,operation_label:e.label,count:parseFloat(e.count),value:parseFloat(e.dynamicValue.toFixed(3)),minutes:parseFloat(e.minutes)})),l=ve.value.map(e=>({operation_name:e.operation_name,operation_label:e.operation_label,count:e.count,value:parseFloat(e.value.toFixed(3)),minutes:e.minutes})),a=[...e,...l],n=a.reduce((e,l)=>e+l.value,0),u={order_num:o.value.order_num,name:o.value.name,template_code:r.value.code,count:o.value.count,type:r.value.type,part_type:r.value.part_type,parent_product_id:r.value.parent_product_id,parent_assembly:_.value,total_time:parseFloat(n.toFixed(3)),position:parseInt(o.value.position),customer:o.value.customer,operations:a,status:"in_production",systema:r.value.systema,type_izd:y.value||r.value.type_izd,profile:r.value.profile,sqr:parseFloat(o.value.sqr)};fetch("/api/orders/order-norm/template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then(e=>e.json()).then(e=>{if(!e.order_id)return void console.warn("Ошибка: не получен ID наряда",e.order_id);let l;"main"===r.value.part_type?(l=e.order_id,v.value=l):(l=v.value,l||(console.warn("lastRootId не установлен, используем текущий ID"),l=e.order_id));const a=confirm(`Нормировка "${r.value.name}" сохранена!\n\nХотите добавить ещё одну часть?`);if(a)r.value=null;else{const l="main"===r.value.part_type?e.order_id:v.value||e.order_id;Ba.push({name:"FormPrintNorm",params:{id:l,orderNum:o.value.order_num}}),i.value=!0,setTimeout(()=>{sessionStorage.removeItem(t)},5e4)}}).catch(e=>{console.error("Ошибка сохранения:",e),alert("Не удалось сохранить нормировку")})}const U=(0,f.KR)(null);async function z(){if(r.value&&o.value.order_num&&o.value.position){s.value=!0;try{const e=r.value.type,l=await fetch("/api/materials/calculation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_num:o.value.order_num,position:parseInt(o.value.position),type:e,template:r.value.code,count:parseInt(o.value.count)})});if(!l.ok){const e=await l.text();throw new Error(`Ошибка расчёта: ${l.status} — ${e}`)}const t=await l.json();U.value=t.context;const a=r.value.operations.map(e=>{const l=t.operation.find(l=>l.name===e.name);return l?{...e,count:l.count??e.count,dynamicValue:l.value??e.dynamicValue,minutes:l.minutes??e.minutes}:e});a.forEach(e=>{e.count>0?e.rate=e.dynamicValue/e.count:e.rate=e.dynamicValue}),r.value.operations=a;const n=a.reduce((e,l)=>e+l.dynamicValue,0);r.value.total_time=parseFloat(n.toFixed(3))}catch(e){console.error("Ошибка автоматического расчёта:",e),alert(`Не удалось рассчитать нормы: ${e.message}`)}finally{s.value=!1}}else alert("Недостаточно данных для расчёта")}const K=(0,f.KR)([{name:"",minutes:0,count:1}]);function pe(){K.value.push({name:"",minutes:0,count:1})}function ce(e){K.value.length<=1?K.value[e]={name:"",minutes:0,count:1}:K.value.splice(e,1)}const ve=(0,n.EW)(()=>K.value.filter(e=>e.name.trim()).map(e=>{const l=parseFloat(e.minutes)||0,t=l/60;return{operation_name:`custom_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,operation_label:e.name.trim(),count:1,value:parseFloat(t.toFixed(3)),minutes:parseFloat(l.toFixed(3))}}));return(e,l)=>((0,n.uX)(),(0,n.CE)("div",I,[(0,n.Lk)("h2",null,"Форма нормировки — изделие «"+(0,h.v_)(o.value.name)+"»",1),(0,n.Lk)("div",R,[(0,n.Lk)("p",null,[l[9]||(l[9]=(0,n.Lk)("strong",null,"Номер заказа:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value.order_num),1)]),(0,n.Lk)("p",null,[l[10]||(l[10]=(0,n.Lk)("strong",null,"Позиция:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value.position),1)]),(0,n.Lk)("p",null,[l[11]||(l[11]=(0,n.Lk)("strong",null,"Количество:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value.count),1)]),(0,n.Lk)("p",null,[l[12]||(l[12]=(0,n.Lk)("strong",null,"Цвет:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value.color),1)]),(0,n.Lk)("p",null,[l[13]||(l[13]=(0,n.Lk)("strong",null,"Площадь:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value.sqr)+" м²",1)]),(0,n.Lk)("p",null,[l[14]||(l[14]=(0,n.Lk)("strong",null,"Заказчик:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value.customer),1)]),o.value.image?((0,n.uX)(),(0,n.CE)("div",$,[(0,n.Lk)("img",{src:`data:image/png;base64,${o.value.image}`,alt:"Изображение заказа",class:"order-image clickable",onClick:l[0]||(l[0]=e=>k.value=!0),title:"Нажмите, чтобы увеличить"},null,8,q)])):(0,n.Q3)("",!0)]),k.value?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"image-modal",onClick:l[3]||(l[3]=e=>k.value=!1)},[(0,n.Lk)("div",{class:"modal-content",onClick:l[2]||(l[2]=(0,a.D$)(()=>{},["stop"]))},[(0,n.Lk)("img",{src:`data:image/png;base64,${o.value.image}`,alt:"Увеличенное изображение",class:"enlarged-image"},null,8,S),(0,n.Lk)("button",{class:"close-btn",onClick:l[1]||(l[1]=e=>k.value=!1)},"×")])])):(0,n.Q3)("",!0),(0,n.Lk)("div",W,[(0,n.Lk)("label",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=e=>d.value=e)},null,512),[[a.lH,d.value]]),l[15]||(l[15]=(0,n.eW)(" Это составная часть (витраж к двери(двери с глухарем) и тп) ",-1))])]),d.value?((0,n.uX)(),(0,n.CE)("div",N,[l[21]||(l[21]=(0,n.Lk)("label",null,[(0,n.Lk)("strong",null,"Привязать к:")],-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[5]||(l[5]=e=>p.value=e),class:"form-control",required:""},[l[16]||(l[16]=(0,n.Lk)("option",{value:"",disabled:""},"Выберите основное изделие...",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,e=>((0,n.uX)(),(0,n.CE)("option",{key:e.id,value:e.id},(0,h.v_)(e.name),9,T))),128))],512),[[a.u1,p.value]]),0===c.value.length?((0,n.uX)(),(0,n.CE)("p",j," Нет доступных основных изделий. Сначала добавьте основное (дверь, окно и т.п.). ")):(0,n.Q3)("",!0),(0,n.Lk)("div",J,[l[19]||(l[19]=(0,n.Lk)("label",{class:"form-control"},[(0,n.Lk)("strong",null,"Уточнение для части:")],-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[6]||(l[6]=e=>_.value=e),class:"form-custom-select"},[...l[17]||(l[17]=[(0,n.Lk)("option",{value:""},"— выберите —",-1),(0,n.Lk)("option",{value:"с глухарем"},"с глухарем",-1)])],512),[[a.u1,_.value]]),l[20]||(l[20]=(0,n.Lk)("label",{class:"form-control"},[(0,n.Lk)("strong",null,"Наименование:")],-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[7]||(l[7]=e=>y.value=e),class:"form-custom-select"},[...l[18]||(l[18]=[(0,n.Lk)("option",{value:""},"— выберите —",-1),(0,n.Lk)("option",{value:"витраж к двери"},"витраж к двери",-1)])],512),[[a.u1,y.value]])])])):(0,n.Q3)("",!0),(0,n.Lk)("div",O,[l[22]||(l[22]=(0,n.Lk)("h4",null,"Выберите тип изделия",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(g.value,(e,l)=>((0,n.uX)(),(0,n.CE)("div",{key:l,class:"category-group"},[(0,n.Lk)("h5",A,(0,h.v_)(L[l]),1),(0,n.Lk)("ul",P,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e,e=>((0,n.uX)(),(0,n.CE)("li",{key:e.code,onClick:l=>X(e),class:(0,h.C4)(["template-item",{selected:m.value===e.code}])},(0,h.v_)(e.name),11,D))),128))])]))),128))]),r.value?((0,n.uX)(),(0,n.CE)("div",Q,[(0,n.Lk)("h3",null,(0,h.v_)(r.value.name),1),(0,n.Lk)("div",M,[l[23]||(l[23]=(0,n.eW)(" Тип: ",-1)),(0,n.Lk)("strong",null,(0,h.v_)("main"===r.value.part_type?"Основное изделие":"Составная часть"),1),r.value.parent_product_id?((0,n.uX)(),(0,n.CE)("span",H," (привязано к наряду ID="+(0,h.v_)(r.value.parent_product_id)+") ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("table",G,[l[24]||(l[24]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Операция"),(0,n.Lk)("th",null,"Норма (ч)"),(0,n.Lk)("th",null,"Кол-во"),(0,n.Lk)("th",null,"Норма (мин)")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.value.operations,(e,l)=>((0,n.uX)(),(0,n.CE)("tr",{key:e.name},[(0,n.Lk)("td",null,(0,h.v_)(e.label),1),(0,n.Lk)("td",null,[(0,n.Lk)("input",{type:"number",step:"0.01",min:"0",value:e.dynamicValue,class:"input-small",onInput:e=>E(l,e.target.value)},null,40,B)]),(0,n.Lk)("td",null,[(0,n.Lk)("input",{type:"number",step:"1",min:"0",value:e.count,class:"input-small",disabled:"ign"===e.group,onInput:e=>F(l,e.target.value)},null,40,Y)]),(0,n.Lk)("td",Z,(0,h.v_)(e.minutes),1)]))),128))])]),(0,n.Lk)("div",ee,[l[26]||(l[26]=(0,n.Lk)("h4",null,"Дополнительные операции",-1)),(0,n.Lk)("table",le,[l[25]||(l[25]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Название операции"),(0,n.Lk)("th",null,"Норма(мин)"),(0,n.Lk)("th",null,"Норма(ч)"),(0,n.Lk)("th",{style:{width:"40px"}})])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(K.value,(e,l)=>((0,n.uX)(),(0,n.CE)("tr",{key:l},[(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.name=l,type:"text",placeholder:"Название",class:"input-small wide"},null,8,te),[[a.Jo,e.name]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.minutes=l,type:"number",step:"0.001",min:"0",class:"input-small"},null,8,ae),[[a.Jo,e.minutes,void 0,{number:!0}]])]),(0,n.Lk)("td",ne,(0,h.v_)(((e.minutes||0)/60).toFixed(3)),1),(0,n.Lk)("td",null,[K.value.length>1?((0,n.uX)(),(0,n.CE)("button",{key:0,type:"button",class:"btn-remove",onClick:e=>ce(l),title:"Удалить"}," − ",8,oe)):(0,n.Q3)("",!0)])]))),128))])]),(0,n.Lk)("button",{type:"button",class:"btn-add-row",onClick:pe}," Добавить операцию ")]),(0,n.Lk)("div",ue,[l[27]||(l[27]=(0,n.Lk)("strong",null,"Итоговое время:",-1)),(0,n.eW)(" "+(0,h.v_)(C.value)+" ч ("+(0,h.v_)(w.value)+" мин) ",1)]),U.value?((0,n.uX)(),(0,n.CE)("div",re,[(0,n.Lk)("small",null,"Импостов в материалах найдено: "+(0,h.v_)(U.value.ImpostCount),1),(0,n.Lk)("small",null,"Створок меньше 400мм в материалах найдено: "+(0,h.v_)(U.value.StvTCount400),1),(0,n.Lk)("small",null,"Створок меньше 615мм в материалах найдено: "+(0,h.v_)(U.value.StvTCount600),1),(0,n.Lk)("small",null,"Многозапорных замков найдено: "+(0,h.v_)(U.value.MnogozapZamok),1),(0,n.Lk)("small",null,"Tрёхсекционных петель найдено: "+(0,h.v_)(U.value.Petli3Section),1),(0,n.Lk)("small",null,"Трёхчастных петель найдено: "+(0,h.v_)(U.value.StvorkiWith3Petli),1),(0,n.Lk)("small",null,"Роликовых петель найдено: "+(0,h.v_)(U.value.PetliRolik),1),(0,n.Lk)("small",null,"Обычных петель найдено: "+(0,h.v_)(U.value.PetliStand),1),(0,n.Lk)("small",null,"RDRH петель найдено: "+(0,h.v_)(U.value.PetliRDRH),1),(0,n.Lk)("small",null,"Fural петель найдено: "+(0,h.v_)(U.value.PetliFural),1),(0,n.Lk)("small",null,"Притвор: "+(0,h.v_)(U.value.PritvorKP40),1),(0,n.Lk)("small",null,"Накладок stublina найдено: "+(0,h.v_)(U.value.StublinaCount),1)])):(0,n.Q3)("",!0),(0,n.Lk)("div",se,[(0,n.Lk)("button",{type:"button",class:"multiply-count-btn",onClick:l[8]||(l[8]=e=>x())}," Умножить на кол-во изделий ("+(0,h.v_)(o.value.count)+") ",1),(0,n.Lk)("button",{type:"button",onClick:z,disabled:!m.value||s.value,class:"btn-recalculate"}," Рассчитать нормы по материалам ",8,ie),(0,n.Lk)("button",{onClick:V,disabled:s.value,class:"btn-save"},(0,h.v_)(s.value?"Сохраняем...":"Сохранить нормировку"),9,de)])])):(0,n.Q3)("",!0)]))}};const ce=(0,_.A)(pe,[["__scopeId","data-v-b90be7e2"]]);var ve=ce;const me={key:0},ke={key:1,class:"error"},_e={key:2},ye={class:"plans-container"},Le=["onClick"],be=["src"],he={class:"plan-details"},fe={key:3};var ge={__name:"OrdersDetails",setup(e){const l=(0,b.lq)(),t=(0,b.rd)(),a=(0,f.KR)(!0),o=(0,f.KR)(null),u=(0,f.KR)([]),r=(0,f.KR)(""),s=l.params.orderNum;async function i(){try{const e=await g.A.get(`/api/orders/order/${s}`);u.value=e.data,u.value.length>0&&(r.value=u.value[0].order_num)}catch(e){console.error("Ошибка при получении деталей заказа:",e),o.value="Не удалось загрузить детали заказа."}finally{a.value=!1}}function d(){t.go(-1)}function p(e){const l={order_num:e.order_num,name:e.name_position,count:e.count,color:e.color,sqr:e.sqr,image:e.image,position:e.position,customer:e.customer},a=`orderDetail_${e.order_num}_${e.position}`;sessionStorage.setItem(a,JSON.stringify(l)),t.push({name:"FormSendPeo",params:{orderNum:e.order_num,position:e.position.toString()},query:{fromStorage:"true"}})}return(0,n.sV)(()=>{i()}),(e,l)=>((0,n.uX)(),(0,n.CE)("div",null,[l[10]||(l[10]=(0,n.Lk)("h2",null,"Детали коммерческого приложения",-1)),a.value?((0,n.uX)(),(0,n.CE)("div",me,[...l[0]||(l[0]=[(0,n.Lk)("p",null,"Loading...",-1)])])):o.value?((0,n.uX)(),(0,n.CE)("div",ke,[(0,n.Lk)("p",null,(0,h.v_)(o.value),1)])):u.value?((0,n.uX)(),(0,n.CE)("div",_e,[(0,n.Lk)("p",null,[l[1]||(l[1]=(0,n.Lk)("strong",null,"Номер заказа:",-1)),(0,n.eW)(" "+(0,h.v_)(r.value),1)]),(0,n.Lk)("div",null,[l[8]||(l[8]=(0,n.Lk)("h1",null,"Изделия",-1)),(0,n.Lk)("div",ye,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(u.value,(e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,onClick:l=>p(e),class:"plan-item"},[(0,n.Lk)("img",{src:`data:image/png;base64,${e.image}`,width:"120",alt:"Order Image"},null,8,be),(0,n.Lk)("div",he,[(0,n.Lk)("p",null,[l[2]||(l[2]=(0,n.Lk)("strong",null,"Позиция:",-1)),(0,n.eW)(" "+(0,h.v_)(e.position),1)]),(0,n.Lk)("p",null,[l[3]||(l[3]=(0,n.Lk)("strong",null,"Название:",-1)),(0,n.eW)(" "+(0,h.v_)(e.name_position),1)]),(0,n.Lk)("p",null,[l[4]||(l[4]=(0,n.Lk)("strong",null,"Количество:",-1)),(0,n.eW)(" "+(0,h.v_)(e.count),1)]),(0,n.Lk)("p",null,[l[5]||(l[5]=(0,n.Lk)("strong",null,"Цвет:",-1)),(0,n.eW)(" "+(0,h.v_)(e.color),1)]),(0,n.Lk)("p",null,[l[6]||(l[6]=(0,n.Lk)("strong",null,"Площадь:",-1)),(0,n.eW)(" "+(0,h.v_)(e.sqr),1)]),(0,n.Lk)("p",null,[l[7]||(l[7]=(0,n.Lk)("strong",null,"Заказчик:",-1)),(0,n.eW)(" "+(0,h.v_)(e.customer),1)])])],8,Le))),128))])]),(0,n.Lk)("button",{onClick:d},"Назад")])):((0,n.uX)(),(0,n.CE)("div",fe,[...l[9]||(l[9]=[(0,n.Lk)("p",null,"Детали заказа не найдены",-1)])]))]))}};const Ce=(0,_.A)(ge,[["__scopeId","data-v-46610b48"]]);var we=Ce;t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);const Ee={class:"additional-ops"},Fe={class:"operations-table"};function xe(e,l){return(0,n.uX)(),(0,n.CE)("div",Ee,[l[3]||(l[3]=(0,n.Lk)("h3",{class:"additional-ops-label"},[(0,n.Lk)("label",null,"Доп работы")],-1)),(0,n.Lk)("table",Fe,[l[2]||(l[2]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",{width:"40%"},"Операция"),(0,n.Lk)("th",{width:"10%"},"Норма н/час"),(0,n.Lk)("th",{width:"10%"},"Норма н/мин"),(0,n.Lk)("th",null,"ФИО исполнителя")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(3,e=>(0,n.Lk)("tr",{key:e},[...l[0]||(l[0]=[(0,n.Lk)("td",null," ",-1),(0,n.Lk)("td",null," ",-1),(0,n.Lk)("td",null," ",-1),(0,n.Lk)("td",null," ",-1)])])),64)),l[1]||(l[1]=(0,n.Lk)("tr",{class:"total-row"},[(0,n.Lk)("td",{colspan:"3",class:"text-right"},[(0,n.Lk)("strong",null,"Итого доп. работ:")]),(0,n.Lk)("td")],-1))])])])}const Xe={},Ve=(0,_.A)(Xe,[["render",xe],["__scopeId","data-v-cb0b450e"]]);var Ue=Ve;const ze={class:"print-container"},Ke={key:0,class:"print-layout"},Ie={class:"print-page main-page"},Re={class:"header"},$e={class:"operations-table"},qe=["rowspan"],Se={class:"total-row",style:{"background-color":"#eee","font-weight":"bold","font-size":"1.1em"}},We={class:"header"},Ne={class:"operations-table"},Te=["rowspan"],je={class:"total-row",style:{"background-color":"#eee","font-weight":"bold","font-size":"1.1em"}},Je={class:"print-controls"},Oe=["disabled"],Ae={key:1,class:"loading"},Pe={key:2,class:"error"};var De={__name:"PrintNormOrder",setup(e){const l=(0,b.lq)(),t=(0,b.rd)(),a=(0,f.KR)(null),o=(0,f.KR)(!0);function u(){const e=l.query.order_num||a.value?.main?.order_num;e?t.push({name:"OrdersDetails",params:{orderNum:e}}):t.go(-2)}(0,n.sV)(async()=>{const e=l.params.id;if(e)try{const l=await fetch(`/api/orders/order-norm/${e}`);if(!l.ok)throw new Error(`Ошибка загрузки элемента: ${l.status}`);const t=await l.json(),n=Array.isArray(t)?t[0]:t;let o;o="main"===n.part_type?e:n.parent_product_id?n.parent_product_id:e;const u=await fetch(`/api/orders/order-norm/${o}`);if(!u.ok)throw new Error(`Не удалось загрузить сборку: ${u.status}`);const r=await u.json();let s;if(Array.isArray(r))s=r;else{if(!r||"object"!==typeof r)throw new Error("Некорректные данные");s=[r]}const i=s.find(e=>"main"===e.part_type),d=s.filter(e=>"sub"===e.part_type),p=i||(s.length>0?s[0]:null);if(!p)throw new Error("Нет данных для отображения");a.value={main:p,subs:d}}catch(t){console.error("Ошибка загрузки:",t)}finally{o.value=!1}else alert("Не указан ID")});const r=(0,f.KR)(!1),s=()=>{i(a.value.main)},i=async e=>{if(e){r.value=!0;try{const l=await g.A.post("/api/orders/cancel",{root_product_id:e.id});if(200!==l.status)throw new Error("API вернул неожиданный статус");e.status="cancel",alert("Заказ успешно отменён.")}catch(l){console.error("Ошибка при отмене заказа:",l);let e="Не удалось отменить заказ.";l.response?.data?.message&&(e+="\n"+l.response.data.message),alert(e)}finally{r.value=!1}}};function d(){const e=document.querySelector(".print-layout");if(!e)return void alert("Нет данных для печати");const l=e.cloneNode(!0),t=l.querySelector(".print-controls");t&&t.remove();const a=l.innerHTML,n=`\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <title>Технологический процесс</title>\n        <style>\n          body {\n            font-family: 'Segoe UI', Arial, sans-serif;\n            font-size: 13px;\n            line-height: 1.4;\n            padding: 15px;\n            margin: 0;\n            color: #000;\n            background: #fff;\n            -webkit-print-color-adjust: exact;\n            print-color-adjust: exact;\n            width: 210mm;\n            margin: 0 auto;\n          }\n          .print-page {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            margin-bottom: 12px;\n          }\n          .header p {\n            margin: 2px 0;\n            line-height: 1.2;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 4px 0;\n            font-size: 12px;\n          }\n          th, td {\n            border: 1px solid #000;\n            padding: 4px 6px;\n            text-align: left;\n          }\n          th {\n            background-color: #f2f2f2;\n            font-weight: bold;\n          }\n          .total-row {\n            background-color: #f9f9f9;\n            font-weight: bold;\n          }\n          .additional-ops {\n            margin-top: 6px;\n            break-inside: avoid;\n            page-break-inside: avoid;\n          }\n          @media print {\n            @page {\n              margin: 1cm;\n              size: A4 portrait;\n            }\n            body {\n              -webkit-print-color-adjust: exact;\n            }\n          }\n        </style>\n      </head>\n      <body onload="window.focus(); window.print();">\n        <div class="print-container">\n          ${a}\n        </div>\n      </body>\n    </html>\n  `,o=window.open("about:blank","_blank","width=1000,height=800,scrollbars=yes");if(o)try{o.document.open(),o.document.write(n),o.document.close(),setTimeout(()=>{o.closed||o.focus()},250)}catch(u){console.error("Ошибка подготовки документа к печати:",u),alert("⚠️ Не удалось подготовить документ к печати. Попробуйте обновить страницу или использовать комбинацию Ctrl+P."),o.closed||o.close()}else alert("❌ Окно печати заблокировано. Разрешите всплывающие окна в настройках браузера и повторите попытку.")}const p=[{title:"Напиловка",names:["nastr_for_napil","napil_bez_impost","nastr_pbx","pzr","rabota_pbx","podg_obor","napil_ram_stv","napil_don_soed","napil_shtylp","impost_napil","nastr_pbx_vo","meh_obr_pzr","rab_pbx_vo2","frez_yst_shtylp_win","obr_stv","napil_donn","napil_shtylp","yst_adapt24","napil_adapt24","obr_ram_vo2","napil_ugol","napil","nastr_obr_napil","napil_kontyr","napil_krishek","napil_stoik_do3m","napil_ygol_30x30","napil_rigel_do1m","napil_rigel_bol1m","napil_stoik_bol3m"]},{title:"Фрезеровка",names:["frezer_nastr","frezer_porog_sverl_promej_sbor","opres_nastr","opres","frezer_porog_promej_sbor","frez_yst_shtylp_door","frezer_porog_ram_porog_shping_promej_sb","sles_obr_yst_furn","promej_sb_stv","promej_sb_ram","imp_frezer","impost_sverlo","impost_yst","impost_frezer","razm_sverl_otv","promej_sb","imp_sbor","shtift","yst_yplotn","promej_sb2","promej_sb_2ygl","promej_sb_2ygl_nest","frezer_std_prof","yst_zamkov","promej_sb_3ygl_nest","frezer2st_5nastr","opres_4ygl","sverl_rigel_zamok_2stor_frezer"]},{title:"Установка",names:["yst_porog_ypl_derj_shetk_shtift","podg_derj_shetki","yst_porog_ypl_derj_shetk_ydal_germ_yst_zaglysh","yst_porog_ypl_derj_shetk","yst_ypl","yst_ypl_ugl_shtift","yst_zpl_podg_shtapik"]},{title:"Обработка и сборка замки",names:["sbor_petli","yst_dver_mnogozap_zamok_nakl_cilindr_stubl_yst_otv_plan23","yst_dvr_zamok_nakl_cild_antipan","navesh_stv_yst_otv_plan1_reg_petli","navesh_stv_yst_otvplan_petl_rdrh","yst_dver_zamok_nakl_cilindr","navesh_stv_yst_otv_plan","yst_dver_zamok_nakl_cilindr_stubl","navesh_stv_yst_otv_plank_reg_petli","napil_tag_stv","obr_tag_stv","podg_furn","yst_furn_stv","navesh_ram_stv","sbor_rychek","rybka_tag","podg_tag_yst_stv"]},{title:"Уплотнители",names:["yst_zapoln","ypl_falc","yst_ypl_falc","zashivka_stv"]}],c=e=>{if(!e)return[];const l=new Set,t=[];p.forEach(a=>{const n=e.filter(e=>a.names.includes(e.operation_name));n.length>0&&(t.push({title:a.title,items:n,totalValue:n.reduce((e,l)=>e+(l.value||0),0),totalMinutes:n.reduce((e,l)=>e+(l.minutes||0),0)}),a.names.forEach(e=>l.add(e)))});const a=e.filter(e=>!l.has(e.operation_name));return a.length>0&&t.push({title:"Прочие операции",items:a,totalValue:a.reduce((e,l)=>e+(l.value||0),0),totalMinutes:a.reduce((e,l)=>e+(l.minutes||0),0)}),t};return(e,l)=>((0,n.uX)(),(0,n.CE)("div",ze,[a.value?((0,n.uX)(),(0,n.CE)("div",Ke,[(0,n.Lk)("div",Ie,[(0,n.Lk)("div",Re,[(0,n.Lk)("p",null,"Пооперационный технологический процесс "+(0,h.v_)(a.value.main.head_name),1),(0,n.Lk)("p",null,[l[0]||(l[0]=(0,n.Lk)("strong",null,"Номер заказа:",-1)),(0,n.eW)(" "+(0,h.v_)(a.value.main.order_num)+", ",1),l[1]||(l[1]=(0,n.Lk)("strong",null,"Позиция:",-1)),(0,n.eW)(" "+(0,h.v_)(a.value.main.position),1)]),(0,n.Lk)("p",null,[l[2]||(l[2]=(0,n.Lk)("strong",null,"Количество:",-1)),(0,n.eW)(" "+(0,h.v_)(a.value.main.count),1)]),(0,n.Lk)("table",$e,[l[6]||(l[6]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",{width:"40%"},"Операция"),(0,n.Lk)("th",{width:"5%"},[(0,n.eW)("Итого "),(0,n.Lk)("br"),(0,n.eW)(" н/час")]),(0,n.Lk)("th",{width:"5%"},[(0,n.eW)("Итого "),(0,n.Lk)("br"),(0,n.eW)(" н/мин")]),(0,n.Lk)("th",{width:"40%"},"ФИО исполнителя"),(0,n.Lk)("th",{width:"10%"})])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c(a.value.main.operations),e=>((0,n.uX)(),(0,n.CE)(n.FK,{key:e.title},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.items,(t,a)=>((0,n.uX)(),(0,n.CE)("tr",{key:t.operation_name},[(0,n.Lk)("td",null,(0,h.v_)(t.operation_label),1),(0,n.Lk)("td",null,(0,h.v_)(t.value.toFixed(3)),1),(0,n.Lk)("td",null,(0,h.v_)(t.minutes),1),l[3]||(l[3]=(0,n.Lk)("td",null,null,-1)),0===a?((0,n.uX)(),(0,n.CE)("td",{key:0,rowspan:e.items.length,style:{"vertical-align":"middle","text-align":"center","font-weight":"bold",background:"#fff","border-left":"2px solid #000","border-bottom":"2px solid #000"}},[(0,n.eW)((0,h.v_)(e.totalValue.toFixed(3))+" ",1),(0,n.Lk)("small",null,"("+(0,h.v_)(e.totalMinutes.toFixed(1))+" мин)",1)],8,qe)):(0,n.Q3)("",!0)]))),128))],64))),128)),(0,n.Lk)("tr",Se,[l[4]||(l[4]=(0,n.Lk)("td",{class:"text-right"},null,-1)),(0,n.Lk)("td",null,(0,h.v_)(a.value.main.total_time.toFixed(3)),1),(0,n.Lk)("td",null,(0,h.v_)(Math.round(60*a.value.main.total_time)),1),l[5]||(l[5]=(0,n.Lk)("td",null,null,-1))])])]),(0,n.bF)(Ue)])]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.value.subs,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"print-page sub-page"},[(0,n.Lk)("div",We,[(0,n.Lk)("p",null,"Пооперационный технологический процесс "+(0,h.v_)(e.head_name),1),(0,n.Lk)("p",null,[l[7]||(l[7]=(0,n.Lk)("strong",null,"Номер заказа:",-1)),(0,n.eW)(" "+(0,h.v_)(e.order_num)+", ",1),l[8]||(l[8]=(0,n.Lk)("strong",null,"Позиция:",-1)),(0,n.eW)(" "+(0,h.v_)(a.value.main.position),1)]),(0,n.Lk)("p",null,[l[9]||(l[9]=(0,n.Lk)("strong",null,"Количество:",-1)),(0,n.eW)(" "+(0,h.v_)(e.count),1)]),(0,n.Lk)("table",Ne,[l[13]||(l[13]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",{width:"40%"},"Операция"),(0,n.Lk)("th",{width:"5%"},[(0,n.eW)("Итого "),(0,n.Lk)("br"),(0,n.eW)(" н/час")]),(0,n.Lk)("th",{width:"5%"},[(0,n.eW)("Итого "),(0,n.Lk)("br"),(0,n.eW)(" н/мин")]),(0,n.Lk)("th",{width:"40%"},"ФИО исполнителя"),(0,n.Lk)("th",{width:"10%"})])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c(e.operations),e=>((0,n.uX)(),(0,n.CE)(n.FK,{key:e.title},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.items,(t,a)=>((0,n.uX)(),(0,n.CE)("tr",{key:t.operation_name},[(0,n.Lk)("td",null,(0,h.v_)(t.operation_label),1),(0,n.Lk)("td",null,(0,h.v_)(t.value.toFixed(3)),1),(0,n.Lk)("td",null,(0,h.v_)(t.minutes),1),l[10]||(l[10]=(0,n.Lk)("td",null,null,-1)),0===a?((0,n.uX)(),(0,n.CE)("td",{key:0,rowspan:e.items.length,style:{"vertical-align":"middle","text-align":"center","font-weight":"bold",background:"#fff","border-left":"2px solid #000","border-bottom":"2px solid #000"}},[(0,n.eW)((0,h.v_)(e.totalValue.toFixed(3))+" ",1),(0,n.Lk)("small",null,"("+(0,h.v_)(e.totalMinutes.toFixed(1))+" мин)",1)],8,Te)):(0,n.Q3)("",!0)]))),128))],64))),128)),(0,n.Lk)("tr",je,[l[11]||(l[11]=(0,n.Lk)("td",{class:"text-right"},null,-1)),(0,n.Lk)("td",null,(0,h.v_)(a.value.main.total_time.toFixed(3)),1),(0,n.Lk)("td",null,(0,h.v_)(Math.round(60*a.value.main.total_time)),1),l[12]||(l[12]=(0,n.Lk)("td",null,null,-1))])])]),(0,n.bF)(Ue)])]))),128)),(0,n.Lk)("div",Je,[(0,n.Lk)("button",{onClick:d,class:"btn-print"},"Распечатать"),(0,n.Lk)("button",{onClick:u,class:"btn-back"}," Вернуться к заказу "),a.value.main&&"cancel"!==a.value.main.status?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:s,class:"btn-cancel",disabled:r.value},(0,h.v_)(r.value?"Отменяем...":"Отменить заказ"),9,Oe)):(0,n.Q3)("",!0)])])):o.value?((0,n.uX)(),(0,n.CE)("div",Ae," Загрузка сборки... ")):((0,n.uX)(),(0,n.CE)("div",Pe," Не удалось загрузить данные. "))]))}};const Qe=(0,_.A)(De,[["__scopeId","data-v-84fd370c"]]);var Me=Qe;const He={class:"orders-page"},Ge={class:"filters"},Be={class:"filter-group"},Ye={class:"filter-group"},Ze={key:0,class:"orders-table"},el={class:"text-center"},ll={class:"text-right"},tl=["onClick"],al=["onClick"],nl=["onClick"],ol={key:1,class:"no-results"},ul={key:2,class:"loading"};var rl={__name:"NormOrdersList",setup(e){const l=(0,b.rd)(),t=(0,f.KR)({order_num:"",type:""}),o=(0,f.KR)([]),u=(0,f.KR)(!1),r={window:"Окно",glyhar:"Глухарь",door:"Дверь",loggia:"Лоджия",vitrage:"Витраж",other:"Другое"},s={assigned:"Сотрудники назначены",in_production:"В производстве",final:"Готов для ПЭО",cancel:"Отменён"},i=e=>r[e]||e,d=e=>s[e]||e,p=()=>{c()},c=async()=>{u.value=!0;const e=new URLSearchParams;t.value.order_num&&e.append("order_num",t.value.order_num),t.value.type&&e.append("type",t.value.type);try{const l=await fetch(`/api/orders/order/norm/all?${e}`);if(!l.ok)return console.error("Ошибка HTTP:",l.status),void(o.value=[]);const t=await l.json();o.value=Array.isArray(t)?t:[]}catch(l){console.error("Ошибка сети:",l),o.value=[]}finally{u.value=!1}},v=e=>{l.push({name:"EditNormOrder",params:{id:e.id},query:{order_num:e.order_num}})},m=e=>{l.push({name:"AssignWorkers",params:{id:e.id}})},k=async e=>{try{const l=await g.A.post("/api/orders/cancel",{root_product_id:e.id});200===l.status&&(e.status="cancel")}catch(l){console.error("Ошибка при отмене заказа:",l)}};return(0,n.sV)(()=>{const e=new URLSearchParams(window.location.search);e.has("order_num")&&(t.value.order_num=e.get("order_num")),e.has("type")&&(t.value.type=e.get("type")),c()}),(e,l)=>((0,n.uX)(),(0,n.CE)("div",He,[l[6]||(l[6]=(0,n.Lk)("h2",null,"Нормированные заказы",-1)),(0,n.Lk)("div",Ge,[(0,n.Lk)("div",Be,[l[2]||(l[2]=(0,n.Lk)("label",null,"Номер заказа",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.order_num=e),type:"text",placeholder:"",onInput:p},null,544),[[a.Jo,t.value.order_num]])]),(0,n.Lk)("div",Ye,[l[4]||(l[4]=(0,n.Lk)("label",null,"Тип изделия",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.type=e),onChange:p},[...l[3]||(l[3]=[(0,n.Fv)('<option value="" data-v-1dd5fa12>Все типы</option><option value="window" data-v-1dd5fa12>Окна</option><option value="glyhar" data-v-1dd5fa12>Глухари</option><option value="door" data-v-1dd5fa12>Двери</option><option value="loggia" data-v-1dd5fa12>Лоджии</option><option value="vitrage" data-v-1dd5fa12>Витражи</option>',6)])],544),[[a.u1,t.value.type]])])]),o.value.length>0?((0,n.uX)(),(0,n.CE)("table",Ze,[l[5]||(l[5]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Заказ"),(0,n.Lk)("th",null,"Изделие"),(0,n.Lk)("th",null,"Кол-во"),(0,n.Lk)("th",null,"Тип"),(0,n.Lk)("th",null,"Время (ч)"),(0,n.Lk)("th",null,"Дата"),(0,n.Lk)("th",null,"Действие"),(0,n.Lk)("th",null,"Статус")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,(0,h.v_)(e.order_num),1),(0,n.Lk)("td",null,(0,h.v_)(e.name),1),(0,n.Lk)("td",el,(0,h.v_)(e.count),1),(0,n.Lk)("td",null,[(0,n.Lk)("span",{class:(0,h.C4)(`type-badge type-${e.type}`)},(0,h.v_)(i(e.type)),3)]),(0,n.Lk)("td",ll,(0,h.v_)(e.total_time.toFixed(3)),1),(0,n.Lk)("td",null,(0,h.v_)(new Date(e.created_at).toLocaleDateString()),1),(0,n.Lk)("td",null,[(0,n.Lk)("button",{onClick:l=>v(e),class:"btn-view"}," Просмотр ",8,tl),(0,n.Lk)("button",{onClick:l=>m(e),class:"btn-view"}," Назначить сотрудников ",8,al),"cancel"!==e.status?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:l=>k(e),class:"btn-view"}," Отменить ",8,nl)):(0,n.Q3)("",!0)]),(0,n.Lk)("td",null,[(0,n.Lk)("span",{class:(0,h.C4)(`status-badge type-${e.status}`)},(0,h.v_)(d(e.status)),3)])]))),128))])])):u.value?((0,n.uX)(),(0,n.CE)("div",ul,"Загрузка...")):((0,n.uX)(),(0,n.CE)("div",ol,(0,h.v_)(t.value.order_num||t.value.type?"Нет заказов по фильтру":"Нет нормированных заказов"),1))]))}};const sl=(0,_.A)(rl,[["__scopeId","data-v-1dd5fa12"]]);var il=sl;const dl={key:0,class:"edit-norm-page"},pl={class:"item-info"},cl={class:"operations-table"},vl=["onUpdate:modelValue","onInput"],ml=["onUpdate:modelValue"],kl=["onUpdate:modelValue"],_l=["onUpdate:modelValue","onChange","disabled"],yl=["onUpdate:modelValue"],Ll=["onUpdate:modelValue","onInput","disabled"],bl=["onUpdate:modelValue","disabled"],hl=["onUpdate:modelValue","disabled"],fl={class:"actions"},gl=["disabled"],Cl={key:1,class:"loading"},wl={key:2,class:"error"};var El={__name:"EditNormOrder",setup(e){const l=(0,b.lq)(),t=(0,b.rd)(),o=(0,f.KR)([]),u=(0,f.KR)(!1);(0,n.sV)(()=>{s()});const r=e=>{"допвремя на напиловку"===e.operation_label?e.operation_name="dop_nap":"доп время на сборку"===e.operation_label?e.operation_name="dop_sbor":e.operation_name=""},s=async()=>{u.value=!0;try{const e=l.params.id;if(!e)return console.error("Не указан ID наряда"),t.push("/norm/orders/");const a=await fetch(`/api/orders/order-norm/${e}`);if(!a.ok)throw new Error("Наряд не найден");const n=await a.json();let u;u="main"===n.part_type?e:n.parent_product_id?n.parent_product_id:e;const r=await fetch(`/api/orders/order-norm/${u}`);if(!r.ok)throw new Error("Не удалось загрузить сборку");const s=await r.json();o.value=s.map(e=>({id:e.id,order_num:e.order_num,name:e.name,count:e.count,type:e.type,type_izd:e.type_izd,part_type:e.part_type,parent_product_id:e.parent_product_id,created_at:e.created_at,operations:e.operations.map(e=>({...e})),extraOperations:[{operation_name:"dop_nap",operation_label:"",count:0,value:0,minutes:0,fixed:!0},{operation_name:"dop_sbor",operation_label:"",count:0,value:0,minutes:0,fixed:!0},{operation_name:"",operation_label:"",count:0,value:0,minutes:0,fixed:!1},{operation_name:"",operation_label:"",count:0,value:0,minutes:0,fixed:!1}]}))}catch(e){console.error("Ошибка загрузки:",e),alert("Не удалось загрузить данные. Проверьте соединение."),t.push("/norm/orders/")}finally{u.value=!1}},i=e=>"main"===e.part_type?`Основное изделие: ${e.name}`:`Составная часть: ${e.name}`,d=e=>{if(!e)return"";const l=new Date(e);return l.toLocaleDateString("ru-RU")},p=e=>{void 0!==e.value&&(e.minutes=(60*e.value).toFixed(1))},c=e=>{"number"!==typeof e.value||isNaN(e.value)||(e.minutes=parseFloat((60*e.value).toFixed(1)))},v=async()=>{if(u.value)return;u.value=!0;const e=o.value.map(async e=>{const l=e.extraOperations.filter(e=>""!==e.operation_label.trim()),t=[...e.operations,...l].reduce((e,l)=>e+l.value,0),a={order_num:e.order_num,product_name:e.name,type:e.type,status:"in_production",total_time:parseFloat(t.toFixed(3)),operations:[...e.operations.map(e=>({operation_name:e.operation_name,operation_label:e.operation_label,count:parseInt(e.count)||0,value:parseFloat(e.value)||0,minutes:parseFloat(e.minutes)||0})),...l.map(e=>({operation_name:e.operation_name,operation_label:e.operation_label,count:parseInt(e.count)||0,value:parseFloat(e.value)||0,minutes:parseFloat(e.minutes)||0}))]};try{const l=await fetch(`/api/orders/order/norm/update/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return l.ok?{success:!0,id:e.id}:{success:!1,id:e.id}}catch(n){return console.error(`Ошибка при сохранении наряда ${e.id}:`,n),{success:!1,id:e.id}}}),l=await Promise.all(e),t=l.filter(e=>e.success).length;t===l.length||(t>0?console.error(`Сохранено ${t} из ${l.length} нарядов. Проверьте данные.`):console.error("Не удалось сохранить ни один наряд")),await s(),u.value=!1},m=()=>{const e=l.params.id,a=l.query.order_num;t.push({name:"FormPrintNorm",params:{id:e,orderNum:a}})},k=()=>{t.push("/norm/orders/")};return(e,l)=>!u.value&&o.value?((0,n.uX)(),(0,n.CE)("div",dl,[l[6]||(l[6]=(0,n.Lk)("h2",null,"Редактирование заказа",-1)),(0,n.Lk)("p",null,[l[0]||(l[0]=(0,n.Lk)("strong",null,"Заказ:",-1)),(0,n.eW)(" "+(0,h.v_)(o.value[0]?.order_num),1)]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"assembly-item"},[(0,n.Lk)("h3",null,(0,h.v_)(i(e)),1),(0,n.Lk)("div",pl,[(0,n.Lk)("span",null,[l[1]||(l[1]=(0,n.Lk)("strong",null,"Тип:",-1)),(0,n.eW)(" "+(0,h.v_)(e.type_izd),1)]),(0,n.Lk)("span",null,[l[2]||(l[2]=(0,n.Lk)("strong",null,"Кол-во:",-1)),(0,n.eW)(" "+(0,h.v_)(e.count),1)]),(0,n.Lk)("span",null,[l[3]||(l[3]=(0,n.Lk)("strong",null,"Создан:",-1)),(0,n.eW)(" "+(0,h.v_)(d(e.created_at)),1)])]),(0,n.Lk)("table",cl,[l[5]||(l[5]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Операция"),(0,n.Lk)("th",null,"Время (ч)"),(0,n.Lk)("th",null,"Кол-во"),(0,n.Lk)("th",null,"Время (мин)")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.operations,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.operation_name},[(0,n.Lk)("td",null,(0,h.v_)(e.operation_label),1),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.value=l,type:"number",min:"0",step:"0.01",class:"input-small",onInput:l=>p(e)},null,40,vl),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",step:"1",min:"0",class:"input-small"},null,8,ml),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.minutes=l,type:"number",min:"0",class:"input-small"},null,8,kl),[[a.Jo,e.minutes,void 0,{number:!0}]])])]))),128)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.extraOperations,(e,t)=>((0,n.uX)(),(0,n.CE)("tr",{key:e.operation_name||`custom_${t}`},[(0,n.Lk)("td",null,[e.fixed?(0,n.bo)(((0,n.uX)(),(0,n.CE)("select",{key:0,"onUpdate:modelValue":l=>e.operation_label=l,class:"input-full",onChange:l=>r(e),disabled:u.value},[...l[4]||(l[4]=[(0,n.Lk)("option",{value:""},"-- Выберите операцию --",-1),(0,n.Lk)("option",{value:"доп время на напиловку"},"доп время на напиловку",-1),(0,n.Lk)("option",{value:"доп время на сборку"},"доп время на сборку",-1)])],40,_l)),[[a.u1,e.operation_label]]):(0,n.bo)(((0,n.uX)(),(0,n.CE)("input",{key:1,"onUpdate:modelValue":l=>e.operation_label=l,type:"text",placeholder:"Введите название операции",class:"input-full"},null,8,yl)),[[a.Jo,e.operation_label]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.value=l,type:"number",min:"0",step:"0.01",class:"input-small",onInput:l=>c(e),disabled:u.value},null,40,Ll),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",step:"1",min:"0",class:"input-small",disabled:u.value},null,8,bl),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.minutes=l,type:"number",min:"0",class:"input-small",disabled:u.value},null,8,hl),[[a.Jo,e.minutes,void 0,{number:!0}]])])]))),128))])])]))),128)),(0,n.Lk)("div",fl,[(0,n.Lk)("button",{onClick:k,class:"btn-cancel"},"Назад"),(0,n.Lk)("button",{onClick:v,disabled:u.value,class:"btn-save"},(0,h.v_)(u.value?"Сохраняем...":"Сохранить всё"),9,gl),(0,n.Lk)("button",{onClick:m,class:"btn-print"}," Перейти к печати ")])])):u.value?((0,n.uX)(),(0,n.CE)("div",Cl,"Загрузка сборки...")):((0,n.uX)(),(0,n.CE)("div",wl,"Не удалось загрузить данные"))}};const Fl=(0,_.A)(El,[["__scopeId","data-v-4ba8c1f2"]]);var xl=Fl;t(1148),t(3579);const Xl={key:0,class:"assign-workers"},Vl={class:"info-grid"},Ul={class:"total-time"},zl={class:"total-time"},Kl={class:"executors-table"},Il={class:"text-center"},Rl={class:"text-center"},$l=["onUpdate:modelValue"],ql=["value","disabled"],Sl=["onUpdate:modelValue","onInput"],Wl=["onUpdate:modelValue","onInput"],Nl=["onClick"],Tl=["onClick"],jl={class:"actions"},Jl=["disabled"],Ol={key:1,class:"loading"},Al={key:2,class:"error"};var Pl={__name:"AssignWorkers",setup(e){const l=(0,b.lq)(),t=(0,b.rd)(),o=(0,f.KR)(null),u=(0,f.KR)(!1),r=(0,f.KR)(""),s=(0,f.KR)({}),i=(0,f.KR)({}),d=(e,l,t)=>e.some(e=>e!==t&&e.employee_id===l);(0,n.sV)(async()=>{const e=l.params.id;if(!e)return;u.value=!0;try{const l=await fetch(`/api/orders/order-norm/${e}`);if(!l.ok)throw new Error("Не удалось загрузить сборку");const t=await l.json(),a=t.map(e=>({...e,operations:e.operations.map(e=>{const l=Array.isArray(e.assign_workers)&&e.assign_workers.length>0?e.assign_workers.map(e=>({employee_id:e.employee_id,actual_minutes:e.actual_minutes,actual_value:parseFloat(e.actual_value.toFixed(3))})):[{employee_id:"",actual_minutes:e.minutes,actual_value:parseFloat(e.value.toFixed(3))}];return{...e,executors:l}})})),n=a.find(e=>"main"===e.part_type)||a[0],u=a.filter(e=>"sub"===e.part_type);o.value={main:n,subs:u}}catch(s){console.error("Ошибка загрузки:",s),alert("Не удалось загрузить данные")}finally{u.value=!1}const t=(new Date).toISOString().split("T")[0],a=o.value.main.ready_date;let n=t;if(a){const e=new Date(a).toISOString().split("T")[0];"Invalid date"!==e&&(n=e)}r.value=n});const p=async e=>{if(!s.value[e]&&!i.value[e]){i.value[e]=!0;try{const l=await fetch(`/api/workers/all?type=${e}`);if(!l.ok)throw new Error("Не удалось загрузить сотрудников");s.value[e]=await l.json()}catch(l){console.error(`Ошибка загрузки сотрудников для ${e}:`,l),s.value[e]=[]}finally{i.value[e]=!1}}},c=e=>(s.value[e]||i.value[e]||p(e),s.value[e]||[]),v=(0,n.EW)(()=>o.value?[o.value.main,...o.value.subs]:[]),m=(0,n.EW)(()=>v.value.reduce((e,l)=>e+l.total_time,0)),k=e=>e?new Date(e).toLocaleDateString("ru-RU"):"",_=e=>"main"===e.part_type?`${e.name}`:`${e.name} (часть изделия)`,y=e=>{const l={window:"Окно",glyhar:"Глухарь",door:"Дверь",loggia:"Лоджия",vitrage:"Витраж"};return l[e]||e},L=e=>{const l=Number(e.actual_minutes);e.actual_value=isNaN(l)?0:parseFloat((l/60).toFixed(3))},g=e=>{const l=Number(e.actual_value);e.actual_minutes=isNaN(l)?0:Number((60*l).toFixed(3))},C=e=>{const l=e.value,t=e.executors.length+1,a=parseFloat((l/t).toFixed(3));e.executors.push({employee_id:"",actual_minutes:Number(parseFloat((60*a).toFixed(3))),actual_value:a}),E(e)},w=(e,l)=>{e.executors.length<=1||(e.executors.splice(l,1),E(e))},E=e=>{const l=e.value,t=e.executors.length;if(0===t)return;const a=parseFloat((l/t).toFixed(3));e.executors.forEach(e=>{e.actual_minutes=Number(parseFloat((60*a).toFixed(3))),e.actual_value=a})},F=async()=>{const e={assignments:[],update_status:"assigned",root_product_id:o.value.main.id,ready_date:r.value},l=[];for(const t of v.value)for(const a of t.operations){const n=a.executors.filter(e=>e.employee_id);if(0!==n.length)for(const o of a.executors)o.employee_id||l.push(`У операции "${a.operation_label}" (${t.name}) указан исполнитель без ФИО`),o.employee_id&&e.assignments.push({product_id:t.id,operation_name:a.operation_name,employee_id:o.employee_id,actual_minutes:o.actual_minutes||a.minutes,actual_value:o.actual_value||a.value,notes:""});else l.push(`Операция "${a.operation_label}" (${t.name}) — не назначен исполнитель`)}if(l.length>0)alert("Не все операции назначены:\n\n"+l.join("\n"));else if(0!==e.assignments.length)try{const l=await fetch("/api/workers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});l.ok&&t.push("/norm/orders")}catch(a){console.error("Ошибка отправки:",a)}else alert("Нет ни одной операции с назначением")},x=()=>{t.back()};return(e,l)=>o.value?((0,n.uX)(),(0,n.CE)("div",Xl,[l[11]||(l[11]=(0,n.Lk)("h2",null,"Назначение работников",-1)),(0,n.Lk)("div",Vl,[l[2]||(l[2]=(0,n.Lk)("div",null,[(0,n.Lk)("strong",null,"Заказ:")],-1)),(0,n.Lk)("div",null,(0,h.v_)(o.value.main.order_num),1),l[3]||(l[3]=(0,n.Lk)("div",null,[(0,n.Lk)("strong",null,"Изделие:")],-1)),(0,n.Lk)("div",null,(0,h.v_)(o.value.main.name),1),l[4]||(l[4]=(0,n.Lk)("div",null,[(0,n.Lk)("strong",null,"Общее время:")],-1)),(0,n.Lk)("div",Ul,(0,h.v_)(m.value.toFixed(3))+" ч ("+(0,h.v_)(Math.round(60*m.value))+" мин) ",1),l[5]||(l[5]=(0,n.Lk)("div",null,[(0,n.Lk)("strong",null,"Дата создания:")],-1)),(0,n.Lk)("div",null,(0,h.v_)(k(o.value.main.created_at)),1),l[6]||(l[6]=(0,n.Lk)("div",null,[(0,n.Lk)("strong",null,"Дата выполнения:")],-1)),(0,n.Lk)("div",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>r.value=e),type:"date",class:"input-date"},null,512),[[a.Jo,r.value]]),l[1]||(l[1]=(0,n.Lk)("small",null,"Укажите дату изготовления",-1))])]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(v.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"item-section"},[(0,n.Lk)("h3",null,(0,h.v_)(_(e)),1),(0,n.Lk)("p",null,[l[7]||(l[7]=(0,n.Lk)("strong",null,"Тип:",-1)),(0,n.eW)(" "+(0,h.v_)(y(e.type)),1)]),l[10]||(l[10]=(0,n.Lk)("div",null,[(0,n.Lk)("strong",null,"Общее время:")],-1)),(0,n.Lk)("div",zl,(0,h.v_)(e.total_time.toFixed(3))+" ч ("+(0,h.v_)(Math.round(60*e.total_time))+" мин) ",1),(0,n.Lk)("table",Kl,[l[9]||(l[9]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Операция"),(0,n.Lk)("th",null,"Норма (мин)"),(0,n.Lk)("th",null,"Норма (ч)"),(0,n.Lk)("th",{style:{width:"50%"}},[(0,n.eW)(" Исполнители "),(0,n.Lk)("div",{class:"executor-headers"},[(0,n.Lk)("span",{class:"header-label"},"Исполнитель"),(0,n.Lk)("span",{class:"header-label"},"Факт (мин)"),(0,n.Lk)("span",{class:"header-label"},"Факт (ч)")])])])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.operations,t=>((0,n.uX)(),(0,n.CE)("tr",{key:t.operation_name,class:(0,h.C4)({"missing-executor":t.executors.every(e=>!e.employee_id)})},[(0,n.Lk)("td",null,(0,h.v_)(t.operation_label),1),(0,n.Lk)("td",Il,(0,h.v_)(t.minutes),1),(0,n.Lk)("td",Rl,(0,h.v_)(t.value.toFixed(3)),1),(0,n.Lk)("td",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.executors,(o,u)=>((0,n.uX)(),(0,n.CE)("div",{key:u,class:"executor-row"},[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e=>o.employee_id=e,class:"select-employee"},[l[8]||(l[8]=(0,n.Lk)("option",{value:""},"— выберите —",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c(e.type),e=>((0,n.uX)(),(0,n.CE)("option",{key:e.id,value:e.id,disabled:d(t.executors,e.id,o)},(0,h.v_)(e.name),9,ql))),128))],8,$l),[[a.u1,o.employee_id]]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":e=>o.actual_minutes=e,type:"number",placeholder:"мин",class:"input-minutes",min:"0",step:"0.001",onInput:e=>L(o)},null,40,Sl),[[a.Jo,o.actual_minutes,void 0,{number:!0}]]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":e=>o.actual_value=e,type:"number",placeholder:"ч",class:"input-minutes",min:"0",step:"0.01",onInput:e=>g(o)},null,40,Wl),[[a.Jo,o.actual_value,void 0,{number:!0}]]),t.executors.length>1?((0,n.uX)(),(0,n.CE)("button",{key:0,type:"button",onClick:e=>w(t,u),class:"btn-remove"}," ✕ ",8,Nl)):(0,n.Q3)("",!0)]))),128)),(0,n.Lk)("button",{type:"button",onClick:e=>C(t),class:"btn-add"}," + Добавить исполнителя ",8,Tl)])],2))),128))])])]))),128)),(0,n.Lk)("div",jl,[(0,n.Lk)("button",{onClick:x,class:"btn-cancel"},"Назад"),(0,n.Lk)("button",{onClick:F,disabled:u.value,class:"btn-save"},(0,h.v_)(u.value?"Сохраняем...":"Сохранить назначения"),9,Jl)])])):u.value?((0,n.uX)(),(0,n.CE)("div",Ol,"Загрузка сборки...")):((0,n.uX)(),(0,n.CE)("div",Al,"Не удалось загрузить данные"))}};const Dl=(0,_.A)(Pl,[["__scopeId","data-v-63ae3702"]]);var Ql=Dl;t(5367),t(2731);const Ml={class:"form-group"},Hl=["value"],Gl={key:2,class:"error-text"},Bl=["value"],Yl={key:0,class:"error-text"},Zl=["value"],et={key:0,class:"error-text"},lt=["value"],tt={key:0,class:"error-text"},at={key:0,class:"error-text"},nt=["value"],ot={key:0,class:"error-text"},ut={key:0,class:"error-text"},rt=["value"],st={key:0,class:"error-text"},it={class:"modal-actions"},dt=["disabled"];var pt={__name:"EditProductModal",props:{product:Object,employees:Array},emits:["close","cancel"],setup(e,{emit:l}){const t=e,o=l,u=(0,f.KR)({...t.product}),r=[{value:"к",label:"корпоративный"},{value:"ч",label:"частный"},{value:"д",label:"дилер"}],s=["1П","1Пт","1.5П","1.5Пт","2П","2Пт"],i=[{value:"сх",label:"Сиал холодный"},{value:"ст",label:"Сиал теплый"},{value:"ах",label:"Алютех холодный"},{value:"ат",label:"Алютех теплый"},{value:"щ",label:"Шуко"}],d=[{value:"х",label:"Холодная"},{value:"т",label:"Тёплая"}],p=(0,n.EW)(()=>"door"===u.value.type),c=["бригада","бригада окон, дверей","бригада витражей"],v=(0,f.KR)({}),m=()=>{v.value={};const e=[{key:"type_izd",label:"Наименование"},{key:"systema",label:"Система"},{key:"profile",label:"Профиль"},{key:"sqr",label:"Площадь"},{key:"brigade",label:"Бригада"},{key:"norm_money",label:"Н/руб"},{key:"customer_type",label:"Направление заказчика"},{key:"coefficient",label:"Коэффициент"}];return e.forEach(e=>{const l=u.value[e.key];l&&("string"!==typeof l||l.trim())||(v.value[e.key]=!0)}),(isNaN(parseFloat(u.value.sqr))||parseFloat(u.value.sqr)<0)&&(v.value.sqr=!0),(isNaN(parseFloat(u.value.norm_money))||parseFloat(u.value.norm_money)<0)&&(v.value.norm_money=!0),0===Object.keys(v.value).length},k=(0,n.EW)(()=>m()),_=()=>{m()&&o("close",u.value)},y=(0,f.KR)(!1),L=()=>{if(y.value)return;const e=parseFloat(u.value.total_time),l=parseFloat(u.value.coefficient);isNaN(e)||isNaN(l)||(u.value.norm_money=parseFloat((e*l).toFixed(3)))};(0,n.wB)(()=>u.value.coefficient,()=>{y.value||L()});const b=()=>{y.value=!1},g=e=>{y.value=!0,u.value.norm_money=parseFloat(e.target.value)||0},C=()=>{if(u.value.norm_money&&u.value.norm_money>0)return;const e=parseFloat(u.value.total_time),l=parseFloat(u.value.coefficient);!isNaN(e)&&!isNaN(l)&&l>0&&(u.value.norm_money=parseFloat((e*l).toFixed(3)),y.value=!1)};C();const w=()=>{o("cancel")};return(e,l)=>((0,n.uX)(),(0,n.CE)("div",{class:"modal-overlay",onClick:w},[(0,n.Lk)("div",{class:"modal-content",onClick:l[9]||(l[9]=(0,a.D$)(()=>{},["stop"]))},[l[24]||(l[24]=(0,n.Lk)("h3",null,"Редактирование изделия",-1)),(0,n.Lk)("div",Ml,[l[10]||(l[10]=(0,n.Lk)("label",null,"Спецификация",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>u.value.parent_assembly=e),class:"form-input",placeholder:"Опционально"},null,512),[[a.Jo,u.value.parent_assembly]])]),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.type_izd}])},[l[12]||(l[12]=(0,n.Lk)("label",null,"Наименование",-1)),p.value?(0,n.bo)(((0,n.uX)(),(0,n.CE)("select",{key:0,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value.type_izd=e),class:(0,h.C4)(["form-select",{invalid:v.value.type_izd}]),onChange:m},[l[11]||(l[11]=(0,n.Lk)("option",{value:"",disabled:""},"Выберите тип двери",-1)),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(s,e=>(0,n.Lk)("option",{key:e,value:e},(0,h.v_)(e),9,Hl)),64))],34)),[[a.u1,u.value.type_izd]]):(0,n.bo)(((0,n.uX)(),(0,n.CE)("input",{key:1,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value.type_izd=e),class:(0,h.C4)(["form-input",{invalid:v.value.type_izd}]),onBlur:m},null,34)),[[a.Jo,u.value.type_izd]]),v.value.type_izd?((0,n.uX)(),(0,n.CE)("span",Gl,"Укажите наименование")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.customer_type}])},[l[14]||(l[14]=(0,n.Lk)("label",null,"Направление заказчика",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[3]||(l[3]=e=>u.value.customer_type=e),class:(0,h.C4)(["form-select",{invalid:v.value.customer_type}]),onChange:m},[l[13]||(l[13]=(0,n.Lk)("option",{value:"",disabled:""},"Выберите направление",-1)),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(r,e=>(0,n.Lk)("option",{key:e.value,value:e.value},(0,h.v_)(e.label),9,Bl)),64))],34),[[a.u1,u.value.customer_type]]),v.value.customer_type?((0,n.uX)(),(0,n.CE)("span",Yl,"Выберите направление")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.systema}])},[l[16]||(l[16]=(0,n.Lk)("label",null,"Система",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[4]||(l[4]=e=>u.value.systema=e),class:(0,h.C4)(["form-select",{invalid:v.value.systema}]),onChange:m},[l[15]||(l[15]=(0,n.Lk)("option",{value:"",disabled:""},"— Выберите систему —",-1)),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(d,e=>(0,n.Lk)("option",{key:e.value,value:e.value},(0,h.v_)(e.label),9,Zl)),64))],34),[[a.u1,u.value.systema]]),v.value.systema?((0,n.uX)(),(0,n.CE)("span",et,"Укажите систему")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.profile}])},[l[18]||(l[18]=(0,n.Lk)("label",null,"Профиль",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.profile=e),class:(0,h.C4)(["form-select",{invalid:v.value.profile}]),onChange:m},[l[17]||(l[17]=(0,n.Lk)("option",{value:"",disabled:""},"— Выберите профиль —",-1)),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(i,e=>(0,n.Lk)("option",{key:e.value,value:e.value},(0,h.v_)(e.label),9,lt)),64))],34),[[a.u1,u.value.profile]]),v.value.profile?((0,n.uX)(),(0,n.CE)("span",tt,"Укажите профиль")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.sqr}])},[l[19]||(l[19]=(0,n.Lk)("label",null,"Площадь",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.sqr=e),type:"number",step:"0.001",min:"0",class:(0,h.C4)(["form-input",{invalid:v.value.sqr}]),onBlur:m},null,34),[[a.Jo,u.value.sqr,void 0,{number:!0}]]),v.value.sqr?((0,n.uX)(),(0,n.CE)("span",at,"Введите корректную площадь")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.brigade}])},[l[21]||(l[21]=(0,n.Lk)("label",null,"Бригада",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.brigade=e),class:(0,h.C4)(["form-select",{invalid:v.value.brigade}]),onChange:m},[l[20]||(l[20]=(0,n.Lk)("option",{value:"",disabled:""},"Выберите значение",-1)),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(c,e=>(0,n.Lk)("option",{key:e,value:e},(0,h.v_)(e),9,nt)),64))],34),[[a.u1,u.value.brigade]]),v.value.brigade?((0,n.uX)(),(0,n.CE)("span",ot,"Выберите бригаду")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.coefficient}])},[l[22]||(l[22]=(0,n.Lk)("label",null,"Коэффициент",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[8]||(l[8]=e=>u.value.coefficient=e),type:"number",step:"0.01",min:"0",class:(0,h.C4)(["form-input",{invalid:v.value.coefficient}]),onBlur:m},null,34),[[a.Jo,u.value.coefficient,void 0,{number:!0}]]),v.value.coefficient?((0,n.uX)(),(0,n.CE)("span",ut,"Введите коэффициент")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",{class:(0,h.C4)(["form-group",{error:v.value.norm_money}])},[l[23]||(l[23]=(0,n.Lk)("label",null,"Н/руб",-1)),(0,n.Lk)("input",{value:u.value.norm_money,onInput:g,onFocus:b,type:"number",step:"0.01",min:"0",class:(0,h.C4)(["form-input",{invalid:v.value.norm_money}]),onBlur:m},null,42,rt),v.value.norm_money?((0,n.uX)(),(0,n.CE)("span",st,"Введите норму в рублях")):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",it,[(0,n.Lk)("button",{onClick:w,class:"btn-cancel"},"Отмена"),(0,n.Lk)("button",{onClick:_,class:"btn-save",disabled:!k.value}," Сохранить ",8,dt)])])]))}};const ct=(0,_.A)(pt,[["__scopeId","data-v-09c7be32"]]);var vt=ct;const mt={key:0,class:"no-data"},kt={key:1,class:"summary-stats"},_t={class:"summary-table"},yt={key:2,class:"summary-stats"},Lt={class:"summary-table"},bt={key:3,class:"summary-stats"},ht={class:"summary-table"},ft={key:4,class:"summary-stats total-summary"},gt={class:"summary-table"},Ct={class:"total-row"},wt={class:"toggle-section"},Et={key:0,class:"summary-stats detailed-grouping"},Ft={class:"summary-table"},xt={key:0,class:"summary-stats unmatched-grouping"},Xt={class:"summary-table"};var Vt={__name:"SummaryStats",props:{products:{type:Array,required:!0}},setup(e){const l=e;function t(e){return(e||"").trim().toLowerCase()}function o(e){const l=e.reduce((e,l)=>(e.count+=parseFloat(l.count)||0,e.sqr+=parseFloat(l.sqr)||0,e.hours+=parseFloat(l.total_time)||0,e.money+=parseFloat(l.norm_money)||0,e),{count:0,sqr:0,hours:0,money:0});return{count:parseFloat(l.count.toFixed(3)),sqr:parseFloat(l.sqr.toFixed(3)),hours:parseFloat(l.hours.toFixed(3)),money:parseFloat(l.money.toFixed(3))}}const u=(0,n.EW)(()=>{const e=l.products,a=e.filter(e=>("window"===e.type||"glyhar"===e.type)&&t(e.systema).includes("х")&&"витраж к двери"!==t(e.type_izd)),n=e.filter(e=>("window"===e.type||"glyhar"===e.type)&&t(e.systema).includes("т")&&"витраж к двери"!==t(e.type_izd)),u=e.filter(e=>"glyhar"===e.type&&"витраж к двери"===t(e.type_izd)),r=[...a,...n,...u],s=e.filter(e=>"door"===e.type&&("1П"===e.type_izd||"1Пт"===e.type_izd)),i=e.filter(e=>"door"===e.type&&("1.5П"===e.type_izd||"1.5Пт"===e.type_izd)),d=e.filter(e=>"door"===e.type&&("2П"===e.type_izd||"2Пт"===e.type_izd)),p=e.filter(e=>"loggia"===e.type),c=e.filter(e=>"ms"===e.type),v=o(a),m=o(n),k=o(r),_=o(u),y=o(p),L=o(c),b=o(s),h=o(i),f=o(d),g=[{type_izd:"Холодные окна",profile:"х",...v},{type_izd:"Теплые окна",profile:"т",...m},{type_izd:"Витраж к двери",profile:"",..._},{type_izd:"Всего окон",profile:"",...k},{type_izd:"Всего 1П дверей",profile:"",...b},{type_izd:"Всего 1.5П дверей",profile:"",...h},{type_izd:"Всего 2П дверей",profile:"",...f}].filter(e=>e.count>0),C=y.count>0?[{type_izd:"Лоджии",profile:"",...y}]:[],w=L.count>0?[{type_izd:"Москитные сетки",profile:"",...L}]:[],E=[k,b,h,f].reduce((e,l)=>({count:e.count+l.count,sqr:e.sqr+l.sqr,hours:e.hours+l.hours,money:e.money+l.money}),{count:0,sqr:0,hours:0,money:0}),F={count:parseFloat(E.count.toFixed(3)),sqr:parseFloat(E.sqr.toFixed(3)),hours:parseFloat(E.hours.toFixed(3)),money:parseFloat(E.money.toFixed(3))};return{windowGroups:g,loggiaGroup:C,mosquitoGroup:w,totalRounded:F}}),r=[{type_izd:"окно гл.",profile:"ах"},{type_izd:"окно гл.",profile:"ат"},{type_izd:"окно гл.",profile:"ш"},{type_izd:"окно гл.",profile:"сх"},{type_izd:"окно гл.",profile:"ст"},{type_izd:"окно пов.-отк.",profile:"ах"},{type_izd:"окно пов.-отк.",profile:"ат"},{type_izd:"окно пов.-отк.",profile:"ст"},{type_izd:"окно пов.-отк.",profile:"сх"},{type_izd:"окно пов.-отк.",profile:"ш"},{type_izd:"1П",profile:"ах"},{type_izd:"1П",profile:"сх"},{type_izd:"1Пт",profile:"ат"},{type_izd:"1Пт",profile:"ст"},{type_izd:"1Пт",profile:"ш"},{type_izd:"1.5П",profile:"ах"},{type_izd:"1.5П",profile:"сх"},{type_izd:"1.5Пт",profile:"ат"},{type_izd:"1.5Пт",profile:"ст"},{type_izd:"1.5Пт",profile:"ш"},{type_izd:"2П",profile:"ах"},{type_izd:"2П",profile:"сх"},{type_izd:"2Пт",profile:"ат"},{type_izd:"2Пт",profile:"ст"},{type_izd:"2Пт",profile:"ш"}];function s(e){const l=e=>{const l=(e.type_izd||"").trim(),t=null==e.profile?"":String(e.profile).trim();return`${l}__${t}`},t=new Set(r.map(e=>{const l=(e.type_izd||"").trim(),t=null==e.profile?"":String(e.profile).trim();return`${l}__${t}`})),a=new Map,n=[];e.forEach(e=>{const o=l(e);if(t.has(o)){a.has(o)||a.set(o,{count:0,sqr:0,hours:0,money:0});const l=a.get(o);l.count+=e.count||0,l.sqr+=e.sqr||0,l.hours+=e.total_time||0,l.money+=e.norm_money||0}else n.push(e)});const o=r.map(e=>{const l=null==e.profile?"":String(e.profile).trim(),t=`${e.type_izd.trim()}__${l}`,n=a.get(t)||{count:0,sqr:0,hours:0,money:0};return{type_izd:e.type_izd,profile:e.profile,count:parseFloat(n.count.toFixed(3)),sqr:parseFloat(n.sqr.toFixed(3)),hours:parseFloat(n.hours.toFixed(3)),money:parseFloat(n.money.toFixed(3))}});return{fixedGroups:o,unmatched:n}}const i=(0,n.EW)(()=>s(l.products)),d=(0,n.EW)(()=>i.value.fixedGroups),p=(0,n.EW)(()=>i.value.unmatched),c=(0,f.KR)(!1),v=e=>{const l={window:"Окно",door:"Дверь",loggia:"Лоджия",ms:"Москитная сетка",glyhar:"Глухое окно"};return l[e]||e};return(e,t)=>((0,n.uX)(),(0,n.CE)(n.FK,null,[l.products.length?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",mt," Нет данных для отображения. ")),u.value.windowGroups.length>0?((0,n.uX)(),(0,n.CE)("div",kt,[t[2]||(t[2]=(0,n.Lk)("h4",null,"Окна и двери",-1)),(0,n.Lk)("table",_t,[t[1]||(t[1]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Наименование"),(0,n.Lk)("th",null,"Профиль"),(0,n.Lk)("th",null,"Кол-во"),(0,n.Lk)("th",null,"Площадь, м²"),(0,n.Lk)("th",null,"Н/час"),(0,n.Lk)("th",null,"Н/руб")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(u.value.windowGroups,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.type_izd},[(0,n.Lk)("td",null,(0,h.v_)(e.type_izd),1),(0,n.Lk)("td",null,(0,h.v_)(e.profile),1),(0,n.Lk)("td",null,(0,h.v_)(e.count),1),(0,n.Lk)("td",null,(0,h.v_)(e.sqr),1),(0,n.Lk)("td",null,(0,h.v_)(e.hours),1),(0,n.Lk)("td",null,(0,h.v_)(e.money),1)]))),128))])])])):(0,n.Q3)("",!0),u.value.loggiaGroup.length>0?((0,n.uX)(),(0,n.CE)("div",yt,[t[3]||(t[3]=(0,n.Lk)("h4",null,"Лоджии",-1)),(0,n.Lk)("table",Lt,[(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(u.value.loggiaGroup,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.type_izd},[(0,n.Lk)("td",null,(0,h.v_)(e.type_izd),1),(0,n.Lk)("td",null,(0,h.v_)(e.profile),1),(0,n.Lk)("td",null,(0,h.v_)(e.count),1),(0,n.Lk)("td",null,(0,h.v_)(e.sqr),1),(0,n.Lk)("td",null,(0,h.v_)(e.hours),1),(0,n.Lk)("td",null,(0,h.v_)(e.money),1)]))),128))])])])):(0,n.Q3)("",!0),u.value.mosquitoGroup.length>0?((0,n.uX)(),(0,n.CE)("div",bt,[t[4]||(t[4]=(0,n.Lk)("h4",null,"Москитные сетки",-1)),(0,n.Lk)("table",ht,[(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(u.value.mosquitoGroup,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.type_izd},[(0,n.Lk)("td",null,(0,h.v_)(e.type_izd),1),(0,n.Lk)("td",null,(0,h.v_)(e.profile),1),(0,n.Lk)("td",null,(0,h.v_)(e.count),1),(0,n.Lk)("td",null,(0,h.v_)(e.sqr),1),(0,n.Lk)("td",null,(0,h.v_)(e.hours),1),(0,n.Lk)("td",null,(0,h.v_)(e.money),1)]))),128))])])])):(0,n.Q3)("",!0),u.value.totalRounded.count>0?((0,n.uX)(),(0,n.CE)("div",ft,[t[7]||(t[7]=(0,n.Lk)("h4",null,"Всего за месяц",-1)),(0,n.Lk)("table",gt,[t[6]||(t[6]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th"),(0,n.Lk)("th"),(0,n.Lk)("th",null,"Кол-во"),(0,n.Lk)("th",null,"Площадь, м²"),(0,n.Lk)("th",null,"Н/час"),(0,n.Lk)("th",null,"Н/руб")])],-1)),(0,n.Lk)("tbody",null,[(0,n.Lk)("tr",Ct,[t[5]||(t[5]=(0,n.Lk)("td",{colspan:"2"},[(0,n.Lk)("strong",null,"Итого:")],-1)),(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,(0,h.v_)(u.value.totalRounded.count),1)]),(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,(0,h.v_)(u.value.totalRounded.sqr),1)]),(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,(0,h.v_)(u.value.totalRounded.hours),1)]),(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,(0,h.v_)(u.value.totalRounded.money),1)])])])])])):(0,n.Q3)("",!0),(0,n.Lk)("div",wt,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=e=>c.value=!c.value),class:"btn-toggle"},(0,h.v_)(c.value?"Скрыть детали":"Показать детальную информацию"),1)]),(0,n.bF)(a.eB,{name:"slide"},{default:(0,n.k6)(()=>[c.value&&d.value.length>0?((0,n.uX)(),(0,n.CE)("div",Et,[t[12]||(t[12]=(0,n.Lk)("h4",null,"Детализация по профилям",-1)),(0,n.Lk)("table",Ft,[t[8]||(t[8]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Наименование"),(0,n.Lk)("th",null,"Профиль"),(0,n.Lk)("th",null,"Кол-во"),(0,n.Lk)("th",null,"Площадь, м²"),(0,n.Lk)("th",null,"Н/час"),(0,n.Lk)("th",null,"Н/руб")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:`${e.type_izd}_${e.profile}`},[(0,n.Lk)("td",null,(0,h.v_)(e.type_izd),1),(0,n.Lk)("td",null,(0,h.v_)(e.profile),1),(0,n.Lk)("td",null,(0,h.v_)(e.count),1),(0,n.Lk)("td",null,(0,h.v_)(e.sqr),1),(0,n.Lk)("td",null,(0,h.v_)(e.hours),1),(0,n.Lk)("td",null,(0,h.v_)(e.money),1)]))),128))])]),c.value&&p.value.length>0?((0,n.uX)(),(0,n.CE)("div",xt,[t[10]||(t[10]=(0,n.Lk)("h4",{style:{color:"#e53e3e"}},"⚠️ Изделия, не попавшие в отчёт",-1)),t[11]||(t[11]=(0,n.Lk)("p",{style:{"font-size":"12px",color:"#e53e3e","margin-bottom":"8px"}}," Эти изделия не соответствуют ни одному из правил группировки. Проверьте написание «Наименование» и «Профиль». ",-1)),(0,n.Lk)("table",Xt,[t[9]||(t[9]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Заказ"),(0,n.Lk)("th",null,"Наименование"),(0,n.Lk)("th",null,"Профиль"),(0,n.Lk)("th",null,"Тип")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(p.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,(0,h.v_)(e.order_num),1),(0,n.Lk)("td",null,(0,h.v_)(e.type_izd),1),(0,n.Lk)("td",null,(0,h.v_)(e.profile),1),(0,n.Lk)("td",null,(0,h.v_)(v(e.type)),1)]))),128))])])])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)]),_:1})],64))}};const Ut=(0,_.A)(Vt,[["__scopeId","data-v-5533f081"]]);var zt=Ut;const Kt={class:"peo-report"},It={class:"filters"},Rt={class:"filter-group"},$t={class:"filter-group"},qt=["value"],St={class:"filter-group"},Wt={class:"type-filters"},Nt=["value"],Tt={class:"checkbox-text"},jt={class:"table-container"},Jt={class:"report-table"},Ot=["onClick"];var At={__name:"FinalNormOrdersList",setup(e){const l=(new Date).getFullYear(),t=(0,f.KR)(l),o=(0,f.KR)((new Date).getMonth()+1),u=(0,f.KR)(""),r=(0,f.KR)(null),s=e=>{r.value={...e}},i=async e=>{try{const l={...e,sqr:parseFloat(e.sqr)||0,norm_money:parseFloat(e.norm_money)||0,coefficient:parseFloat(e.coefficient),total_time:parseFloat(e.total_time)||0,count:parseInt(e.count)||0};await g.A.put(`/api/final/update/${e.id}`,l);const t=w.value.findIndex(l=>l.id===e.id);-1!==t&&(w.value[t]=e),r.value=null,V()}catch(l){console.error("Ошибка сохранения",l)}},d=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],p={assigned:"Сотрудники назначены",final:"Готов"},c=e=>p[e]||e,v=(0,n.EW)(()=>`${t.value}-${String(o.value).padStart(2,"0")}-01`),m=(0,n.EW)(()=>{const e=new Date(t.value,o.value,0),l=String(e.getDate()).padStart(2,"0"),a=String(o.value).padStart(2,"0");return`${t.value}-${a}-${l}`}),k={combined:{label:"Окна и двери",types:["window","door","glyhar"]},loggia:{label:"Лоджии и витражи",types:["loggia","vitrage"]},mosquito_net:{label:"Москитные сетки",types:["ms"]}},_=(0,n.EW)(()=>{const e=b.value,l=e.some(e=>["window","door","glyhar"].includes(e)),t=e.some(e=>["loggia","vitrage"].includes(e)),a=[];return l&&a.push({key:"parent_assembly",label:"спецификация",width:"90px",align:"center"}),t&&a.push({key:"parent_assembly",label:"витраж",width:"90px",align:"center"}),a.push({key:"order_num",label:"№ заказа",width:"100px"},{key:"customer_type",label:"тип клиента",width:"100px"},{key:"customer",label:"заказчик",width:"100px"}),t&&a.push({key:"type_izd",label:"наименование",width:"90px",align:"center"},{key:"count",label:"количество",width:"90px",align:"center"},{key:"sqr",label:"площадь",width:"90px",align:"center"},{key:"sqr_stv",label:"площадь створки",width:"90px",align:"center"},{key:"total_time",label:"н/час",width:"90px",align:"center",class:"col-total"}),l&&a.push({key:"type",label:"вид продукции",width:"90px",align:"center"},{key:"systema",label:"система",width:"90px",align:"center"},{key:"type_izd",label:"наименование",width:"90px",align:"center"},{key:"profile",label:"профиль",width:"90px",align:"center"},{key:"count",label:"количество",width:"90px",align:"center"},{key:"sqr",label:"площадь",width:"90px",align:"center"},{key:"total_time",label:"н/час",width:"90px",align:"center",class:"col-total"}),a.push({key:"brigade",label:"изготовитель",width:"80px",align:"center"},{key:"norm_money",label:"Н/руб",width:"80px",align:"center",class:"col-money"}),a}),y=(e,l)=>{const t=e[l];return null===t||void 0===t||""===t?"—":"type"===l?x(t):"number"===typeof t?["sqr","sqr_stv","norm_money","total_time"].includes(l)?parseFloat(t.toFixed(3)):"count"===l?parseInt(t):"coefficient"===l?parseFloat(t.toFixed(3)):t:t},L=(0,f.KR)(["combined"]),b=(0,n.EW)(()=>{const e=[];return L.value.forEach(l=>{const t=k[l];t&&e.push(...t.types)}),e}),C=(0,f.KR)([]),w=(0,f.KR)([]),E=(0,n.EW)(()=>{const e=w.value||[],l=[...e].sort((e,l)=>{const t=e.ready_date?new Date(e.ready_date):new Date(0),a=l.ready_date?new Date(l.ready_date):new Date(0),n=a-t;return 0!==n?n:e.id-l.id}),t=new Map;let a=1;for(const n of l)"main"===n.part_type&&t.set(n.id,a++);return l.map(e=>{let l=0;return"main"===e.part_type?l=t.get(e.id)||0:"sub"===e.part_type&&e.parent_product_id&&(l=t.get(e.parent_product_id)||0),{...e,rowNumber:l}})}),F=(0,n.EW)(()=>{const e=b.value;return 0===e.length?[]:E.value.filter(l=>e.includes(l.type))}),x=e=>{if(!e)return"—";const l={window:"Окно",door:"Дверь",loggia:"Лоджия",vitrage:"Витраж",ms:"Москитная сетка",glyhar:"Глухое окно"};return l[e]||e},X=(e,l)=>{const t=e.employee_value?.[String(l)];return t?parseFloat(t.toFixed(3)):""},V=async()=>{try{const e=new URLSearchParams;b.value.forEach(l=>{e.append("type",l)}),e.append("from",v.value),e.append("to",m.value),e.append("order_num",u.value);const l=await g.A.get(`/api/all_final_order?${e}`);C.value=l.data.employees,w.value=l.data.products}catch(e){console.error("Ошибка загрузки данных:",e)}},U=(0,f.KR)(!1),z=async()=>{U.value=!0;try{const e=new URLSearchParams;b.value.forEach(l=>{e.append("type",l)}),e.append("from",v.value),e.append("to",m.value),e.append("order_num",u.value);const l=await g.A.get("/api/report/excel",{params:e,responseType:"blob"}),t=window.URL.createObjectURL(new Blob([l.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",`report_${(new Date).toLocaleDateString()}.xlsx`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(t)}catch(e){console.error("Ошибка при загрузке Excel:",e),alert("Не удалось скачать файл")}finally{U.value=!1}};return(0,n.sV)(()=>{V()}),(e,l)=>((0,n.uX)(),(0,n.CE)("div",Kt,[(0,n.Lk)("div",It,[(0,n.Lk)("div",Rt,[l[5]||(l[5]=(0,n.Lk)("label",{for:"year-select"},"Год",-1)),(0,n.bo)((0,n.Lk)("select",{id:"year-select","onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),onChange:V,class:"filter-select"},[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)([2023,2024,2025,2026,2027],e=>(0,n.Lk)("option",{key:e},(0,h.v_)(e),1)),64))],544),[[a.u1,t.value]])]),(0,n.Lk)("div",$t,[l[6]||(l[6]=(0,n.Lk)("label",{for:"month-select"},"Месяц",-1)),(0,n.bo)((0,n.Lk)("select",{id:"month-select","onUpdate:modelValue":l[1]||(l[1]=e=>o.value=e),onChange:V,class:"filter-select"},[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(d,(e,l)=>(0,n.Lk)("option",{key:l+1,value:l+1},(0,h.v_)(e),9,qt)),64))],544),[[a.u1,o.value]])]),(0,n.Lk)("div",St,[l[7]||(l[7]=(0,n.Lk)("label",{for:"order-input"},"№ заказа",-1)),(0,n.bo)((0,n.Lk)("input",{id:"order-input",type:"text","onUpdate:modelValue":l[2]||(l[2]=e=>u.value=e),placeholder:"",onInput:V,class:"filter-input"},null,544),[[a.Jo,u.value]])]),(0,n.Lk)("div",{class:"actions"},[(0,n.Lk)("button",{onClick:z,class:"btn-export"}," Экспорт в Excel ")]),(0,n.Lk)("div",Wt,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(k,(e,t)=>(0,n.Lk)("label",{key:t,class:"checkbox-label"},[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",value:t,"onUpdate:modelValue":l[3]||(l[3]=e=>L.value=e),onChange:V,class:"checkbox-input"},null,40,Nt),[[a.lH,L.value]]),(0,n.Lk)("span",Tt,(0,h.v_)(e.label),1)])),64))])]),(0,n.bF)(zt,{products:F.value},null,8,["products"]),r.value?((0,n.uX)(),(0,n.Wv)(vt,{key:0,product:r.value,employees:C.value,onClose:i,onCancel:l[4]||(l[4]=e=>r.value=null)},null,8,["product","employees"])):(0,n.Q3)("",!0),(0,n.Lk)("div",jt,[(0,n.Lk)("table",Jt,[(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[l[8]||(l[8]=(0,n.Lk)("th",null,"Статус",-1)),l[9]||(l[9]=(0,n.Lk)("th",null,"№",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(_.value,(e,l)=>((0,n.uX)(),(0,n.CE)("th",{key:`${e.key}_${l}`,style:(0,h.Tr)({width:e.width,textAlign:e.align||"left"}),class:"dynamic-col"},(0,h.v_)(e.label),5))),128)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(C.value,e=>((0,n.uX)(),(0,n.CE)("th",{key:e.id,class:"employee-col"},(0,h.v_)(e.name),1))),128))])]),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(F.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id,class:"clickable-row",onClick:()=>s(e)},[(0,n.Lk)("td",null,[(0,n.Lk)("span",{class:(0,h.C4)(`status-badge status-${e.status}`)},(0,h.v_)(c(e.status)),3)]),(0,n.Lk)("td",null,(0,h.v_)(e.rowNumber),1),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(_.value,l=>((0,n.uX)(),(0,n.CE)("td",{key:l.key,style:(0,h.Tr)({textAlign:l.align||"left"}),class:(0,h.C4)([l.class,{"cell-empty":"—"===y(e,l.key)}])},(0,h.v_)(y(e,l.key)),7))),128)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(C.value,l=>((0,n.uX)(),(0,n.CE)("td",{key:l.id,class:"employee-col"},(0,h.v_)(X(e,l.id)),1))),128))],8,Ot))),128))])])])]))}};const Pt=(0,_.A)(At,[["__scopeId","data-v-7c6bf5d2"]]);var Dt=Pt;const Qt={class:"admin-panel"},Mt={class:"admin-nav"};var Ht={__name:"AdminPanel",setup(e){return(e,l)=>{const t=(0,n.g2)("router-link"),a=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",Qt,[l[3]||(l[3]=(0,n.Lk)("h1",null,"Админка сервиса нормирования",-1)),(0,n.Lk)("nav",Mt,[(0,n.bF)(t,{to:"/admin/templates"},{default:(0,n.k6)(()=>[...l[0]||(l[0]=[(0,n.eW)("Шаблоны",-1)])]),_:1}),l[2]||(l[2]=(0,n.eW)(" | ",-1)),(0,n.bF)(t,{to:"/admin/peo"},{default:(0,n.k6)(()=>[...l[1]||(l[1]=[(0,n.eW)("ПЭО",-1)])]),_:1})]),(0,n.bF)(a)])}}};const Gt=(0,_.A)(Ht,[["__scopeId","data-v-88b56988"]]);var Bt=Gt;const Yt={class:"admin-templates"},Zt={key:0},ea={key:1,class:"error"},la={key:2,class:"templates-table"},ta={key:3};var aa={__name:"AdminTemplates",setup(e){const l=(0,f.KR)({}),t=(0,f.KR)(!1),a=(0,f.KR)(null),o=(0,b.rd)();async function u(){t.value=!0,a.value=null;try{const e=await fetch("/api/admin/all_templates");if(!e.ok)throw new Error(`HTTP ${e.status}`);l.value=await e.json()}catch(e){console.error("Ошибка загрузки шаблонов:",e),a.value=e.message}finally{t.value=!1}}function r(){o.push("/admin/templates/new")}return(0,n.sV)(()=>{u()}),(e,o)=>{const u=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Yt,[o[2]||(o[2]=(0,n.Lk)("h2",null,"Шаблоны изделий",-1)),(0,n.Lk)("button",{onClick:r,class:"btn btn-primary"},"Создать шаблон"),t.value?((0,n.uX)(),(0,n.CE)("div",Zt,"Загрузка...")):a.value?((0,n.uX)(),(0,n.CE)("div",ea,"Ошибка: "+(0,h.v_)(a.value),1)):(0,n.Q3)("",!0),l.value.Template&&l.value.Template.length?((0,n.uX)(),(0,n.CE)("table",la,[o[1]||(o[1]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Код"),(0,n.Lk)("th",null,"Категория"),(0,n.Lk)("th",null,"Название"),(0,n.Lk)("th",null,"Действия")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.value.Template,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,(0,h.v_)(e.code),1),(0,n.Lk)("td",null,(0,h.v_)(e.category),1),(0,n.Lk)("td",null,(0,h.v_)(e.name),1),(0,n.Lk)("td",null,[(0,n.bF)(u,{to:`/admin/templates/edit/${e.code}`},{default:(0,n.k6)(()=>[...o[0]||(o[0]=[(0,n.eW)("Редактировать",-1)])]),_:1},8,["to"])])]))),128))])])):t.value||l.value.Template&&0!==l.value.Template.length?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",ta," Шаблоны не найдены "))])}}};const na=(0,_.A)(aa,[["__scopeId","data-v-d7f1de8e"]]);var oa=na;const ua={class:"template-edit"},ra={key:0},sa=["onUpdate:modelValue"],ia=["onUpdate:modelValue"],da={class:"template-edit"},pa={key:0},ca=["onUpdate:modelValue"],va=["onUpdate:modelValue"],ma={class:"template-edit"},ka={key:0};var _a={__name:"AdminEditDataPeo",setup(e){const l=(0,f.KR)(!1),t=(0,f.KR)([]),o=(0,f.KR)([]),u=(0,f.KR)({name:"",is_active:!1});async function r(){const e=await fetch("/api/admin/coefficient");if(!e.ok)throw new Error("Ошибка коэффициентов");return await e.json()}async function s(){const e=await fetch("/api/admin/employees");if(!e.ok)throw new Error("Ошибка сотрудников");return await e.json()}async function i(){try{const e=await fetch("/api/admin/coefficient/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.value)});if(!e.ok)throw new Error(`HTTP ${e.status}`)}catch(e){console.log("Коэффициенты не обновлены",e)}}async function d(){try{const e=await fetch("/api/admin/employees/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)});if(!e.ok)throw new Error(`HTTP ${e.status}`)}catch(e){console.log("Коэффициенты не обновлены",e)}}async function p(){try{const e=await fetch("/api/admin/employees/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)});if(!e.ok)throw new Error(`HTTP ${e.status}`)}catch(e){console.log("Новый сотрудник не сохранен",e)}}return(0,n.sV)(async()=>{l.value=!0;try{const[e,l]=await Promise.all([r(),s()]);t.value=e,o.value=l}catch(e){console.log("Ошибка получения данных",e)}finally{l.value=!1}}),(e,r)=>((0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",ua,[r[4]||(r[4]=(0,n.Lk)("h2",null,"Редактирование коэффициентов ПЭО",-1)),l.value?((0,n.uX)(),(0,n.CE)("div",ra,"Загрузка...")):((0,n.uX)(),(0,n.CE)("form",{key:1,onSubmit:(0,a.D$)(i,["prevent"]),class:"operations-table"},[(0,n.Lk)("table",null,[r[2]||(r[2]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Тип изделия"),(0,n.Lk)("th",null,"Коэффициент"),(0,n.Lk)("th",null,"Использовать")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,(0,h.v_)(e.type),1),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{min:"0",step:"0.001","onUpdate:modelValue":l=>e.coefficient=l},null,8,sa),[[a.Jo,e.coefficient,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":l=>e.is_active=l},null,8,ia),[[a.lH,e.is_active]])])]))),128))])]),r[3]||(r[3]=(0,n.Lk)("div",null,[(0,n.Lk)("button",{type:"submit"},"Сохранить")],-1))],32))]),(0,n.Lk)("div",da,[r[7]||(r[7]=(0,n.Lk)("h2",null,"Редактирование сотрудников ПЭО",-1)),l.value?((0,n.uX)(),(0,n.CE)("div",pa,"Загрузка...")):((0,n.uX)(),(0,n.CE)("form",{key:1,onSubmit:(0,a.D$)(d,["prevent"]),class:"operations-table"},[(0,n.Lk)("table",null,[r[5]||(r[5]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"ID"),(0,n.Lk)("th",null,"Имя"),(0,n.Lk)("th",null,"Работает или нет")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.value,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,(0,h.v_)(e.id),1),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.name=l},null,8,ca),[[a.Jo,e.name]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":l=>e.is_active=l},null,8,va),[[a.lH,e.is_active]])])]))),128))])]),r[6]||(r[6]=(0,n.Lk)("div",null,[(0,n.Lk)("button",{type:"submit"},"Сохранить")],-1))],32))]),(0,n.Lk)("div",ma,[r[10]||(r[10]=(0,n.Lk)("h2",null,"Добавить сотрудника",-1)),l.value?((0,n.uX)(),(0,n.CE)("div",ka,"Загрузка...")):((0,n.uX)(),(0,n.CE)("form",{key:1,onSubmit:(0,a.D$)(p,["prevent"]),class:"operations-table"},[(0,n.Lk)("table",null,[r[8]||(r[8]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Имя"),(0,n.Lk)("th",null,"Работает или нет")])],-1)),(0,n.Lk)("tbody",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>u.value.name=e)},null,512),[[a.Jo,u.value.name]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=e=>u.value.is_active=e)},null,512),[[a.lH,u.value.is_active]])])])])]),r[9]||(r[9]=(0,n.Lk)("div",null,[(0,n.Lk)("button",{type:"submit"},"Сохранить")],-1))],32))])],64))}};const ya=_a;var La=ya;const ba={class:"template-edit"},ha={key:0},fa={class:"form-checkbox"},ga={class:"operations-table"},Ca=["onUpdate:modelValue"],wa=["onUpdate:modelValue"],Ea=["onUpdate:modelValue"],Fa=["onUpdate:modelValue"],xa=["onUpdate:modelValue"],Xa=["onUpdate:modelValue"],Va=["onClick"],Ua={class:"form-actions"};var za={__name:"AdminTemplateEdit",setup(e){const l=(0,b.lq)(),t=(0,b.rd)(),o=(0,f.KR)({code:"",name:"",category:"",systema:"",type_izd:"",profile:"",is_active:1,operations:[],rules:null,head_name:""}),u=(0,f.KR)(!1);async function r(e){u.value=!0;try{const l=await fetch(`/api/admin/template?code=${e}`);if(!l.ok)throw new Error(`HTTP ${l.status}`);o.value=await l.json()}catch(l){console.error("Ошибка загрузки шаблона:",l),alert("Не удалось загрузить шаблон"),t.push("/admin/templates")}finally{u.value=!1}}function s(){o.value.operations.push({label:"",name:"",count:0,value:0,minutes:0,group:"",type:"number",required:!0})}function i(e){o.value.operations.splice(e,1)}async function d(){try{const e={...o.value,operations:o.value.operations},t=await fetch(`/api/admin/template/update/${l.params.code}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);alert("Шаблон сохранён")}catch(e){console.error("Ошибка сохранения:",e),alert("Не удалось сохранить шаблон")}}return(0,n.sV)(()=>{const e=l.params.code;e?r(e):s()}),(e,l)=>{const t=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",ba,[l[19]||(l[19]=(0,n.Lk)("h2",null,"Редактирование шаблона",-1)),u.value?((0,n.uX)(),(0,n.CE)("div",ha,"Загрузка...")):((0,n.uX)(),(0,n.CE)("form",{key:1,onSubmit:(0,a.D$)(d,["prevent"])},[(0,n.Lk)("div",null,[l[7]||(l[7]=(0,n.Lk)("label",null,"Название для шаблона:",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.name=e),required:""},null,512),[[a.Jo,o.value.name]])]),(0,n.Lk)("div",fa,[l[8]||(l[8]=(0,n.Lk)("label",{for:"is_active"},"Использовать шаблон",-1)),(0,n.bo)((0,n.Lk)("input",{type:"checkbox",id:"is_active","onUpdate:modelValue":l[1]||(l[1]=e=>o.value.is_active=e)},null,512),[[a.lH,o.value.is_active]])]),(0,n.Lk)("div",null,[l[10]||(l[10]=(0,n.Lk)("label",null,"Категория:",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.category=e)},[...l[9]||(l[9]=[(0,n.Lk)("option",{value:"window"},"Окно",-1),(0,n.Lk)("option",{value:"door"},"Дверь",-1),(0,n.Lk)("option",{value:"glyhar"},"Гляхарь",-1)])],512),[[a.u1,o.value.category]])]),(0,n.Lk)("div",null,[l[11]||(l[11]=(0,n.Lk)("label",null,"Система(т-теплая,х-холодная, писать т или х):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.systema=e)},null,512),[[a.Jo,o.value.systema]])]),(0,n.Lk)("div",null,[l[12]||(l[12]=(0,n.Lk)("label",null,"Тип изделия(окно гл., окно пов.-отк., 1П, 1.5П,2П,1Пт,1.5Пт,2Пт):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.type_izd=e)},null,512),[[a.Jo,o.value.type_izd]])]),(0,n.Lk)("div",null,[l[13]||(l[13]=(0,n.Lk)("label",null,"Профиль(сх,ст,ах,ат,ш):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.profile=e)},null,512),[[a.Jo,o.value.profile]])]),(0,n.Lk)("div",null,[l[14]||(l[14]=(0,n.Lk)("label",null,"Заголовок для страницы печати(изготовление П-образ системы Алютех):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[6]||(l[6]=e=>o.value.head_name=e)},null,512),[[a.Jo,o.value.head_name]])]),l[18]||(l[18]=(0,n.Lk)("h3",null,"Операции",-1)),(0,n.Lk)("table",ga,[l[15]||(l[15]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",{class:"col-label"},"Название"),(0,n.Lk)("th",null,"Название транскрипт"),(0,n.Lk)("th",null,"Количество"),(0,n.Lk)("th",null,"Значения(н/ч)"),(0,n.Lk)("th",null,"Значения(н/м)"),(0,n.Lk)("th",null,"Группа"),(0,n.Lk)("th")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.value.operations,(e,l)=>((0,n.uX)(),(0,n.CE)("tr",{key:l},[(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.label=l},null,8,Ca),[[a.Jo,e.label]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.name=l},null,8,wa),[[a.Jo,e.name]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"number",step:"1",min:"0","onUpdate:modelValue":l=>e.count=l},null,8,Ea),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.value=l},null,8,Fa),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.minutes=l},null,8,xa),[[a.Jo,e.minutes,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.group=l},null,8,Xa),[[a.Jo,e.group]])]),(0,n.Lk)("td",null,[(0,n.Lk)("button",{type:"button",onClick:e=>i(l)},"Удалить",8,Va)])]))),128))])]),(0,n.Lk)("button",{type:"button",onClick:s,class:"btn"},"+ Добавить операцию"),(0,n.Lk)("div",Ua,[l[17]||(l[17]=(0,n.Lk)("button",{type:"submit"},"Сохранить",-1)),(0,n.bF)(t,{to:"/admin/templates",class:"btn btn-outline"},{default:(0,n.k6)(()=>[...l[16]||(l[16]=[(0,n.eW)("Отмена",-1)])]),_:1})])],32))])}}};const Ka=(0,_.A)(za,[["__scopeId","data-v-af3c87c4"]]);var Ia=Ka;const Ra={class:"template-edit"},$a={key:0},qa={class:"form-checkbox"},Sa={class:"operations-table"},Wa=["onUpdate:modelValue"],Na=["onUpdate:modelValue"],Ta=["onUpdate:modelValue"],ja=["onUpdate:modelValue"],Ja=["onUpdate:modelValue"],Oa=["onUpdate:modelValue"],Aa=["onClick"],Pa={class:"form-actions"};var Da={__name:"AdminTemplateCreate",setup(e){const l=(0,b.rd)(),t=(0,f.KR)({code:"",name:"",category:"",systema:"",type_izd:"",profile:"",is_active:1,operations:[],rules:null,head_name:""}),o=(0,f.KR)(!1);function u(){t.value.operations.push({label:"",name:"",count:0,value:0,minutes:0,group:"",type:"number",required:!1})}function r(e){t.value.operations.splice(e,1)}async function s(){try{const e={...t.value,operations:t.value.operations},a=await fetch("/api/admin/template/new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error(`HTTP ${a.status}`);alert("Шаблон сохранён"),l.push("/admin/templates")}catch(e){console.error("Ошибка сохранения:",e),alert("Не удалось сохранить шаблон")}}return(0,n.sV)(()=>{u()}),(e,l)=>{const i=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Ra,[l[21]||(l[21]=(0,n.Lk)("h2",null,"Создание нового шаблона",-1)),o.value?((0,n.uX)(),(0,n.CE)("div",$a,"Загрузка...")):((0,n.uX)(),(0,n.CE)("form",{key:1,onSubmit:(0,a.D$)(s,["prevent"])},[(0,n.Lk)("div",null,[l[8]||(l[8]=(0,n.Lk)("label",null,"Код шаблона",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.code=e),required:""},null,512),[[a.Jo,t.value.code]])]),(0,n.Lk)("div",null,[l[9]||(l[9]=(0,n.Lk)("label",null,"Название для шаблона:",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.name=e),required:""},null,512),[[a.Jo,t.value.name]])]),(0,n.Lk)("div",qa,[l[10]||(l[10]=(0,n.Lk)("label",{for:"is_active"},"Использовать шаблон",-1)),(0,n.bo)((0,n.Lk)("input",{type:"checkbox",id:"is_active","onUpdate:modelValue":l[2]||(l[2]=e=>t.value.is_active=e)},null,512),[[a.lH,t.value.is_active]])]),(0,n.Lk)("div",null,[l[12]||(l[12]=(0,n.Lk)("label",null,"Категория:",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.category=e)},[...l[11]||(l[11]=[(0,n.Fv)('<option value="window" data-v-32e9f67a>Окно</option><option value="door" data-v-32e9f67a>Дверь</option><option value="glyhar" data-v-32e9f67a>Гляхарь</option><option value="vitrage" data-v-32e9f67a>Витраж</option><option value="loggia" data-v-32e9f67a>Лоджия</option>',5)])],512),[[a.u1,t.value.category]])]),(0,n.Lk)("div",null,[l[13]||(l[13]=(0,n.Lk)("label",null,"Система(т-теплая,х-холодная, писать т или х):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.systema=e)},null,512),[[a.Jo,t.value.systema]])]),(0,n.Lk)("div",null,[l[14]||(l[14]=(0,n.Lk)("label",null,"Тип изделия(окно гл., окно пов.-отк., 1П, 1.5П,2П,1Пт,1.5Пт,2Пт):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.type_izd=e)},null,512),[[a.Jo,t.value.type_izd]])]),(0,n.Lk)("div",null,[l[15]||(l[15]=(0,n.Lk)("label",null,"Профиль(сх,ст,ах,ат,ш):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.profile=e)},null,512),[[a.Jo,t.value.profile]])]),(0,n.Lk)("div",null,[l[16]||(l[16]=(0,n.Lk)("label",null,"Заголовок для страницы печати(изготовление П-образ системы Алютех):",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[7]||(l[7]=e=>t.value.head_name=e)},null,512),[[a.Jo,t.value.head_name]])]),l[20]||(l[20]=(0,n.Lk)("h3",null,"Операции",-1)),(0,n.Lk)("table",Sa,[l[17]||(l[17]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",{class:"col-label"},"Название"),(0,n.Lk)("th",null,"Название транскрипт"),(0,n.Lk)("th",null,"Количество"),(0,n.Lk)("th",null,"Значения(н/ч)"),(0,n.Lk)("th",null,"Значения(н/м)"),(0,n.Lk)("th",null,"Группа"),(0,n.Lk)("th")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value.operations,(e,l)=>((0,n.uX)(),(0,n.CE)("tr",{key:l},[(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.label=l},null,8,Wa),[[a.Jo,e.label]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.name=l},null,8,Na),[[a.Jo,e.name]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"number",step:"1",min:"0","onUpdate:modelValue":l=>e.count=l},null,8,Ta),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.value=l},null,8,ja),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.minutes=l},null,8,Ja),[[a.Jo,e.minutes,void 0,{number:!0}]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l=>e.group=l},null,8,Oa),[[a.Jo,e.group]])]),(0,n.Lk)("td",null,[(0,n.Lk)("button",{type:"button",onClick:e=>r(l)},"Удалить",8,Aa)])]))),128))])]),(0,n.Lk)("button",{type:"button",onClick:u,class:"btn"},"+ Добавить операцию"),(0,n.Lk)("div",Pa,[l[19]||(l[19]=(0,n.Lk)("button",{type:"submit"},"Сохранить",-1)),(0,n.bF)(i,{to:"/admin/templates",class:"btn btn-outline"},{default:(0,n.k6)(()=>[...l[18]||(l[18]=[(0,n.eW)("Отмена",-1)])]),_:1})])],32))])}}};const Qa=(0,_.A)(Da,[["__scopeId","data-v-32e9f67a"]]);var Ma=Qa;const Ha=[{path:"/orders",name:"OrdersList",component:K},{path:"/orders/order-norm/:orderNum",name:"OrdersDetails",component:we,props:!0},{path:"/orders/order-norm/form/:orderNum/:position",name:"FormSendPeo",component:ve},{path:"/norm/order-norm/print/:id/:orderNum",name:"FormPrintNorm",component:Me},{path:"/norm/orders",name:"NormOrdersList",component:il},{path:"/norm/orders/order-norm/edit/:id",name:"EditNormOrder",component:xl},{path:"/norm/workers/:id",name:"AssignWorkers",component:Ql},{path:"/final/orders",name:"FinalNormOrdersList",component:Dt},{path:"/admin",component:Bt,children:[{path:"",redirect:"admin/templates"},{path:"templates",component:oa},{path:"peo",component:La}]},{path:"/admin/templates/edit/:code",name:"AdminTemplateEdit",component:Ia},{path:"/admin/templates/new",name:"AdminTemplateCreate",component:Ma}],Ga=(0,b.aE)({history:(0,b.LA)(),routes:Ha});var Ba=Ga;const Ya=(0,a.Ef)(L);Ya.use(Ba),Ya.mount("#app")}},l={};function t(a){var n=l[a];if(void 0!==n)return n.exports;var o=l[a]={exports:{}};return e[a].call(o.exports,o,o.exports,t),o.exports}t.m=e,function(){var e=[];t.O=function(l,a,n,o){if(!a){var u=1/0;for(d=0;d<e.length;d++){a=e[d][0],n=e[d][1],o=e[d][2];for(var r=!0,s=0;s<a.length;s++)(!1&o||u>=o)&&Object.keys(t.O).every(function(e){return t.O[e](a[s])})?a.splice(s--,1):(r=!1,o<u&&(u=o));if(r){e.splice(d--,1);var i=n();void 0!==i&&(l=i)}}return l}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,n,o]}}(),function(){t.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(l,{a:l}),l}}(),function(){t.d=function(e,l){for(var a in l)t.o(l,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:l[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){var e={524:0};t.O.j=function(l){return 0===e[l]};var l=function(l,a){var n,o,u=a[0],r=a[1],s=a[2],i=0;if(u.some(function(l){return 0!==e[l]})){for(n in r)t.o(r,n)&&(t.m[n]=r[n]);if(s)var d=s(t)}for(l&&l(a);i<u.length;i++)o=u[i],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(d)},a=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];a.forEach(l.bind(null,0)),a.push=l.bind(null,a.push.bind(a))}();var a=t.O(void 0,[504],function(){return t(485)});a=t.O(a)})();
//# sourceMappingURL=app.ad2ebe41.js.map