(function(){"use strict";var e={3084:function(e,l,t){var a=t(5130),o=t(6768),n=t.p+"img/logo_pasport_new.62978c94.jpg";const u={id:"app"},r={class:"navbar no-print"},s={class:"nav-container"},i={class:"nav-menu"},d={class:"nav-item"},p={class:"nav-item"},c={class:"nav-item"},v={class:"main-content"};function m(e,l,t,a,m,k){const y=(0,o.g2)("router-link"),L=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",u,[(0,o.Lk)("nav",r,[(0,o.Lk)("div",s,[l[3]||(l[3]=(0,o.Lk)("div",{class:"nav-logo"},[(0,o.Lk)("img",{src:n,alt:"Логотип NormApp",class:"logo-img"}),(0,o.Lk)("span")],-1)),(0,o.Lk)("ul",i,[(0,o.Lk)("li",d,[(0,o.bF)(y,{to:"/orders",class:"nav-link"},{default:(0,o.k6)(()=>l[0]||(l[0]=[(0,o.eW)("Заказы из ДЕМА")])),_:1,__:[0]})]),(0,o.Lk)("li",p,[(0,o.bF)(y,{to:"/norm/orders/",class:"nav-link"},{default:(0,o.k6)(()=>l[1]||(l[1]=[(0,o.eW)("Нормированные наряды")])),_:1,__:[1]})]),(0,o.Lk)("li",c,[(0,o.bF)(y,{to:"/final/orders/",class:"nav-link"},{default:(0,o.k6)(()=>l[2]||(l[2]=[(0,o.eW)("Отчёты для ПЭО")])),_:1,__:[2]})])])])]),(0,o.Lk)("main",v,[(0,o.bF)(L)])])}var k={name:"App"},y=t(1241);const L=(0,y.A)(k,[["render",m]]);var _=L,h=t(1387),b=(t(4114),t(4232)),f=t(144),g=t(4373);const C={class:"orders-page"},w={class:"filters"},F=["value"],E={key:0,class:"table-container"},x=["onClick"],X={key:1,class:"error"},z={key:2,class:"no-orders"};var V={__name:"OrdersList",setup(e){const l=(0,h.rd)(),t=(0,f.KR)([]),n=(0,f.KR)(""),u=(0,f.KR)((new Date).getFullYear()),r=(0,f.KR)((new Date).getMonth()+1),s=(0,f.KR)(""),i=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];async function d(){try{t.value=[],n.value="";const e={};s.value?e.search=s.value:(e.year=u.value,e.month=r.value);const l=await g.A.get("http://localhost:8080/api/orders",{params:e});l.data.error?n.value=l.data.error:t.value=l.data.orders}catch(e){n.value="Не удалось загрузить заказы.",console.error(e)}}function p(e){l.push({name:"OrdersDetails",params:{id:e}})}return(0,o.sV)(()=>{d()}),(0,o.wB)([u,r,s],()=>{d()}),(e,l)=>((0,o.uX)(),(0,o.CE)("div",C,[l[7]||(l[7]=(0,o.Lk)("h1",null,"Заказы",-1)),(0,o.Lk)("div",w,[(0,o.Lk)("div",null,[l[3]||(l[3]=(0,o.Lk)("label",null,"Год:",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),type:"number",min:"2020",max:"2030"},null,512),[[a.Jo,u.value,void 0,{number:!0}]])]),(0,o.Lk)("div",null,[l[4]||(l[4]=(0,o.Lk)("label",null,"Месяц:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>r.value=e)},[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(i,(e,l)=>(0,o.Lk)("option",{key:l+1,value:l+1},(0,b.v_)(e),9,F)),64))],512),[[a.u1,r.value]])]),(0,o.Lk)("div",null,[l[5]||(l[5]=(0,o.Lk)("label",null,"Поиск:",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>s.value=e),placeholder:"Поиск по номеру..."},null,512),[[a.Jo,s.value]])])]),t.value&&t.value.length>0?((0,o.uX)(),(0,o.CE)("div",E,[(0,o.Lk)("table",null,[l[6]||(l[6]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Заказ"),(0,o.Lk)("th",null,"Заказчик"),(0,o.Lk)("th",null,"Примечание")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id,onClick:l=>p(e.id),style:{cursor:"pointer"}},[(0,o.Lk)("td",null,(0,b.v_)(e.order_num),1),(0,o.Lk)("td",null,(0,b.v_)(e.customer),1),(0,o.Lk)("td",null,(0,b.v_)(e.ms_note),1)],8,x))),128))])])])):n.value?((0,o.uX)(),(0,o.CE)("div",X,(0,b.v_)(n.value),1)):((0,o.uX)(),(0,o.CE)("div",z,"Заказы не найдены"))]))}};const U=(0,y.A)(V,[["__scopeId","data-v-95f0778a"]]);var I=U;t(8111),t(2489),t(116),t(7588),t(1701),t(8237),t(4603),t(7566),t(8721);const K={class:"form-container"},q={class:"card-info"},R={key:0,class:"image-preview-container"},$=["src"],S=["src"],W={class:"composite-toggle"},J={key:1,class:"parent-selection"},N=["value"],O={key:0,class:"text-muted"},T={class:"parent-selection"},A={class:"forms-section"},D={class:"category-title"},j={class:"templates-list"},P=["onClick"],Q={key:2,class:"full-form"},M={class:"part-type-badge"},H={key:0},B={class:"total-summary"},G={key:0,class:"calculation-info"},Y={class:"norm-table"},Z=["value","onInput"],ee=["value","disabled","onInput"],le={class:"text-center"},te={class:"form-actions"},ae=["disabled"],oe=["disabled"];var ne={__name:"FormSendPeo",setup(e){const l=(0,h.lq)(),t=`orderDetail_${l.params.id}_${l.query.position}`,n=(0,f.KR)({order_num:"Неизвестно",name:"Неизвестно",count:0,color:"Не указан",image:"",customer:"Не указан",sqr:0,position:""});(0,o.sV)(()=>{const e=sessionStorage.getItem(t);if(e){const l=JSON.parse(e);return void(n.value={...l})}const a={order_num:l.query.order_num||"Неизвестно",name:l.query.name||"Неизвестно",count:parseInt(l.query.count)||1,color:l.query.color||"Не указан",customer:l.query.customer||"Не указан",sqr:parseFloat(l.query.sqr)||0,position:l.query.position||"",image:l.query.image||""};sessionStorage.setItem(t,JSON.stringify(a)),n.value=a;const o={...l.query};delete o.image,window.history.replaceState({},"",`${location.pathname}?${new URLSearchParams(o).toString()}`)});const u=(0,f.KR)([]),r=(0,f.KR)(null),s=(0,f.KR)(!1),i=(0,f.KR)(!1),d=(0,f.KR)(!1),p=(0,f.KR)(null),c=(0,f.KR)([]),v=(0,f.KR)(null),m=(0,f.KR)(null),k=(0,f.KR)(!1),y=(0,f.KR)(""),L=(0,f.KR)(""),_={window:"Окна",glyhar:"Глухари",loggia:"Лоджии",vitrage:"Витражи",door:"Двери"};(0,o.wB)(d,async e=>{if(e&&n.value.order_num)try{const e=await fetch(`http://localhost:8080/api/orders/order-norm/by-order?order_num=${n.value.order_num}`);if(e.ok){const l=await e.json();c.value=l.filter(e=>"main"===e.part_type)}else c.value=[]}catch(l){console.error("Ошибка загрузки родителей:",l),c.value=[]}else p.value=null});const g=(0,o.EW)(()=>{const e={},l=Object.keys(_);return l.forEach(l=>{e[l]=[]}),u.value?.Template?.forEach(t=>{const a=t.category?.toLowerCase().trim();l.includes(a)&&e[a].push(t)}),Object.keys(e).forEach(l=>{0===e[l].length&&delete e[l]}),e});(0,o.sV)(async()=>{try{const e=await fetch("http://localhost:8080/api/all_templates");if(!e.ok)throw new Error("Не удалось загрузить шаблоны");u.value=await e.json()}catch(e){console.error("Ошибка загрузки шаблонов:",e),alert("Не удалось загрузить шаблоны. Проверьте подключение.")}});const C=(0,o.EW)(()=>r.value?.operations?.reduce((e,l)=>"number"===typeof l.dynamicValue?e+l.dynamicValue:e,0).toFixed(3)||"0.000"),w=(0,o.EW)(()=>Math.round(60*parseFloat(C.value)));function F(e,l){const t=parseFloat(l);if(isNaN(t))return;const a=r.value.operations[e];a.dynamicValue=t,a.count>0?a.rate=t/a.count:a.rate=t,a.minutes=Number(60*a.dynamicValue).toFixed(1)}function E(e,l){const t=parseFloat(l);if(isNaN(t))return;const a=r.value.operations[e];a.count=t;const o=a.group;if(!o)return a.dynamicValue=t*a.rate,void(a.minutes=parseFloat((60*a.dynamicValue).toFixed(1)));const n=r.value.operations.filter(e=>e.group===o);n.forEach(e=>{e.count=t,e.dynamicValue=t*e.rate,e.minutes=parseFloat((60*e.dynamicValue).toFixed(1))})}function x(){const e=parseInt(n.value?.count)||1;r.value?.operations&&r.value.operations.forEach(l=>{if(l.group&&["ign"].includes(l.group))return void(l.count=1);const t=l.count;l.count=t*e,l.dynamicValue=l.count*l.rate,l.minutes=parseFloat((60*l.dynamicValue).toFixed(1))})}async function X(e){s.value=!0;try{const l=await fetch(`http://localhost:8080/api/template?code=${e.code}`);if(!l.ok)throw new Error("Не удалось загрузить форму");r.value=await l.json(),r.value.type=e.category,r.value.code=e.code,d.value&&p.value?(r.value.part_type="sub",r.value.parent_product_id=p.value):(r.value.part_type="main",r.value.parent_product_id=null),r.value.operations=r.value.operations.map(e=>({...e,count:e.count??0,baseValue:e.value??0,rate:e.value??0,dynamicValue:(e.count??0)*(e.value??0)}));const t={};r.value.operations.forEach(e=>{e.group&&(t[e.group]=t[e.group]||[],t[e.group].push(e))}),r.value.operationsByGroup=t,m.value=e.code}catch(l){console.error("Ошибка загрузки формы:",l),alert("Не удалось загрузить форму. Попробуйте снова.")}finally{s.value=!1}}function z(){const e=r.value.operations.filter(e=>"number"===typeof e.dynamicValue&&e.dynamicValue>0).map(e=>({operation_name:e.name,operation_label:e.label,count:parseFloat(e.count),value:parseFloat(e.dynamicValue.toFixed(3)),minutes:parseFloat(e.minutes)})),l=e.reduce((e,l)=>e+l.value,0),t={order_num:n.value.order_num,name:n.value.name,template_code:r.value.code,count:n.value.count,type:r.value.type,part_type:r.value.part_type,parent_product_id:r.value.parent_product_id,parent_assembly:y.value,total_time:parseFloat(l.toFixed(3)),position:parseInt(n.value.position),customer:n.value.customer,operations:e,status:"in_production",systema:r.value.systema,type_izd:L.value||r.value.type_izd,profile:r.value.profile,sqr:parseFloat(n.value.sqr)};fetch("http://localhost:8080/api/orders/order-norm/template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{if(!e.order_id)return void console.warn("Ошибка: не получен ID наряда",e.order_id);let l;"main"===r.value.part_type?(l=e.order_id,v.value=l):(l=v.value,l||(console.warn("lastRootId не установлен, используем текущий ID"),l=e.order_id));const t=confirm(`Нормировка "${r.value.name}" сохранена!\n\nХотите добавить ещё одну часть?`);if(t)r.value=null;else{const l="main"===r.value.part_type?e.order_id:v.value||e.order_id;Aa.push(`/norm/order-norm/print/${l}`),i.value=!0}}).catch(e=>{console.error("Ошибка сохранения:",e),alert("Не удалось сохранить нормировку")})}const V=(0,f.KR)(null);async function U(){if(r.value&&n.value.order_num&&n.value.position){s.value=!0;try{const e=r.value.type,l=await fetch("http://localhost:8080/api/materials/ubub",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_num:n.value.order_num,position:parseInt(n.value.position),type:e,template:r.value.code})});if(console.log("RESP",l),!l.ok){const e=await l.text();throw new Error(`Ошибка расчёта: ${l.status} — ${e}`)}const t=await l.json();V.value=t.context;const a=r.value.operations.map(e=>{const l=t.operation.find(l=>l.name===e.name);return l?{...e,count:l.count??e.count,dynamicValue:l.value??e.dynamicValue,minutes:l.minutes??e.minutes}:e});a.forEach(e=>{e.count>0?e.rate=e.dynamicValue/e.count:e.rate=e.dynamicValue}),r.value.operations=a;const o=a.reduce((e,l)=>e+l.dynamicValue,0);r.value.total_time=parseFloat(o.toFixed(3))}catch(e){console.error("Ошибка автоматического расчёта:",e),alert(`Не удалось рассчитать нормы: ${e.message}`)}finally{s.value=!1}}else alert("Недостаточно данных для расчёта")}return(e,l)=>((0,o.uX)(),(0,o.CE)("div",K,[(0,o.Lk)("h2",null,"Форма нормировки — изделие «"+(0,b.v_)(n.value.name)+"»",1),(0,o.Lk)("div",q,[(0,o.Lk)("p",null,[l[9]||(l[9]=(0,o.Lk)("strong",null,"Номер заказа:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value.order_num),1)]),(0,o.Lk)("p",null,[l[10]||(l[10]=(0,o.Lk)("strong",null,"Позиция:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value.position),1)]),(0,o.Lk)("p",null,[l[11]||(l[11]=(0,o.Lk)("strong",null,"Количество:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value.count),1)]),(0,o.Lk)("p",null,[l[12]||(l[12]=(0,o.Lk)("strong",null,"Цвет:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value.color),1)]),(0,o.Lk)("p",null,[l[13]||(l[13]=(0,o.Lk)("strong",null,"Заказчик:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value.customer),1)]),(0,o.Lk)("p",null,[l[14]||(l[14]=(0,o.Lk)("strong",null,"Площадь:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value.sqr)+" м²",1)]),n.value.image?((0,o.uX)(),(0,o.CE)("div",R,[(0,o.Lk)("img",{src:`data:image/png;base64,${n.value.image}`,alt:"Изображение заказа",class:"order-image clickable",onClick:l[0]||(l[0]=e=>k.value=!0),title:"Нажмите, чтобы увеличить"},null,8,$)])):(0,o.Q3)("",!0)]),k.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"image-modal",onClick:l[3]||(l[3]=e=>k.value=!1)},[(0,o.Lk)("div",{class:"modal-content",onClick:l[2]||(l[2]=(0,a.D$)(()=>{},["stop"]))},[(0,o.Lk)("img",{src:`data:image/png;base64,${n.value.image}`,alt:"Увеличенное изображение",class:"enlarged-image"},null,8,S),(0,o.Lk)("button",{class:"close-btn",onClick:l[1]||(l[1]=e=>k.value=!1)},"×")])])):(0,o.Q3)("",!0),(0,o.Lk)("div",W,[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=e=>d.value=e)},null,512),[[a.lH,d.value]]),l[15]||(l[15]=(0,o.eW)(" Это составная часть (витраж к двери(двери с глухарем) и тп) "))])]),d.value?((0,o.uX)(),(0,o.CE)("div",J,[l[21]||(l[21]=(0,o.Lk)("label",null,[(0,o.Lk)("strong",null,"Привязать к:")],-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[5]||(l[5]=e=>p.value=e),class:"form-control",required:""},[l[16]||(l[16]=(0,o.Lk)("option",{value:"",disabled:""},"Выберите основное изделие...",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(c.value,e=>((0,o.uX)(),(0,o.CE)("option",{key:e.id,value:e.id},(0,b.v_)(e.name),9,N))),128))],512),[[a.u1,p.value]]),0===c.value.length?((0,o.uX)(),(0,o.CE)("p",O," Нет доступных основных изделий. Сначала добавьте основное (дверь, окно и т.п.). ")):(0,o.Q3)("",!0),(0,o.Lk)("div",T,[l[19]||(l[19]=(0,o.Lk)("label",{class:"form-control"},[(0,o.Lk)("strong",null,"Уточнение для части:")],-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[6]||(l[6]=e=>y.value=e),class:"form-custom-select"},l[17]||(l[17]=[(0,o.Lk)("option",{value:""},"— выберите —",-1),(0,o.Lk)("option",{value:"с глухарем"},"с глухарем",-1)]),512),[[a.u1,y.value]]),l[20]||(l[20]=(0,o.Lk)("label",{class:"form-control"},[(0,o.Lk)("strong",null,"Наименование:")],-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[7]||(l[7]=e=>L.value=e),class:"form-custom-select"},l[18]||(l[18]=[(0,o.Lk)("option",{value:""},"— выберите —",-1),(0,o.Lk)("option",{value:"витраж к двери"},"витраж к двери",-1)]),512),[[a.u1,L.value]])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",A,[l[22]||(l[22]=(0,o.Lk)("h4",null,"Выберите тип изделия",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(g.value,(e,l)=>((0,o.uX)(),(0,o.CE)("div",{key:l,class:"category-group"},[(0,o.Lk)("h5",D,(0,b.v_)(_[l]),1),(0,o.Lk)("ul",j,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e,e=>((0,o.uX)(),(0,o.CE)("li",{key:e.code,onClick:l=>X(e),class:(0,b.C4)(["template-item",{selected:m.value===e.code}])},(0,b.v_)(e.name),11,P))),128))])]))),128))]),r.value?((0,o.uX)(),(0,o.CE)("div",Q,[(0,o.Lk)("h3",null,(0,b.v_)(r.value.name),1),(0,o.Lk)("div",M,[l[23]||(l[23]=(0,o.eW)(" Тип: ")),(0,o.Lk)("strong",null,(0,b.v_)("main"===r.value.part_type?"Основное изделие":"Составная часть"),1),r.value.parent_product_id?((0,o.uX)(),(0,o.CE)("span",H," (привязано к наряду ID="+(0,b.v_)(r.value.parent_product_id)+") ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",B,[l[24]||(l[24]=(0,o.Lk)("strong",null,"Итого:",-1)),(0,o.eW)(" "+(0,b.v_)(C.value)+" ч ("+(0,b.v_)(w.value)+" мин) ",1)]),V.value?((0,o.uX)(),(0,o.CE)("div",G,[(0,o.Lk)("small",null,"Импостов в материалах найдено: "+(0,b.v_)(V.value.ImpostCount),1)])):(0,o.Q3)("",!0),(0,o.Lk)("table",Y,[l[25]||(l[25]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Операция"),(0,o.Lk)("th",null,"Норма (ч)"),(0,o.Lk)("th",null,"Кол-во"),(0,o.Lk)("th",null,"Норма (мин)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.value.operations,(e,l)=>((0,o.uX)(),(0,o.CE)("tr",{key:e.name},[(0,o.Lk)("td",null,(0,b.v_)(e.label),1),(0,o.Lk)("td",null,[(0,o.Lk)("input",{type:"number",step:"0.01",min:"0",value:e.dynamicValue,class:"input-small",onInput:e=>F(l,e.target.value)},null,40,Z)]),(0,o.Lk)("td",null,[(0,o.Lk)("input",{type:"number",step:"1",min:"0",value:e.count,class:"input-small",disabled:"ign"===e.group,onInput:e=>E(l,e.target.value)},null,40,ee)]),(0,o.Lk)("td",le,(0,b.v_)(e.minutes),1)]))),128))])]),(0,o.Lk)("div",te,[(0,o.Lk)("button",{type:"button",class:"multiply-count-btn",onClick:l[8]||(l[8]=e=>x())}," Умножить на кол-во изделий ("+(0,b.v_)(n.value.count)+") ",1),(0,o.Lk)("button",{type:"button",onClick:U,disabled:!m.value||s.value,class:"btn-recalculate"}," Рассчитать нормы по материалам ",8,ae),(0,o.Lk)("button",{onClick:z,disabled:s.value,class:"btn-save"},(0,b.v_)(s.value?"Сохраняем...":"Сохранить нормировку"),9,oe)])])):(0,o.Q3)("",!0)]))}};const ue=(0,y.A)(ne,[["__scopeId","data-v-6a0b220e"]]);var re=ue;const se={key:0},ie={key:1,class:"error"},de={key:2},pe={class:"plans-container"},ce=["onClick"],ve=["src"],me={class:"plan-details"},ke={key:3};var ye={__name:"OrdersDetails",setup(e){const l=(0,h.lq)(),t=(0,h.rd)(),a=(0,f.KR)(!0),n=(0,f.KR)(null),u=(0,f.KR)(null),r=l.params.id;async function s(){try{const e=await g.A.get(`http://localhost:8080/api/orders/order/${r}`);u.value=e.data}catch(e){console.error("Ошибка при получении деталей заказа:",e),n.value="Не удалось загрузить детали заказа."}finally{a.value=!1}}function i(){t.go(-1)}function d(e){const l={order_num:u.value.order_num,name:e.name_position,count:e.count,color:e.color,customer:u.value.customer,sqr:e.sqr,image:e.image,position:e.position},a=`orderDetail_${u.value.id}_${e.position}`;sessionStorage.setItem(a,JSON.stringify(l)),t.push({name:"FormPagePeo",params:{id:e.plan_id},query:{position:e.position,fromStorage:"true"}})}return(0,o.sV)(()=>{s()}),(e,l)=>((0,o.uX)(),(0,o.CE)("div",null,[l[9]||(l[9]=(0,o.Lk)("h2",null,"Детали коммерческого приложения",-1)),a.value?((0,o.uX)(),(0,o.CE)("div",se,l[0]||(l[0]=[(0,o.Lk)("p",null,"Loading...",-1)]))):n.value?((0,o.uX)(),(0,o.CE)("div",ie,[(0,o.Lk)("p",null,(0,b.v_)(n.value),1)])):u.value?((0,o.uX)(),(0,o.CE)("div",de,[(0,o.Lk)("p",null,[l[1]||(l[1]=(0,o.Lk)("strong",null,"Номер заказа:",-1)),(0,o.eW)(" "+(0,b.v_)(u.value.order_num),1)]),(0,o.Lk)("div",null,[l[7]||(l[7]=(0,o.Lk)("h1",null,"Изделия",-1)),(0,o.Lk)("div",pe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value.order_dem_price,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,onClick:l=>d(e),class:"plan-item"},[(0,o.Lk)("img",{src:`data:image/png;base64,${e.image}`,width:"120",alt:"Order Image"},null,8,ve),(0,o.Lk)("div",me,[(0,o.Lk)("p",null,[l[2]||(l[2]=(0,o.Lk)("strong",null,"Позиция:",-1)),(0,o.eW)(" "+(0,b.v_)(e.position),1)]),(0,o.Lk)("p",null,[l[3]||(l[3]=(0,o.Lk)("strong",null,"Название:",-1)),(0,o.eW)(" "+(0,b.v_)(e.name_position),1)]),(0,o.Lk)("p",null,[l[4]||(l[4]=(0,o.Lk)("strong",null,"Количество:",-1)),(0,o.eW)(" "+(0,b.v_)(e.count),1)]),(0,o.Lk)("p",null,[l[5]||(l[5]=(0,o.Lk)("strong",null,"Цвет:",-1)),(0,o.eW)(" "+(0,b.v_)(e.color),1)]),(0,o.Lk)("p",null,[l[6]||(l[6]=(0,o.Lk)("strong",null,"Площадь:",-1)),(0,o.eW)(" "+(0,b.v_)(e.sqr),1)])])],8,ce))),128))])]),(0,o.Lk)("button",{onClick:i},"Назад")])):((0,o.uX)(),(0,o.CE)("div",ke,l[8]||(l[8]=[(0,o.Lk)("p",null,"Детали заказа не найдены",-1)])))]))}};const Le=(0,y.A)(ye,[["__scopeId","data-v-170de04a"]]);var _e=Le;const he={class:"additional-ops"},be={class:"operations-table"};function fe(e,l){return(0,o.uX)(),(0,o.CE)("div",he,[l[3]||(l[3]=(0,o.Lk)("h3",{class:"additional-ops-label"},[(0,o.Lk)("label",null,"Доп работы")],-1)),(0,o.Lk)("table",be,[l[2]||(l[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",{width:"40%"},"Операция"),(0,o.Lk)("th",{width:"10%"},"Норма н/час"),(0,o.Lk)("th",{width:"10%"},"Норма н/мин"),(0,o.Lk)("th",null,"ФИО исполнителя")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(3,e=>(0,o.Lk)("tr",{key:e},l[0]||(l[0]=[(0,o.Lk)("td",null," ",-1),(0,o.Lk)("td",null," ",-1),(0,o.Lk)("td",null," ",-1),(0,o.Lk)("td",null," ",-1)]))),64)),l[1]||(l[1]=(0,o.Lk)("tr",{class:"total-row"},[(0,o.Lk)("td",{colspan:"3",class:"text-right"},[(0,o.Lk)("strong",null,"Итого доп. работ:")]),(0,o.Lk)("td")],-1))])])])}const ge={},Ce=(0,y.A)(ge,[["render",fe],["__scopeId","data-v-cb0b450e"]]);var we=Ce;const Fe={class:"print-container"},Ee={key:0,class:"print-layout"},xe={class:"print-page main-page"},Xe={class:"header"},ze={class:"operations-table"},Ve={class:"total-row"},Ue={class:"header"},Ie={class:"operations-table"},Ke={class:"total-row"},qe={class:"print-controls"},Re=["disabled"],$e={key:1,class:"loading"},Se={key:2,class:"error"};var We={__name:"PrintNormOrder",setup(e){const l=(0,h.lq)(),t=(0,f.KR)(null),a=(0,f.KR)(!0);(0,o.sV)(async()=>{const e=l.params.id;if(e)try{const l=await fetch(`http://localhost:8080/api/orders/order-norm/${e}`);if(!l.ok)throw new Error(`Ошибка загрузки элемента: ${l.status}`);const a=await l.json(),o=Array.isArray(a)?a[0]:a;let n;n="main"===o.part_type?e:o.parent_product_id?o.parent_product_id:e;const u=await fetch(`http://localhost:8080/api/orders/order-norm/${n}`);if(!u.ok)throw new Error(`Не удалось загрузить сборку: ${u.status}`);const r=await u.json();let s;if(Array.isArray(r))s=r;else{if(!r||"object"!==typeof r)throw new Error("Некорректные данные");s=[r]}const i=s.find(e=>"main"===e.part_type),d=s.filter(e=>"sub"===e.part_type),p=i||(s.length>0?s[0]:null);if(!p)throw new Error("Нет данных для отображения");t.value={main:p,subs:d}}catch(o){console.error("Ошибка загрузки:",o)}finally{a.value=!1}else alert("Не указан ID")});const n=(0,f.KR)(!1),u=()=>{r(t.value.main)},r=async e=>{if(e){n.value=!0;try{const l=await g.A.post("http://localhost:8080/api/orders/cancel",{root_product_id:e.id});if(200!==l.status)throw new Error("API вернул неожиданный статус");e.status="cancel",alert("Заказ успешно отменён.")}catch(l){console.error("Ошибка при отмене заказа:",l);let e="Не удалось отменить заказ.";l.response?.data?.message&&(e+="\n"+l.response.data.message),alert(e)}finally{n.value=!1}}};function s(){const e=document.querySelector(".print-layout");if(!e)return void alert("Нет данных для печати");const l=e.cloneNode(!0),t=l.querySelector(".print-controls");t&&t.remove();const a=l.innerHTML,o=`\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <title>Технологический процесс</title>\n        <style>\n          body {\n            font-family: 'Segoe UI', Arial, sans-serif;\n            font-size: 13px;\n            line-height: 1.4;\n            padding: 15px;\n            margin: 0;\n            color: #000;\n            background: #fff;\n            -webkit-print-color-adjust: exact;\n            print-color-adjust: exact;\n            width: 210mm;\n            margin: 0 auto;\n          }\n          .print-page {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            margin-bottom: 12px;\n          }\n          .header p {\n            margin: 2px 0;\n            line-height: 1.2;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 4px 0;\n            font-size: 12px;\n          }\n          th, td {\n            border: 1px solid #000;\n            padding: 4px 6px;\n            text-align: left;\n          }\n          th {\n            background-color: #f2f2f2;\n            font-weight: bold;\n          }\n          .total-row {\n            background-color: #f9f9f9;\n            font-weight: bold;\n          }\n          .additional-ops {\n            margin-top: 6px;\n            break-inside: avoid;\n            page-break-inside: avoid;\n          }\n          @media print {\n            @page {\n              margin: 1cm;\n              size: A4 portrait;\n            }\n            body {\n              -webkit-print-color-adjust: exact;\n            }\n          }\n        </style>\n      </head>\n      <body onload="window.focus(); window.print();">\n        <div class="print-container">\n          ${a}\n        </div>\n      </body>\n    </html>\n  `,n=window.open("","_blank","width=1000,height=800");n.document.write(o),n.document.close()}return(e,l)=>((0,o.uX)(),(0,o.CE)("div",Fe,[t.value?((0,o.uX)(),(0,o.CE)("div",Ee,[(0,o.Lk)("div",xe,[(0,o.Lk)("div",Xe,[(0,o.Lk)("p",null,"Пооперационный технологический процесс "+(0,b.v_)(t.value.main.head_name),1),(0,o.Lk)("p",null,[l[0]||(l[0]=(0,o.Lk)("strong",null,"Номер заказа:",-1)),(0,o.eW)(" "+(0,b.v_)(t.value.main.order_num),1)]),(0,o.Lk)("p",null,[l[1]||(l[1]=(0,o.Lk)("strong",null,"Количество:",-1)),(0,o.eW)(" "+(0,b.v_)(t.value.main.count),1)]),(0,o.Lk)("table",ze,[l[4]||(l[4]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",{width:"40%"},"Операция"),(0,o.Lk)("th",{width:"10%"},[(0,o.eW)("Итого "),(0,o.Lk)("br"),(0,o.eW)(" н/час")]),(0,o.Lk)("th",{width:"10%"},[(0,o.eW)("Итого "),(0,o.Lk)("br"),(0,o.eW)(" н/мин")]),(0,o.Lk)("th",null,"ФИО исполнителя")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.value.main.operations,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.operation_name},[(0,o.Lk)("td",null,(0,b.v_)(e.operation_label),1),(0,o.Lk)("td",null,(0,b.v_)(e.value.toFixed(3)),1),(0,o.Lk)("td",null,(0,b.v_)(e.minutes),1),l[2]||(l[2]=(0,o.Lk)("td",null,null,-1))]))),128)),(0,o.Lk)("tr",Ve,[l[3]||(l[3]=(0,o.Lk)("td",{colspan:"1",class:"text-right"},[(0,o.Lk)("strong",null,"Итого:")],-1)),(0,o.Lk)("td",null,(0,b.v_)(t.value.main.total_time.toFixed(3)),1),(0,o.Lk)("td",null,(0,b.v_)(Math.round(60*t.value.main.total_time)),1)])])]),(0,o.bF)(we)])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.value.subs,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"print-page sub-page"},[(0,o.Lk)("div",Ue,[(0,o.Lk)("p",null,"Пооперационный технологический процесс "+(0,b.v_)(e.head_name),1),(0,o.Lk)("p",null,[l[5]||(l[5]=(0,o.Lk)("strong",null,"Номер заказа:",-1)),(0,o.eW)(" "+(0,b.v_)(e.order_num),1)]),(0,o.Lk)("p",null,[l[6]||(l[6]=(0,o.Lk)("strong",null,"Количество:",-1)),(0,o.eW)(" "+(0,b.v_)(e.count),1)]),(0,o.Lk)("table",Ie,[l[9]||(l[9]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",{width:"40%"},"Операция"),(0,o.Lk)("th",{width:"10%"},[(0,o.eW)("Итого "),(0,o.Lk)("br"),(0,o.eW)(" н/час")]),(0,o.Lk)("th",{width:"10%"},[(0,o.eW)("Итого "),(0,o.Lk)("br"),(0,o.eW)(" н/мин")]),(0,o.Lk)("th",null,"ФИО исполнителя")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.operations,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.operation_name},[(0,o.Lk)("td",null,(0,b.v_)(e.operation_label),1),(0,o.Lk)("td",null,(0,b.v_)(e.value.toFixed(3)),1),(0,o.Lk)("td",null,(0,b.v_)(e.minutes),1),l[7]||(l[7]=(0,o.Lk)("td",null,null,-1))]))),128)),(0,o.Lk)("tr",Ke,[l[8]||(l[8]=(0,o.Lk)("td",{colspan:"1",class:"text-right"},[(0,o.Lk)("strong",null,"Итого:")],-1)),(0,o.Lk)("td",null,(0,b.v_)(e.total_time.toFixed(3)),1),(0,o.Lk)("td",null,(0,b.v_)(Math.round(60*e.total_time)),1)])])]),(0,o.bF)(we)])]))),128)),(0,o.Lk)("div",qe,[(0,o.Lk)("button",{onClick:s,class:"btn-print"},"Распечатать"),t.value.main&&"cancel"!==t.value.main.status?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:u,class:"btn-cancel",disabled:n.value},(0,b.v_)(n.value?"Отменяем...":"Отменить заказ"),9,Re)):(0,o.Q3)("",!0)])])):a.value?((0,o.uX)(),(0,o.CE)("div",$e," Загрузка сборки... ")):((0,o.uX)(),(0,o.CE)("div",Se," Не удалось загрузить данные. "))]))}};const Je=(0,y.A)(We,[["__scopeId","data-v-3dd03281"]]);var Ne=Je;const Oe={class:"orders-page"},Te={class:"filters"},Ae={class:"filter-group"},De={class:"filter-group"},je={key:0,class:"orders-table"},Pe={class:"text-center"},Qe={class:"text-right"},Me=["onClick"],He=["onClick"],Be=["onClick"],Ge={key:1,class:"no-results"},Ye={key:2,class:"loading"};var Ze={__name:"NormOrdersList",setup(e){const l=(0,h.rd)(),t=(0,f.KR)({order_num:"",type:""}),n=(0,f.KR)([]),u=(0,f.KR)(!1),r={window:"Окно",glyhar:"Глухарь",door:"Дверь",loggia:"Лоджия",vitrage:"Витраж",other:"Другое"},s={assigned:"Сотрудники назначены",in_production:"В производстве",final:"Готов для ПЭО",cancel:"Отменён"},i=e=>r[e]||e,d=e=>s[e]||e,p=()=>{c()},c=async()=>{u.value=!0;const e=new URLSearchParams;t.value.order_num&&e.append("order_num",t.value.order_num),t.value.type&&e.append("type",t.value.type);try{const l=await fetch(`http://localhost:8080/api/orders/order/norm/all?${e}`);if(!l.ok)return console.error("Ошибка HTTP:",l.status),void(n.value=[]);const t=await l.json();n.value=Array.isArray(t)?t:[]}catch(l){console.error("Ошибка сети:",l),n.value=[]}finally{u.value=!1}},v=e=>{l.push(`/norm/orders/order-norm/edit/${e.id}`)},m=e=>{l.push({name:"AssignWorkers",params:{id:e.id}})},k=async e=>{try{const l=await g.A.post("http://localhost:8080/api/orders/cancel",{root_product_id:e.id});200===l.status&&(e.status="cancel")}catch(l){console.error("Ошибка при отмене заказа:",l)}};return(0,o.sV)(()=>{const e=new URLSearchParams(window.location.search);e.has("order_num")&&(t.value.order_num=e.get("order_num")),e.has("type")&&(t.value.type=e.get("type")),c()}),(e,l)=>((0,o.uX)(),(0,o.CE)("div",Oe,[l[6]||(l[6]=(0,o.Lk)("h2",null,"Нормированные заказы",-1)),(0,o.Lk)("div",Te,[(0,o.Lk)("div",Ae,[l[2]||(l[2]=(0,o.Lk)("label",null,"Номер заказа",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.order_num=e),type:"text",placeholder:"Q6-317",onInput:p},null,544),[[a.Jo,t.value.order_num]])]),(0,o.Lk)("div",De,[l[4]||(l[4]=(0,o.Lk)("label",null,"Тип изделия",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.type=e),onChange:p},l[3]||(l[3]=[(0,o.Fv)('<option value="" data-v-51d6915f>Все типы</option><option value="window" data-v-51d6915f>Окна</option><option value="glyhar" data-v-51d6915f>Глухари</option><option value="door" data-v-51d6915f>Двери</option><option value="loggia" data-v-51d6915f>Лоджии</option><option value="vitrage" data-v-51d6915f>Витражи</option>',6)]),544),[[a.u1,t.value.type]])])]),n.value.length>0?((0,o.uX)(),(0,o.CE)("table",je,[l[5]||(l[5]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Заказ"),(0,o.Lk)("th",null,"Изделие"),(0,o.Lk)("th",null,"Кол-во"),(0,o.Lk)("th",null,"Тип"),(0,o.Lk)("th",null,"Время (ч)"),(0,o.Lk)("th",null,"Дата"),(0,o.Lk)("th",null,"Действие"),(0,o.Lk)("th",null,"Статус")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.order_num+"-"+e.name},[(0,o.Lk)("td",null,(0,b.v_)(e.order_num),1),(0,o.Lk)("td",null,(0,b.v_)(e.name),1),(0,o.Lk)("td",Pe,(0,b.v_)(e.count),1),(0,o.Lk)("td",null,[(0,o.Lk)("span",{class:(0,b.C4)(`type-badge type-${e.type}`)},(0,b.v_)(i(e.type)),3)]),(0,o.Lk)("td",Qe,(0,b.v_)(e.total_time.toFixed(3)),1),(0,o.Lk)("td",null,(0,b.v_)(new Date(e.created_at).toLocaleDateString()),1),(0,o.Lk)("td",null,[(0,o.Lk)("button",{onClick:l=>v(e),class:"btn-view"}," Просмотр ",8,Me),(0,o.Lk)("button",{onClick:l=>m(e),class:"btn-view"}," Назначить сотрудников ",8,He),"cancel"!==e.status?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:l=>k(e),class:"btn-view"}," Отменить ",8,Be)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",null,[(0,o.Lk)("span",{class:(0,b.C4)(`status-badge type-${e.status}`)},(0,b.v_)(d(e.status)),3)])]))),128))])])):u.value?((0,o.uX)(),(0,o.CE)("div",Ye,"Загрузка...")):((0,o.uX)(),(0,o.CE)("div",Ge,(0,b.v_)(t.value.order_num||t.value.type?"Нет заказов по фильтру":"Нет нормированных заказов"),1))]))}};const el=(0,y.A)(Ze,[["__scopeId","data-v-51d6915f"]]);var ll=el;const tl={key:0,class:"edit-norm-page"},al={class:"item-info"},ol={class:"operations-table"},nl=["onUpdate:modelValue","onInput"],ul=["onUpdate:modelValue"],rl=["onUpdate:modelValue"],sl=["onUpdate:modelValue","onChange","disabled"],il=["onUpdate:modelValue"],dl=["onUpdate:modelValue","onInput","disabled"],pl=["onUpdate:modelValue","disabled"],cl=["onUpdate:modelValue","disabled"],vl={class:"actions"},ml=["disabled"],kl={key:1,class:"loading"},yl={key:2,class:"error"};var Ll={__name:"EditNormOrder",setup(e){const l=(0,h.lq)(),t=(0,h.rd)(),n=(0,f.KR)([]),u=(0,f.KR)(!1);(0,o.sV)(()=>{s()});const r=e=>{"допвремя на напиловку"===e.operation_label?e.operation_name="dop_nap":"доп время на сборку"===e.operation_label?e.operation_name="dop_sbor":e.operation_name=""},s=async()=>{u.value=!0;try{const e=l.params.id;if(!e)return console.error("Не указан ID наряда"),t.push("/norm/orders/");const a=await fetch(`http://localhost:8080/api/orders/order-norm/${e}`);if(!a.ok)throw new Error("Наряд не найден");const o=await a.json();let u;u="main"===o.part_type?e:o.parent_product_id?o.parent_product_id:e;const r=await fetch(`http://localhost:8080/api/orders/order-norm/${u}`);if(!r.ok)throw new Error("Не удалось загрузить сборку");const s=await r.json();n.value=s.map(e=>({id:e.id,order_num:e.order_num,name:e.name,count:e.count,type:e.type,type_izd:e.type_izd,part_type:e.part_type,parent_product_id:e.parent_product_id,created_at:e.created_at,operations:e.operations.map(e=>({...e})),extraOperations:[{operation_name:"dop_nap",operation_label:"",count:0,value:0,minutes:0,fixed:!0},{operation_name:"dop_sbor",operation_label:"",count:0,value:0,minutes:0,fixed:!0},{operation_name:"",operation_label:"",count:0,value:0,minutes:0,fixed:!1},{operation_name:"",operation_label:"",count:0,value:0,minutes:0,fixed:!1}]}))}catch(e){console.error("Ошибка загрузки:",e),alert("Не удалось загрузить данные. Проверьте соединение."),t.push("/norm/orders/")}finally{u.value=!1}},i=e=>"main"===e.part_type?`Основное изделие: ${e.name}`:`Составная часть: ${e.name}`,d=e=>{if(!e)return"";const l=new Date(e);return l.toLocaleDateString("ru-RU")},p=e=>{void 0!==e.value&&(e.minutes=(60*e.value).toFixed(1))},c=e=>{"number"!==typeof e.value||isNaN(e.value)||(e.minutes=parseFloat((60*e.value).toFixed(1)))},v=async()=>{if(u.value)return;u.value=!0;const e=n.value.map(async e=>{const l=e.extraOperations.filter(e=>""!==e.operation_label.trim()),t=[...e.operations,...l].reduce((e,l)=>e+l.value,0),a={order_num:e.order_num,product_name:e.name,type:e.type,status:"in_production",total_time:parseFloat(t.toFixed(3)),operations:[...e.operations.map(e=>({operation_name:e.operation_name,operation_label:e.operation_label,count:parseInt(e.count)||0,value:parseFloat(e.value)||0,minutes:parseFloat(e.minutes)||0})),...l.map(e=>({operation_name:e.operation_name,operation_label:e.operation_label,count:parseInt(e.count)||0,value:parseFloat(e.value)||0,minutes:parseFloat(e.minutes)||0}))]};try{const l=await fetch(`http://localhost:8080/api/orders/order/norm/update/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return l.ok?{success:!0,id:e.id}:{success:!1,id:e.id}}catch(o){return console.error(`Ошибка при сохранении наряда ${e.id}:`,o),{success:!1,id:e.id}}}),l=await Promise.all(e),t=l.filter(e=>e.success).length;t===l.length||(t>0?console.error(`Сохранено ${t} из ${l.length} нарядов. Проверьте данные.`):console.error("Не удалось сохранить ни один наряд")),await s(),u.value=!1};function m(){const e=l.params.id;window.location.href=`/norm/order-norm/print/${e}`}const k=()=>{t.push("/norm/orders/")};return(e,l)=>!u.value&&n.value?((0,o.uX)(),(0,o.CE)("div",tl,[l[6]||(l[6]=(0,o.Lk)("h2",null,"Редактирование заказа",-1)),(0,o.Lk)("p",null,[l[0]||(l[0]=(0,o.Lk)("strong",null,"Заказ:",-1)),(0,o.eW)(" "+(0,b.v_)(n.value[0]?.order_num),1)]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.value,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"assembly-item"},[(0,o.Lk)("h3",null,(0,b.v_)(i(e)),1),(0,o.Lk)("div",al,[(0,o.Lk)("span",null,[l[1]||(l[1]=(0,o.Lk)("strong",null,"Тип:",-1)),(0,o.eW)(" "+(0,b.v_)(e.type_izd),1)]),(0,o.Lk)("span",null,[l[2]||(l[2]=(0,o.Lk)("strong",null,"Кол-во:",-1)),(0,o.eW)(" "+(0,b.v_)(e.count),1)]),(0,o.Lk)("span",null,[l[3]||(l[3]=(0,o.Lk)("strong",null,"Создан:",-1)),(0,o.eW)(" "+(0,b.v_)(d(e.created_at)),1)])]),(0,o.Lk)("table",ol,[l[5]||(l[5]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Операция"),(0,o.Lk)("th",null,"Время (ч)"),(0,o.Lk)("th",null,"Кол-во"),(0,o.Lk)("th",null,"Время (мин)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.operations,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.operation_name},[(0,o.Lk)("td",null,(0,b.v_)(e.operation_label),1),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.value=l,type:"number",min:"0",step:"0.01",class:"input-small",onInput:l=>p(e)},null,40,nl),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",step:"1",min:"0",class:"input-small"},null,8,ul),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.minutes=l,type:"number",min:"0",class:"input-small"},null,8,rl),[[a.Jo,e.minutes,void 0,{number:!0}]])])]))),128)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.extraOperations,(e,t)=>((0,o.uX)(),(0,o.CE)("tr",{key:e.operation_name||`custom_${t}`},[(0,o.Lk)("td",null,[e.fixed?(0,o.bo)(((0,o.uX)(),(0,o.CE)("select",{key:0,"onUpdate:modelValue":l=>e.operation_label=l,class:"input-full",onChange:l=>r(e),disabled:u.value},l[4]||(l[4]=[(0,o.Lk)("option",{value:""},"-- Выберите операцию --",-1),(0,o.Lk)("option",{value:"доп время на напиловку"},"доп время на напиловку",-1),(0,o.Lk)("option",{value:"доп время на сборку"},"доп время на сборку",-1)]),40,sl)),[[a.u1,e.operation_label]]):(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,"onUpdate:modelValue":l=>e.operation_label=l,type:"text",placeholder:"Введите название операции",class:"input-full"},null,8,il)),[[a.Jo,e.operation_label]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.value=l,type:"number",min:"0",step:"0.01",class:"input-small",onInput:l=>c(e),disabled:u.value},null,40,dl),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",step:"1",min:"0",class:"input-small",disabled:u.value},null,8,pl),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.minutes=l,type:"number",min:"0",class:"input-small",disabled:u.value},null,8,cl),[[a.Jo,e.minutes,void 0,{number:!0}]])])]))),128))])])]))),128)),(0,o.Lk)("div",vl,[(0,o.Lk)("button",{onClick:k,class:"btn-cancel"},"Назад"),(0,o.Lk)("button",{onClick:v,disabled:u.value,class:"btn-save"},(0,b.v_)(u.value?"Сохраняем...":"Сохранить всё"),9,ml),(0,o.Lk)("button",{onClick:m,class:"btn-print"}," Перейти к печати ")])])):u.value?((0,o.uX)(),(0,o.CE)("div",kl,"Загрузка сборки...")):((0,o.uX)(),(0,o.CE)("div",yl,"Не удалось загрузить данные"))}};const _l=(0,y.A)(Ll,[["__scopeId","data-v-0dc6c21d"]]);var hl=_l;t(1148),t(3579);const bl={key:0,class:"assign-workers"},fl={class:"info-grid"},gl={class:"total-time"},Cl={class:"total-time"},wl={class:"executors-table"},Fl={class:"text-center"},El={class:"text-center"},xl=["onUpdate:modelValue"],Xl=["value","disabled"],zl=["onUpdate:modelValue","onInput"],Vl=["onUpdate:modelValue","onInput"],Ul=["onClick"],Il=["onClick"],Kl={class:"actions"},ql=["disabled"],Rl={key:1,class:"loading"},$l={key:2,class:"error"};var Sl={__name:"AssignWorkers",setup(e){const l=(0,h.lq)(),t=(0,h.rd)(),n=(0,f.KR)(null),u=(0,f.KR)([]),r=(0,f.KR)(!1),s=(0,f.KR)(""),i=(e,l,t)=>e.some(e=>e!==t&&e.employee_id===l);(0,o.sV)(async()=>{const e=l.params.id;if(!e)return;r.value=!0;try{const l=await fetch(`http://localhost:8080/api/orders/order-norm/${e}`);if(!l.ok)throw new Error("Не удалось загрузить сборку");const t=await l.json(),a=t.map(e=>({...e,operations:e.operations.map(e=>{const l=Array.isArray(e.assign_workers)&&e.assign_workers.length>0?e.assign_workers.map(e=>({employee_id:e.employee_id,actual_minutes:e.actual_minutes,actual_value:parseFloat(e.actual_value.toFixed(3))})):[{employee_id:"",actual_minutes:e.minutes,actual_value:parseFloat(e.value.toFixed(3))}];return{...e,executors:l}})})),o=a.find(e=>"main"===e.part_type)||a[0],u=a.filter(e=>"sub"===e.part_type);console.log("MAIN",o),console.log("SUB",u),n.value={main:o,subs:u}}catch(i){console.error("Ошибка загрузки:",i),alert("Не удалось загрузить данные")}finally{r.value=!1}const t=(new Date).toISOString().split("T")[0],a=n.value.main.ready_date;let o=t;if(a){const e=new Date(a).toISOString().split("T")[0];"Invalid date"!==e&&(o=e)}s.value=o;try{const e=await fetch("http://localhost:8080/api/workers/all");u.value=await e.json()}catch(i){console.error("Ошибка загрузки сотрудников:",i)}});const d=(0,o.EW)(()=>n.value?[n.value.main,...n.value.subs]:[]),p=(0,o.EW)(()=>d.value.reduce((e,l)=>e+l.total_time,0)),c=e=>e?new Date(e).toLocaleDateString("ru-RU"):"",v=e=>"main"===e.part_type?`${e.name}`:`${e.name} (часть изделия)`,m=e=>{const l={window:"Окно",glyhar:"Глухарь",door:"Дверь",loggia:"Лоджия",vitrage:"Витраж"};return l[e]||e},k=e=>{const l=Number(e.actual_minutes);e.actual_value=isNaN(l)?0:parseFloat((l/60).toFixed(3))},y=e=>{const l=Number(e.actual_value);e.actual_minutes=isNaN(l)?0:Number((60*l).toFixed(3))},L=e=>{const l=e.value,t=e.executors.length+1,a=parseFloat((l/t).toFixed(3));e.executors.push({employee_id:"",actual_minutes:Number(parseFloat((60*a).toFixed(3))),actual_value:a}),g(e)},_=(e,l)=>{e.executors.length<=1||(e.executors.splice(l,1),g(e))},g=e=>{const l=e.value,t=e.executors.length;if(0===t)return;const a=parseFloat((l/t).toFixed(3));e.executors.forEach(e=>{e.actual_minutes=Number(parseFloat((60*a).toFixed(3))),e.actual_value=a})},C=async()=>{const e={assignments:[],update_status:"assigned",root_product_id:n.value.main.id,ready_date:s.value},l=[];for(const t of d.value)for(const a of t.operations){const o=a.executors.filter(e=>e.employee_id);if(0!==o.length)for(const n of a.executors)n.employee_id||l.push(`У операции "${a.operation_label}" (${t.name}) указан исполнитель без ФИО`),n.employee_id&&e.assignments.push({product_id:t.id,operation_name:a.operation_name,employee_id:n.employee_id,actual_minutes:n.actual_minutes||a.minutes,actual_value:n.actual_value||a.value,notes:""});else l.push(`Операция "${a.operation_label}" (${t.name}) — не назначен исполнитель`)}if(l.length>0)alert("Не все операции назначены:\n\n"+l.join("\n"));else if(0!==e.assignments.length)try{const l=await fetch("http://localhost:8080/api/workers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});l.ok&&t.push("/norm/orders")}catch(a){console.error("Ошибка отправки:",a)}else alert("Нет ни одной операции с назначением")},w=()=>{t.back()};return(e,l)=>n.value?((0,o.uX)(),(0,o.CE)("div",bl,[l[11]||(l[11]=(0,o.Lk)("h2",null,"Назначение работников",-1)),(0,o.Lk)("div",fl,[l[2]||(l[2]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"Заказ:")],-1)),(0,o.Lk)("div",null,(0,b.v_)(n.value.main.order_num),1),l[3]||(l[3]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"Изделие:")],-1)),(0,o.Lk)("div",null,(0,b.v_)(n.value.main.name),1),l[4]||(l[4]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"Общее время:")],-1)),(0,o.Lk)("div",gl,(0,b.v_)(p.value.toFixed(3))+" ч ("+(0,b.v_)(Math.round(60*p.value))+" мин) ",1),l[5]||(l[5]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"Дата создания:")],-1)),(0,o.Lk)("div",null,(0,b.v_)(c(n.value.main.created_at)),1),l[6]||(l[6]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"Дата выполнения:")],-1)),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e),type:"date",class:"input-date"},null,512),[[a.Jo,s.value]]),l[1]||(l[1]=(0,o.Lk)("small",null,"Укажите дату изготовления",-1))])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(d.value,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"item-section"},[(0,o.Lk)("h3",null,(0,b.v_)(v(e)),1),(0,o.Lk)("p",null,[l[7]||(l[7]=(0,o.Lk)("strong",null,"Тип:",-1)),(0,o.eW)(" "+(0,b.v_)(m(e.type)),1)]),l[10]||(l[10]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"Общее время:")],-1)),(0,o.Lk)("div",Cl,(0,b.v_)(e.total_time.toFixed(3))+" ч ("+(0,b.v_)(Math.round(60*e.total_time))+" мин) ",1),(0,o.Lk)("table",wl,[l[9]||(l[9]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Операция"),(0,o.Lk)("th",null,"Норма (мин)"),(0,o.Lk)("th",null,"Норма (ч)"),(0,o.Lk)("th",{style:{width:"50%"}},[(0,o.eW)(" Исполнители "),(0,o.Lk)("div",{class:"executor-headers"},[(0,o.Lk)("span",{class:"header-label"},"Исполнитель"),(0,o.Lk)("span",{class:"header-label"},"Факт (мин)"),(0,o.Lk)("span",{class:"header-label"},"Факт (ч)")])])])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.operations,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.operation_name,class:(0,b.C4)({"missing-executor":e.executors.every(e=>!e.employee_id)})},[(0,o.Lk)("td",null,(0,b.v_)(e.operation_label),1),(0,o.Lk)("td",Fl,(0,b.v_)(e.minutes),1),(0,o.Lk)("td",El,(0,b.v_)(e.value.toFixed(3)),1),(0,o.Lk)("td",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.executors,(t,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n,class:"executor-row"},[(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":e=>t.employee_id=e,class:"select-employee"},[l[8]||(l[8]=(0,o.Lk)("option",{value:""},"— выберите —",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value,l=>((0,o.uX)(),(0,o.CE)("option",{key:l.id,value:l.id,disabled:i(e.executors,l.id,t)},(0,b.v_)(l.name),9,Xl))),128))],8,xl),[[a.u1,t.employee_id]]),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":e=>t.actual_minutes=e,type:"number",placeholder:"мин",class:"input-minutes",min:"0",step:"0.001",onInput:e=>k(t)},null,40,zl),[[a.Jo,t.actual_minutes,void 0,{number:!0}]]),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":e=>t.actual_value=e,type:"number",placeholder:"ч",class:"input-minutes",min:"0",step:"0.01",onInput:e=>y(t)},null,40,Vl),[[a.Jo,t.actual_value,void 0,{number:!0}]]),e.executors.length>1?((0,o.uX)(),(0,o.CE)("button",{key:0,type:"button",onClick:l=>_(e,n),class:"btn-remove"}," ✕ ",8,Ul)):(0,o.Q3)("",!0)]))),128)),(0,o.Lk)("button",{type:"button",onClick:l=>L(e),class:"btn-add"}," + Добавить исполнителя ",8,Il)])],2))),128))])])]))),128)),(0,o.Lk)("div",Kl,[(0,o.Lk)("button",{onClick:w,class:"btn-cancel"},"Назад"),(0,o.Lk)("button",{onClick:C,disabled:r.value,class:"btn-save"},(0,b.v_)(r.value?"Сохраняем...":"Сохранить назначения"),9,ql)])])):r.value?((0,o.uX)(),(0,o.CE)("div",Rl,"Загрузка сборки...")):((0,o.uX)(),(0,o.CE)("div",$l,"Не удалось загрузить данные"))}};const Wl=(0,y.A)(Sl,[["__scopeId","data-v-9e37938e"]]);var Jl=Wl,Nl=(t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698),t(7093)),Ol=t.n(Nl);const Tl={class:"form-group"},Al=["value"],Dl={key:2,class:"error-text"},jl=["value"],Pl={key:0,class:"error-text"},Ql={key:0,class:"error-text"},Ml={key:0,class:"error-text"},Hl={key:0,class:"error-text"},Bl=["value"],Gl={key:0,class:"error-text"},Yl={key:0,class:"error-text"},Zl=["value"],et={key:0,class:"error-text"},lt={class:"modal-actions"},tt=["disabled"];var at={__name:"EditProductModal",props:{product:Object,employees:Array},emits:["close","cancel"],setup(e,{emit:l}){const t=e,n=l,u=(0,f.KR)({...t.product}),r=[{value:"к",label:"корпоративный"},{value:"ч",label:"частный"},{value:"д",label:"дилер"}],s=["1П","1Пт","1.5П","1.5Пт","2П","2Пт"],i=(0,o.EW)(()=>"door"===u.value.type),d=["бригада","бригада окон, дверей","бригада витражей"],p=(0,f.KR)({}),c=()=>{p.value={};const e=[{key:"type_izd",label:"Наименование"},{key:"systema",label:"Система"},{key:"profile",label:"Профиль"},{key:"sqr",label:"Площадь"},{key:"brigade",label:"Бригада"},{key:"norm_money",label:"Н/руб"},{key:"customer_type",label:"Направление заказчика"},{key:"coefficient",label:"Коэффициент"}];return e.forEach(e=>{const l=u.value[e.key];l&&("string"!==typeof l||l.trim())||(p.value[e.key]=!0)}),(isNaN(parseFloat(u.value.sqr))||parseFloat(u.value.sqr)<0)&&(p.value.sqr=!0),(isNaN(parseFloat(u.value.norm_money))||parseFloat(u.value.norm_money)<0)&&(p.value.norm_money=!0),0===Object.keys(p.value).length},v=(0,o.EW)(()=>c()),m=()=>{c()&&n("close",u.value)},k=(0,f.KR)(!1),y=()=>{if(k.value)return;const e=parseFloat(u.value.total_time),l=parseFloat(u.value.coefficient);isNaN(e)||isNaN(l)||(u.value.norm_money=parseFloat((e*l).toFixed(3)))};(0,o.wB)(()=>u.value.coefficient,()=>{k.value||y()});const L=()=>{k.value=!1},_=e=>{k.value=!0,u.value.norm_money=parseFloat(e.target.value)||0},h=()=>{if(u.value.norm_money&&u.value.norm_money>0)return;const e=parseFloat(u.value.total_time),l=parseFloat(u.value.coefficient);!isNaN(e)&&!isNaN(l)&&l>0&&(u.value.norm_money=parseFloat((e*l).toFixed(3)),k.value=!1)};h();const g=()=>{n("cancel")};return(e,l)=>((0,o.uX)(),(0,o.CE)("div",{class:"modal-overlay",onClick:g},[(0,o.Lk)("div",{class:"modal-content",onClick:l[9]||(l[9]=(0,a.D$)(()=>{},["stop"]))},[l[22]||(l[22]=(0,o.Lk)("h3",null,"Редактирование изделия",-1)),(0,o.Lk)("div",Tl,[l[10]||(l[10]=(0,o.Lk)("label",null,"Спецификация",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>u.value.parent_assembly=e),class:"form-input",placeholder:"Опционально"},null,512),[[a.Jo,u.value.parent_assembly]])]),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.type_izd}])},[l[12]||(l[12]=(0,o.Lk)("label",null,"Наименование",-1)),i.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("select",{key:0,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value.type_izd=e),class:(0,b.C4)(["form-select",{invalid:p.value.type_izd}]),onChange:c},[l[11]||(l[11]=(0,o.Lk)("option",{value:"",disabled:""},"Выберите тип двери",-1)),((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(s,e=>(0,o.Lk)("option",{key:e,value:e},(0,b.v_)(e),9,Al)),64))],34)),[[a.u1,u.value.type_izd]]):(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value.type_izd=e),class:(0,b.C4)(["form-input",{invalid:p.value.type_izd}]),onBlur:c},null,34)),[[a.Jo,u.value.type_izd]]),p.value.type_izd?((0,o.uX)(),(0,o.CE)("span",Dl,"Укажите наименование")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.customer_type}])},[l[14]||(l[14]=(0,o.Lk)("label",null,"Направление заказчика",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[3]||(l[3]=e=>u.value.customer_type=e),class:(0,b.C4)(["form-select",{invalid:p.value.customer_type}]),onChange:c},[l[13]||(l[13]=(0,o.Lk)("option",{value:"",disabled:""},"Выберите направление",-1)),((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(r,e=>(0,o.Lk)("option",{key:e.value,value:e.value},(0,b.v_)(e.label),9,jl)),64))],34),[[a.u1,u.value.customer_type]]),p.value.customer_type?((0,o.uX)(),(0,o.CE)("span",Pl,"Выберите направление")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.systema}])},[l[15]||(l[15]=(0,o.Lk)("label",null,"Система",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>u.value.systema=e),class:(0,b.C4)(["form-input",{invalid:p.value.systema}]),onBlur:c},null,34),[[a.Jo,u.value.systema]]),p.value.systema?((0,o.uX)(),(0,o.CE)("span",Ql,"Укажите систему")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.profile}])},[l[16]||(l[16]=(0,o.Lk)("label",null,"Профиль",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.profile=e),class:(0,b.C4)(["form-input",{invalid:p.value.profile}]),onBlur:c},null,34),[[a.Jo,u.value.profile]]),p.value.profile?((0,o.uX)(),(0,o.CE)("span",Ml,"Укажите профиль")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.sqr}])},[l[17]||(l[17]=(0,o.Lk)("label",null,"Площадь",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.sqr=e),type:"number",step:"0.001",min:"0",class:(0,b.C4)(["form-input",{invalid:p.value.sqr}]),onBlur:c},null,34),[[a.Jo,u.value.sqr,void 0,{number:!0}]]),p.value.sqr?((0,o.uX)(),(0,o.CE)("span",Hl,"Введите корректную площадь")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.brigade}])},[l[19]||(l[19]=(0,o.Lk)("label",null,"Бригада",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.brigade=e),class:(0,b.C4)(["form-select",{invalid:p.value.brigade}]),onChange:c},[l[18]||(l[18]=(0,o.Lk)("option",{value:"",disabled:""},"Выберите значение",-1)),((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(d,e=>(0,o.Lk)("option",{key:e,value:e},(0,b.v_)(e),9,Bl)),64))],34),[[a.u1,u.value.brigade]]),p.value.brigade?((0,o.uX)(),(0,o.CE)("span",Gl,"Выберите бригаду")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.coefficient}])},[l[20]||(l[20]=(0,o.Lk)("label",null,"Коэффициент",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[8]||(l[8]=e=>u.value.coefficient=e),type:"number",step:"0.01",min:"0",class:(0,b.C4)(["form-input",{invalid:p.value.coefficient}]),onBlur:c},null,34),[[a.Jo,u.value.coefficient,void 0,{number:!0}]]),p.value.coefficient?((0,o.uX)(),(0,o.CE)("span",Yl,"Введите коэффициент")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",{class:(0,b.C4)(["form-group",{error:p.value.norm_money}])},[l[21]||(l[21]=(0,o.Lk)("label",null,"Н/руб",-1)),(0,o.Lk)("input",{value:u.value.norm_money,onInput:_,onFocus:L,type:"number",step:"0.01",min:"0",class:(0,b.C4)(["form-input",{invalid:p.value.norm_money}]),onBlur:c},null,42,Zl),p.value.norm_money?((0,o.uX)(),(0,o.CE)("span",et,"Введите норму в рублях")):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",lt,[(0,o.Lk)("button",{onClick:g,class:"btn-cancel"},"Отмена"),(0,o.Lk)("button",{onClick:m,class:"btn-save",disabled:!v.value}," Сохранить ",8,tt)])])]))}};const ot=(0,y.A)(at,[["__scopeId","data-v-dcb3189a"]]);var nt=ot;const ut={key:0,class:"no-data"},rt={key:1,class:"summary-stats"},st={class:"summary-table"},it={key:2,class:"summary-stats"},dt={class:"summary-table"},pt={key:3,class:"summary-stats"},ct={class:"summary-table"},vt={key:4,class:"summary-stats total-summary"},mt={class:"summary-table"},kt={class:"total-row"},yt={class:"toggle-section"},Lt={key:0,class:"summary-stats detailed-grouping"},_t={class:"summary-table"},ht={key:0,class:"summary-stats unmatched-grouping"},bt={class:"summary-table"};var ft={__name:"SummaryStats",props:{products:{type:Array,required:!0}},setup(e){const l=e;function t(e){return(e||"").trim().toLowerCase()}function n(e){const l=e.reduce((e,l)=>(e.count+=parseFloat(l.count)||0,e.sqr+=parseFloat(l.sqr)||0,e.hours+=parseFloat(l.total_time)||0,e.money+=parseFloat(l.norm_money)||0,e),{count:0,sqr:0,hours:0,money:0});return{count:parseFloat(l.count.toFixed(3)),sqr:parseFloat(l.sqr.toFixed(3)),hours:parseFloat(l.hours.toFixed(3)),money:parseFloat(l.money.toFixed(3))}}const u=(0,o.EW)(()=>{const e=l.products,a=e.filter(e=>("window"===e.type||"glyhar"===e.type)&&t(e.systema).includes("х")&&"витраж к двери"!==t(e.type_izd)),o=e.filter(e=>("window"===e.type||"glyhar"===e.type)&&t(e.systema).includes("т")&&"витраж к двери"!==t(e.type_izd)),u=e.filter(e=>"glyhar"===e.type&&"витраж к двери"===t(e.type_izd)),r=[...a,...o,...u],s=e.filter(e=>"door"===e.type&&("1П"===e.type_izd||"1Пт"===e.type_izd)),i=e.filter(e=>"door"===e.type&&("1.5П"===e.type_izd||"1.5Пт"===e.type_izd)),d=e.filter(e=>"door"===e.type&&("2П"===e.type_izd||"2Пт"===e.type_izd)),p=e.filter(e=>"loggia"===e.type),c=e.filter(e=>"ms"===e.type),v=n(a),m=n(o),k=n(r),y=n(u),L=n(p),_=n(c),h=n(s),b=n(i),f=n(d),g=[{type_izd:"Холодные окна",profile:"х",...v},{type_izd:"Теплые окна",profile:"т",...m},{type_izd:"Витраж к двери",profile:"",...y},{type_izd:"Всего окон",profile:"",...k},{type_izd:"Всего 1П дверей",profile:"",...h},{type_izd:"Всего 1.5П дверей",profile:"",...b},{type_izd:"Всего 2П дверей",profile:"",...f}].filter(e=>e.count>0),C=L.count>0?[{type_izd:"Лоджии",profile:"",...L}]:[],w=_.count>0?[{type_izd:"Москитные сетки",profile:"",..._}]:[],F=[k,h,b,f].reduce((e,l)=>({count:e.count+l.count,sqr:e.sqr+l.sqr,hours:e.hours+l.hours,money:e.money+l.money}),{count:0,sqr:0,hours:0,money:0}),E={count:parseFloat(F.count.toFixed(3)),sqr:parseFloat(F.sqr.toFixed(3)),hours:parseFloat(F.hours.toFixed(3)),money:parseFloat(F.money.toFixed(3))};return{windowGroups:g,loggiaGroup:C,mosquitoGroup:w,totalRounded:E}}),r=[{type_izd:"окно гл.",profile:"ах"},{type_izd:"окно гл.",profile:"ат"},{type_izd:"окно гл.",profile:"ш"},{type_izd:"окно гл.",profile:"сх"},{type_izd:"окно гл.",profile:"ст"},{type_izd:"окно пов.-отк.",profile:"ах"},{type_izd:"окно пов.-отк.",profile:"ат"},{type_izd:"окно пов.-отк.",profile:"ст"},{type_izd:"окно пов.-отк.",profile:"сх"},{type_izd:"окно пов.-отк.",profile:"ш"},{type_izd:"1П",profile:"ах"},{type_izd:"1П",profile:"сх"},{type_izd:"1Пт",profile:"ат"},{type_izd:"1Пт",profile:"ст"},{type_izd:"1Пт",profile:"ш"},{type_izd:"1.5П",profile:"ах"},{type_izd:"1.5П",profile:"сх"},{type_izd:"1.5Пт",profile:"ат"},{type_izd:"1.5Пт",profile:"ст"},{type_izd:"1.5Пт",profile:"ш"},{type_izd:"2П",profile:"ах"},{type_izd:"2П",profile:"сх"},{type_izd:"2Пт",profile:"ат"},{type_izd:"2Пт",profile:"ст"},{type_izd:"2Пт",profile:"ш"}];function s(e){const l=e=>{const l=(e.type_izd||"").trim(),t=null==e.profile?"":String(e.profile).trim();return`${l}__${t}`},t=new Set(r.map(e=>{const l=(e.type_izd||"").trim(),t=null==e.profile?"":String(e.profile).trim();return`${l}__${t}`})),a=new Map,o=[];e.forEach(e=>{const n=l(e);if(t.has(n)){a.has(n)||a.set(n,{count:0,sqr:0,hours:0,money:0});const l=a.get(n);l.count+=e.count||0,l.sqr+=e.sqr||0,l.hours+=e.total_time||0,l.money+=e.norm_money||0}else o.push(e)});const n=r.map(e=>{const l=null==e.profile?"":String(e.profile).trim(),t=`${e.type_izd.trim()}__${l}`,o=a.get(t)||{count:0,sqr:0,hours:0,money:0};return{type_izd:e.type_izd,profile:e.profile,count:parseFloat(o.count.toFixed(3)),sqr:parseFloat(o.sqr.toFixed(3)),hours:parseFloat(o.hours.toFixed(3)),money:parseFloat(o.money.toFixed(3))}});return{fixedGroups:n,unmatched:o}}const i=(0,o.EW)(()=>s(l.products)),d=(0,o.EW)(()=>i.value.fixedGroups),p=(0,o.EW)(()=>i.value.unmatched),c=(0,f.KR)(!1),v=e=>{const l={window:"Окно",door:"Дверь",loggia:"Лоджия",ms:"Москитная сетка",glyhar:"Глухое окно"};return l[e]||e};return(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[l.products.length?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",ut," Нет данных для отображения. ")),u.value.windowGroups.length>0?((0,o.uX)(),(0,o.CE)("div",rt,[t[2]||(t[2]=(0,o.Lk)("h4",null,"Окна и двери",-1)),(0,o.Lk)("table",st,[t[1]||(t[1]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Наименование"),(0,o.Lk)("th",null,"Профиль"),(0,o.Lk)("th",null,"Кол-во"),(0,o.Lk)("th",null,"Площадь, м²"),(0,o.Lk)("th",null,"Н/час"),(0,o.Lk)("th",null,"Н/руб")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value.windowGroups,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.type_izd},[(0,o.Lk)("td",null,(0,b.v_)(e.type_izd),1),(0,o.Lk)("td",null,(0,b.v_)(e.profile),1),(0,o.Lk)("td",null,(0,b.v_)(e.count),1),(0,o.Lk)("td",null,(0,b.v_)(e.sqr),1),(0,o.Lk)("td",null,(0,b.v_)(e.hours),1),(0,o.Lk)("td",null,(0,b.v_)(e.money),1)]))),128))])])])):(0,o.Q3)("",!0),u.value.loggiaGroup.length>0?((0,o.uX)(),(0,o.CE)("div",it,[t[3]||(t[3]=(0,o.Lk)("h4",null,"Лоджии",-1)),(0,o.Lk)("table",dt,[(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value.loggiaGroup,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.type_izd},[(0,o.Lk)("td",null,(0,b.v_)(e.type_izd),1),(0,o.Lk)("td",null,(0,b.v_)(e.profile),1),(0,o.Lk)("td",null,(0,b.v_)(e.count),1),(0,o.Lk)("td",null,(0,b.v_)(e.sqr),1),(0,o.Lk)("td",null,(0,b.v_)(e.hours),1),(0,o.Lk)("td",null,(0,b.v_)(e.money),1)]))),128))])])])):(0,o.Q3)("",!0),u.value.mosquitoGroup.length>0?((0,o.uX)(),(0,o.CE)("div",pt,[t[4]||(t[4]=(0,o.Lk)("h4",null,"Москитные сетки",-1)),(0,o.Lk)("table",ct,[(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value.mosquitoGroup,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.type_izd},[(0,o.Lk)("td",null,(0,b.v_)(e.type_izd),1),(0,o.Lk)("td",null,(0,b.v_)(e.profile),1),(0,o.Lk)("td",null,(0,b.v_)(e.count),1),(0,o.Lk)("td",null,(0,b.v_)(e.sqr),1),(0,o.Lk)("td",null,(0,b.v_)(e.hours),1),(0,o.Lk)("td",null,(0,b.v_)(e.money),1)]))),128))])])])):(0,o.Q3)("",!0),u.value.totalRounded.count>0?((0,o.uX)(),(0,o.CE)("div",vt,[t[7]||(t[7]=(0,o.Lk)("h4",null,"Всего за месяц",-1)),(0,o.Lk)("table",mt,[t[6]||(t[6]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th"),(0,o.Lk)("th"),(0,o.Lk)("th",null,"Кол-во"),(0,o.Lk)("th",null,"Площадь, м²"),(0,o.Lk)("th",null,"Н/час"),(0,o.Lk)("th",null,"Н/руб")])],-1)),(0,o.Lk)("tbody",null,[(0,o.Lk)("tr",kt,[t[5]||(t[5]=(0,o.Lk)("td",{colspan:"2"},[(0,o.Lk)("strong",null,"Итого:")],-1)),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,b.v_)(u.value.totalRounded.count),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,b.v_)(u.value.totalRounded.sqr),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,b.v_)(u.value.totalRounded.hours),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,b.v_)(u.value.totalRounded.money),1)])])])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",yt,[(0,o.Lk)("button",{onClick:t[0]||(t[0]=e=>c.value=!c.value),class:"btn-toggle"},(0,b.v_)(c.value?"Скрыть детали":"Показать детальную информацию"),1)]),(0,o.bF)(a.eB,{name:"slide"},{default:(0,o.k6)(()=>[c.value&&d.value.length>0?((0,o.uX)(),(0,o.CE)("div",Lt,[t[12]||(t[12]=(0,o.Lk)("h4",null,"Детализация по профилям",-1)),(0,o.Lk)("table",_t,[t[8]||(t[8]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Наименование"),(0,o.Lk)("th",null,"Профиль"),(0,o.Lk)("th",null,"Кол-во"),(0,o.Lk)("th",null,"Площадь, м²"),(0,o.Lk)("th",null,"Н/час"),(0,o.Lk)("th",null,"Н/руб")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(d.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:`${e.type_izd}_${e.profile}`},[(0,o.Lk)("td",null,(0,b.v_)(e.type_izd),1),(0,o.Lk)("td",null,(0,b.v_)(e.profile),1),(0,o.Lk)("td",null,(0,b.v_)(e.count),1),(0,o.Lk)("td",null,(0,b.v_)(e.sqr),1),(0,o.Lk)("td",null,(0,b.v_)(e.hours),1),(0,o.Lk)("td",null,(0,b.v_)(e.money),1)]))),128))])]),c.value&&p.value.length>0?((0,o.uX)(),(0,o.CE)("div",ht,[t[10]||(t[10]=(0,o.Lk)("h4",{style:{color:"#e53e3e"}},"⚠️ Изделия, не попавшие в отчёт",-1)),t[11]||(t[11]=(0,o.Lk)("p",{style:{"font-size":"12px",color:"#e53e3e","margin-bottom":"8px"}}," Эти изделия не соответствуют ни одному из правил группировки. Проверьте написание «Наименование» и «Профиль». ",-1)),(0,o.Lk)("table",bt,[t[9]||(t[9]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Заказ"),(0,o.Lk)("th",null,"Наименование"),(0,o.Lk)("th",null,"Профиль"),(0,o.Lk)("th",null,"Тип")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(p.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id},[(0,o.Lk)("td",null,(0,b.v_)(e.order_num),1),(0,o.Lk)("td",null,(0,b.v_)(e.type_izd),1),(0,o.Lk)("td",null,(0,b.v_)(e.profile),1),(0,o.Lk)("td",null,(0,b.v_)(v(e.type)),1)]))),128))])])])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)]),_:1})],64))}};const gt=(0,y.A)(ft,[["__scopeId","data-v-5533f081"]]);var Ct=gt;const wt={class:"peo-report"},Ft={class:"filters"},Et={class:"filter-group"},xt={class:"filter-group"},Xt=["value"],zt={class:"filter-group"},Vt={class:"type-filters"},Ut=["value"],It={class:"checkbox-text"},Kt={class:"table-container"},qt={class:"report-table"},Rt=["onClick"];var $t={__name:"FinalNormOrdersList",setup(e){const l=(new Date).getFullYear(),t=(0,f.KR)(l),n=(0,f.KR)((new Date).getMonth()+1),u=(0,f.KR)(""),r=(0,f.KR)(null),s=e=>{r.value={...e}},i=async e=>{try{const l={...e,sqr:parseFloat(e.sqr)||0,norm_money:parseFloat(e.norm_money)||0,coefficient:parseFloat(e.coefficient),total_time:parseFloat(e.total_time)||0,count:parseInt(e.count)||0};await g.A.put(`http://localhost:8080/api/final/update/${e.id}`,l);const t=h.value.findIndex(l=>l.id===e.id);-1!==t&&(h.value[t]=e),r.value=null,X()}catch(l){console.error("Ошибка сохранения",l)}},d=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],p={assigned:"Сотрудники назначены",final:"Готов"},c=e=>p[e]||e,v=(0,o.EW)(()=>`${t.value}-${String(n.value).padStart(2,"0")}-01`),m=(0,o.EW)(()=>{const e=new Date(t.value,n.value,0),l=String(e.getDate()).padStart(2,"0"),a=String(n.value).padStart(2,"0");return`${t.value}-${a}-${l}`}),k={combined:{label:"Окна и двери",types:["window","door","glyhar"]},loggia:{label:"Лоджии",types:["loggia"]},mosquito_net:{label:"Москитные сетки",types:["ms"]}},y=(0,f.KR)(["combined"]),L=(0,o.EW)(()=>{const e=[];return y.value.forEach(l=>{const t=k[l];t&&e.push(...t.types)}),e}),_=(0,f.KR)([]),h=(0,f.KR)([]),C=(0,o.EW)(()=>{const e=h.value||[],l=[...e].sort((e,l)=>{const t=e.ready_date?new Date(e.ready_date):new Date(0),a=l.ready_date?new Date(l.ready_date):new Date(0),o=a-t;return 0!==o?o:e.id-l.id}),t=new Map;let a=1;for(const o of l)"main"===o.part_type&&t.set(o.id,a++);return l.map(e=>{let l=0;return"main"===e.part_type?l=t.get(e.id)||0:"sub"===e.part_type&&e.parent_product_id&&(l=t.get(e.parent_product_id)||0),{...e,rowNumber:l}})}),w=(0,o.EW)(()=>{const e=L.value;return 0===e.length?[]:C.value.filter(l=>e.includes(l.type))}),F=e=>{const l={window:"Окно",door:"Дверь",loggia:"Лоджия",ms:"Москитная сетка",glyhar:"Глухое окно"};return l[e]||e},E=(e,l)=>{const t=e.employee_value?.[String(l)];return t?parseFloat(t.toFixed(3)):""},x=async()=>{const e=d[n.value-1],l=t.value,a=L.value;let o="Все типы";const u=new Set(["window","door","glyhar"]),r=new Set(a);o=a.length>4?"Все типы":r.size===u.size&&[...u].every(e=>r.has(e))?"Окна":1===r.size&&r.has("loggia")?"Лоджии":1===r.size&&r.has("ms")?"Москитки":[...new Set(a.map(F))].sort().join(", ");const s=new(Ol().Workbook),i=s.addWorksheet(`Отчёт ПЭО - ${e} ${l} ${o}`),p=["№","Спецификация","№ заказа","корп/дил","Заказчик","Вид продукции","Система","Наименование","Профиль","Количество","Площадь","Н/час","Изготовитель","Н/руб"],c=_.value.map(e=>e.name),v=[...p,...c,"Итого"],m=i.addRow(v);m.eachCell(e=>{e.font={bold:!0,size:10},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEEEEEE"}},e.border={style:"thin"}}),w.value.forEach(e=>{const l=[e.rowNumber,e.parent_assembly||"",e.order_num||"не определено",e.customer_type||"не определено",e.customer||"не определено",F(e.type),e.systema||"не определено",e.type_izd||"не определено",e.profile||"не определено",e.count||0,e.sqr||0,e.total_time||0,e.brigade||"не определено",e.norm_money||0],t=_.value.map(l=>{const t=E(e,l.id);return t?parseFloat(t):0}),a=t.reduce((e,l)=>e+l,0),o=a>0?parseFloat(a.toFixed(3)):"",n=_.value.map(l=>{const t=E(e,l.id);return t||""}),u=[...l,...n,o],r=i.addRow(u);a>0&&Math.abs(a-(parseFloat(e.total_time)||0))>.001&&r.eachCell((e,l)=>{l===u.length&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFF99"}})}),r.eachCell(e=>{e.font={size:10},e.alignment={vertical:"middle",horizontal:"center"},e.border={style:"thin"},"string"===typeof e.value&&"не определено"===e.value&&(e.font={bold:!0,size:10,color:{argb:"FFFF0000"}})})}),i.addRow([]);const k=w.value;function y(e){return(e||"").trim().toLowerCase()}function h(e){const l=e.reduce((e,l)=>(e.sqr+=parseFloat(l.sqr)||0,e.hours+=parseFloat(l.total_time)||0,e.money+=parseFloat(l.norm_money)||0,e.count+=parseInt(l.count)||0,e),{count:0,sqr:0,hours:0,money:0});return{count:parseFloat(l.count.toFixed(3)),sqr:parseFloat(l.sqr.toFixed(3)),hours:parseFloat(l.hours.toFixed(3)),money:parseFloat(l.money.toFixed(3))}}const b=k.filter(e=>("window"===e.type||"glyhar"===e.type)&&y(e.systema).includes("х")&&"витраж к двери"!==y(e.type_izd)),f=k.filter(e=>("window"===e.type||"glyhar"===e.type)&&y(e.systema).includes("т")&&"витраж к двери"!==y(e.type_izd)),g=k.filter(e=>"glyhar"===e.type&&"витраж к двери"===y(e.type_izd)),C=[...b,...f,...g],x=k.filter(e=>"door"===e.type&&("1П"===e.type_izd||"1Пт"===e.type_izd)),X=k.filter(e=>"door"===e.type&&("1.5П"===e.type_izd||"1.5Пт"===e.type_izd)),z=k.filter(e=>"door"===e.type&&("2П"===e.type_izd||"2Пт"===e.type_izd)),V=h(b),U=h(f),I=h(C),K=h(x),q=h(X),R=h(z),$=h(g),S=[I,K,q,R].reduce((e,l)=>({count:e.count+l.count,sqr:e.sqr+l.sqr,hours:e.hours+l.hours,money:e.money+l.money}),{count:0,sqr:0,hours:0,money:0}),W={count:parseFloat(S.count.toFixed(3)),sqr:parseFloat(S.sqr.toFixed(3)),hours:parseFloat(S.hours.toFixed(3)),money:parseFloat(S.money.toFixed(3))},J=i.addRow(["Сводная статистика"]);J.getCell(1).font={bold:!0,size:14},i.addRow([]);const N=["","","Кол-во","Площадь, м²","Н/час","Н/руб"],O=i.addRow(N);O.eachCell(e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFDDDDDD"}},e.border={style:"thin"}});const T=(e,l,t)=>{const a=i.addRow([e,"",t.count,t.sqr,t.hours,t.money]);a.eachCell(e=>{e.border={style:"thin"},0===t.count&&0===t.sqr&&0===t.hours&&0===t.money&&(e.font={italic:!0,color:{argb:"FF888888"}})})};T("Холодные окна","",V),T("Теплые окна","",U),T("Витраж к двери","",$),T("Всего окон","",I),T("Всего 1П дверей","",K),T("Всего 1.5П дверей","",q),T("Всего 2П дверей","",R),i.addRow([]);const A=i.addRow(["","ИТОГО:",W.count,W.sqr,W.hours,W.money]);A.eachCell((e,l)=>{l>=3&&(e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCFFFF"}})}),i.addRow([]),i.addRow([]);const D=[{type_izd:"окно гл.",profile:"ах"},{type_izd:"окно гл.",profile:"ат"},{type_izd:"окно гл.",profile:"ш"},{type_izd:"окно гл.",profile:"сх"},{type_izd:"окно гл.",profile:"ст"},{type_izd:"окно пов.-отк.",profile:"ах"},{type_izd:"окно пов.-отк.",profile:"ат"},{type_izd:"окно пов.-отк.",profile:"ст"},{type_izd:"окно пов.-отк.",profile:"сх"},{type_izd:"окно пов.-отк.",profile:"ш"},{type_izd:"1П",profile:"ах"},{type_izd:"1П",profile:"сх"},{type_izd:"1Пт",profile:"ат"},{type_izd:"1Пт",profile:"ст"},{type_izd:"1Пт",profile:"ш"},{type_izd:"1.5П",profile:"ах"},{type_izd:"1.5П",profile:"сх"},{type_izd:"1.5Пт",profile:"ат"},{type_izd:"1.5Пт",profile:"ст"},{type_izd:"1.5Пт",profile:"ш"},{type_izd:"2П",profile:"ах"},{type_izd:"2П",profile:"сх"},{type_izd:"2Пт",profile:"ат"},{type_izd:"2Пт",profile:"ст"},{type_izd:"2Пт",profile:"ш"}],j=i.addRow(["Детализация по профилям"]);j.getCell(1).font={bold:!0,size:14},i.addRow([]);const P=["Наименование","Профиль","Кол-во","Площадь","н/час","н/руб"],Q=i.addRow(P);Q.eachCell(e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFDDDDDD"}},e.border={style:"thin"}});const M={};D.forEach(e=>{const l=`${e.type_izd}__${e.profile}`;M[l]={count:0,sqr:0,hours:0,money:0}}),k.forEach(e=>{const l=`${e.type_izd}__${e.profile}`;if(!M[l])return;const t=M[l];t.count+=parseInt(e.count)||0,t.sqr+=parseFloat(e.sqr)||0,t.hours+=parseFloat(e.total_time)||0,t.money+=parseFloat(e.norm_money)||0}),D.forEach(e=>{const l=`${e.type_izd}__${e.profile}`,t=M[l]||{count:0,sqr:0,hours:0,money:0},a=i.addRow([e.type_izd,e.profile,t.count,parseFloat(t.sqr.toFixed(3)),parseFloat(t.hours.toFixed(3)),parseFloat(t.money.toFixed(3))]);a.eachCell(e=>{e.border={style:"thin"},0===t.count&&0===t.sqr&&0===t.hours&&0===t.money&&(e.font={italic:!0,color:{argb:"FF888888"}})})}),i.columns.forEach(e=>{let l=10;e.eachCell({includeEmpty:!0},e=>{const t=e.value?String(e.value).length:10;t>l&&(l=t)}),e.width=Math.min(l+2,30)});const H=await s.xlsx.writeBuffer(),B=new Blob([H],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=URL.createObjectURL(B),Y=document.createElement("a");Y.href=G,Y.download=`peo-report-${l}-${String(n.value).padStart(2,"0")}.xlsx`,Y.click(),URL.revokeObjectURL(G)},X=async()=>{try{const e=new URLSearchParams;L.value.forEach(l=>{e.append("type",l)}),e.append("from",v.value),e.append("to",m.value),e.append("order_num",u.value);const l=await g.A.get(`http://localhost:8080/api/all_final_order?${e}`);_.value=l.data.employees,h.value=l.data.products,console.log("RESSS",l)}catch(e){console.error("Ошибка загрузки данных:",e)}};return(0,o.sV)(()=>{X()}),(e,l)=>((0,o.uX)(),(0,o.CE)("div",wt,[(0,o.Lk)("div",Ft,[(0,o.Lk)("div",Et,[l[5]||(l[5]=(0,o.Lk)("label",{for:"year-select"},"Год",-1)),(0,o.bo)((0,o.Lk)("select",{id:"year-select","onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),onChange:X,class:"filter-select"},[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)([2023,2024,2025,2026,2027],e=>(0,o.Lk)("option",{key:e},(0,b.v_)(e),1)),64))],544),[[a.u1,t.value]])]),(0,o.Lk)("div",xt,[l[6]||(l[6]=(0,o.Lk)("label",{for:"month-select"},"Месяц",-1)),(0,o.bo)((0,o.Lk)("select",{id:"month-select","onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),onChange:X,class:"filter-select"},[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(d,(e,l)=>(0,o.Lk)("option",{key:l+1,value:l+1},(0,b.v_)(e),9,Xt)),64))],544),[[a.u1,n.value]])]),(0,o.Lk)("div",zt,[l[7]||(l[7]=(0,o.Lk)("label",{for:"order-input"},"№ заказа",-1)),(0,o.bo)((0,o.Lk)("input",{id:"order-input",type:"text","onUpdate:modelValue":l[2]||(l[2]=e=>u.value=e),placeholder:"Q6-123",onInput:X,class:"filter-input"},null,544),[[a.Jo,u.value]])]),(0,o.Lk)("div",Vt,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(k,(e,t)=>(0,o.Lk)("label",{key:t,class:"checkbox-label"},[(0,o.bo)((0,o.Lk)("input",{type:"checkbox",value:t,"onUpdate:modelValue":l[3]||(l[3]=e=>y.value=e),onChange:X,class:"checkbox-input"},null,40,Ut),[[a.lH,y.value]]),(0,o.Lk)("span",It,(0,b.v_)(e.label),1)])),64))])]),(0,o.bF)(Ct,{products:w.value},null,8,["products"]),r.value?((0,o.uX)(),(0,o.Wv)(nt,{key:0,product:r.value,employees:_.value,onClose:i,onCancel:l[4]||(l[4]=e=>r.value=null)},null,8,["product","employees"])):(0,o.Q3)("",!0),(0,o.Lk)("div",Kt,[(0,o.Lk)("table",qt,[(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[l[8]||(l[8]=(0,o.Lk)("th",null,"Статус",-1)),l[9]||(l[9]=(0,o.Lk)("th",null,"Позиция",-1)),l[10]||(l[10]=(0,o.Lk)("th",null,"№",-1)),l[11]||(l[11]=(0,o.Lk)("th",null,"Спецификация",-1)),l[12]||(l[12]=(0,o.Lk)("th",null,"№ заказа",-1)),l[13]||(l[13]=(0,o.Lk)("th",null,"корп/дил",-1)),l[14]||(l[14]=(0,o.Lk)("th",null,"Заказчик",-1)),l[15]||(l[15]=(0,o.Lk)("th",null,"Вид продукции",-1)),l[16]||(l[16]=(0,o.Lk)("th",null,"Система",-1)),l[17]||(l[17]=(0,o.Lk)("th",null,"Наименование",-1)),l[18]||(l[18]=(0,o.Lk)("th",null,"Профиль",-1)),l[19]||(l[19]=(0,o.Lk)("th",null,"Кол-во",-1)),l[20]||(l[20]=(0,o.Lk)("th",null,"Площадь",-1)),l[21]||(l[21]=(0,o.Lk)("th",null,"Н/час",-1)),l[22]||(l[22]=(0,o.Lk)("th",null,"Изготовитель",-1)),l[23]||(l[23]=(0,o.Lk)("th",null,"Н/руб",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(_.value,e=>((0,o.uX)(),(0,o.CE)("th",{key:e.id,class:"employee-col"},(0,b.v_)(e.name),1))),128))])]),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(w.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id,onClick:()=>s(e),class:"clickable-row"},[(0,o.Lk)("td",null,[(0,o.Lk)("span",{class:(0,b.C4)(`status-badge status-${e.status}`)},(0,b.v_)(c(e.status)),3)]),(0,o.Lk)("td",null,(0,b.v_)(e.position),1),(0,o.Lk)("td",null,(0,b.v_)(e.rowNumber),1),(0,o.Lk)("td",null,(0,b.v_)(e.parent_assembly),1),(0,o.Lk)("td",null,(0,b.v_)(e.order_num),1),(0,o.Lk)("td",{class:(0,b.C4)({"profile-empty":""===e.customer_type,"cell-warning":""===e.customer_type})},(0,b.v_)(e.customer_type),3),(0,o.Lk)("td",null,(0,b.v_)(e.customer),1),(0,o.Lk)("td",null,(0,b.v_)(F(e.type)),1),(0,o.Lk)("td",{class:(0,b.C4)({"profile-empty":""===e.systema,"cell-warning":""===e.systema})},(0,b.v_)(e.systema),3),(0,o.Lk)("td",{class:(0,b.C4)({"profile-empty":""===e.type_izd,"cell-warning":""===e.type_izd})},(0,b.v_)(e.type_izd),3),(0,o.Lk)("td",{class:(0,b.C4)({"profile-empty":""===e.profile,"cell-warning":""===e.profile})},(0,b.v_)(e.profile),3),(0,o.Lk)("td",null,(0,b.v_)(e.count),1),(0,o.Lk)("td",null,(0,b.v_)(e.sqr),1),(0,o.Lk)("td",null,(0,b.v_)(e.total_time),1),(0,o.Lk)("td",{class:(0,b.C4)({"profile-empty":""===e.brigade,"cell-warning":""===e.brigade})},(0,b.v_)(e.brigade),3),(0,o.Lk)("td",null,(0,b.v_)(e.norm_money),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(_.value,l=>((0,o.uX)(),(0,o.CE)("td",{key:l.id,class:"employee-col"},(0,b.v_)(E(e,l.id)),1))),128))],8,Rt))),128))])])]),(0,o.Lk)("div",{class:"actions"},[(0,o.Lk)("button",{onClick:x,class:"btn-export"}," Экспорт в Excel ")])]))}};const St=(0,y.A)($t,[["__scopeId","data-v-3c2adb15"]]);var Wt=St;const Jt={class:"admin-panel"},Nt={class:"admin-nav"};var Ot={__name:"AdminPanel",setup(e){return(e,l)=>{const t=(0,o.g2)("router-link"),a=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",Jt,[l[3]||(l[3]=(0,o.Lk)("h1",null,"Админка сервиса нормирования",-1)),(0,o.Lk)("nav",Nt,[(0,o.bF)(t,{to:"/admin/templates"},{default:(0,o.k6)(()=>l[0]||(l[0]=[(0,o.eW)("Шаблоны")])),_:1,__:[0]}),l[2]||(l[2]=(0,o.eW)(" | ")),(0,o.bF)(t,{to:"/admin/peo"},{default:(0,o.k6)(()=>l[1]||(l[1]=[(0,o.eW)("ПЭО")])),_:1,__:[1]})]),(0,o.bF)(a)])}}};const Tt=(0,y.A)(Ot,[["__scopeId","data-v-88b56988"]]);var At=Tt;const Dt={class:"admin-templates"},jt={key:0},Pt={key:1,class:"error"},Qt={key:2,class:"templates-table"},Mt={key:3};var Ht={__name:"AdminTemplates",setup(e){const l=(0,f.KR)({}),t=(0,f.KR)(!1),a=(0,f.KR)(null),n=(0,h.rd)();async function u(){t.value=!0,a.value=null;try{const e=await fetch("http://localhost:8080/api/admin/all_templates");if(!e.ok)throw new Error(`HTTP ${e.status}`);console.log("res",e),l.value=await e.json(),console.log(l.value)}catch(e){console.error("Ошибка загрузки шаблонов:",e),a.value=e.message}finally{t.value=!1}}function r(){console.log("Создать новый шаблон"),n.push("/admin/templates/new")}return(0,o.sV)(()=>{u()}),(e,n)=>{const u=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",Dt,[n[2]||(n[2]=(0,o.Lk)("h2",null,"Шаблоны изделий",-1)),(0,o.Lk)("button",{onClick:r,class:"btn btn-primary"},"Создать шаблон"),t.value?((0,o.uX)(),(0,o.CE)("div",jt,"Загрузка...")):a.value?((0,o.uX)(),(0,o.CE)("div",Pt,"Ошибка: "+(0,b.v_)(a.value),1)):(0,o.Q3)("",!0),l.value.Template&&l.value.Template.length?((0,o.uX)(),(0,o.CE)("table",Qt,[n[1]||(n[1]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Код"),(0,o.Lk)("th",null,"Категория"),(0,o.Lk)("th",null,"Название"),(0,o.Lk)("th",null,"Действия")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.value.Template,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id},[(0,o.Lk)("td",null,(0,b.v_)(e.code),1),(0,o.Lk)("td",null,(0,b.v_)(e.category),1),(0,o.Lk)("td",null,(0,b.v_)(e.name),1),(0,o.Lk)("td",null,[(0,o.bF)(u,{to:`/admin/templates/edit/${e.code}`},{default:(0,o.k6)(()=>n[0]||(n[0]=[(0,o.eW)("Редактировать")])),_:2,__:[0]},1032,["to"])])]))),128))])])):t.value||l.value.Template&&0!==l.value.Template.length?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",Mt," Шаблоны не найдены "))])}}};const Bt=(0,y.A)(Ht,[["__scopeId","data-v-7a18f65f"]]);var Gt=Bt;const Yt={class:"template-edit"},Zt={key:0},ea=["onUpdate:modelValue"],la=["onUpdate:modelValue"],ta={class:"template-edit"},aa={key:0},oa=["onUpdate:modelValue"],na=["onUpdate:modelValue"],ua={class:"template-edit"},ra={key:0};var sa={__name:"AdminEditDataPeo",setup(e){const l=(0,f.KR)(!1),t=(0,f.KR)([]),n=(0,f.KR)([]),u=(0,f.KR)({name:"",is_active:!1});async function r(){const e=await fetch("http://localhost:8080/api/admin/coefficient");if(!e.ok)throw new Error("Ошибка коэффициентов");return await e.json()}async function s(){const e=await fetch("http://localhost:8080/api/admin/employees");if(!e.ok)throw new Error("Ошибка сотрудников");return await e.json()}async function i(){try{const e=await fetch("http://localhost:8080/api/admin/coefficient/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.value)});if(!e.ok)throw new Error(`HTTP ${e.status}`)}catch(e){console.log("Коэффициенты не обновлены",e)}}async function d(){try{const e=await fetch("http://localhost:8080/api/admin/employees/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)});if(!e.ok)throw new Error(`HTTP ${e.status}`)}catch(e){console.log("Коэффициенты не обновлены",e)}}async function p(){try{const e=await fetch("http://localhost:8080/api/admin/employees/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)});if(!e.ok)throw new Error(`HTTP ${e.status}`)}catch(e){console.log("Новый сотрудник не сохранен",e)}}return(0,o.sV)(async()=>{l.value=!0;try{const[e,l]=await Promise.all([r(),s()]);t.value=e,n.value=l}catch(e){console.log("Ошибка получения данных",e)}finally{l.value=!1}}),(e,r)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",Yt,[r[4]||(r[4]=(0,o.Lk)("h2",null,"Редактирование коэффициентов ПЭО",-1)),l.value?((0,o.uX)(),(0,o.CE)("div",Zt,"Загрузка...")):((0,o.uX)(),(0,o.CE)("form",{key:1,onSubmit:(0,a.D$)(i,["prevent"]),class:"operations-table"},[r[2]||(r[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Тип изделия"),(0,o.Lk)("th",null,"Коэффициент"),(0,o.Lk)("th",null,"Использовать")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id},[(0,o.Lk)("td",null,(0,b.v_)(e.type),1),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{min:"0",step:"0.001","onUpdate:modelValue":l=>e.coefficient=l},null,8,ea),[[a.Jo,e.coefficient,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":l=>e.is_active=l},null,8,la),[[a.lH,e.is_active]])])]))),128))]),r[3]||(r[3]=(0,o.Lk)("div",null,[(0,o.Lk)("button",{type:"submit"},"Сохранить")],-1))],32))]),(0,o.Lk)("div",ta,[r[7]||(r[7]=(0,o.Lk)("h2",null,"Редактирование сотрудников ПЭО",-1)),l.value?((0,o.uX)(),(0,o.CE)("div",aa,"Загрузка...")):((0,o.uX)(),(0,o.CE)("form",{key:1,onSubmit:(0,a.D$)(d,["prevent"]),class:"operations-table"},[r[5]||(r[5]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"ID"),(0,o.Lk)("th",null,"Имя"),(0,o.Lk)("th",null,"Работает или нет")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.value,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id},[(0,o.Lk)("td",null,(0,b.v_)(e.id),1),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.name=l},null,8,oa),[[a.Jo,e.name]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":l=>e.is_active=l},null,8,na),[[a.lH,e.is_active]])])]))),128))]),r[6]||(r[6]=(0,o.Lk)("div",null,[(0,o.Lk)("button",{type:"submit"},"Сохранить")],-1))],32))]),(0,o.Lk)("div",ua,[r[10]||(r[10]=(0,o.Lk)("h2",null,"Добавить сотрудника",-1)),l.value?((0,o.uX)(),(0,o.CE)("div",ra,"Загрузка...")):((0,o.uX)(),(0,o.CE)("form",{key:1,onSubmit:(0,a.D$)(p,["prevent"]),class:"operations-table"},[r[8]||(r[8]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Имя"),(0,o.Lk)("th",null,"Работает или нет")])],-1)),(0,o.Lk)("tbody",null,[(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>u.value.name=e)},null,512),[[a.Jo,u.value.name]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=e=>u.value.is_active=e)},null,512),[[a.lH,u.value.is_active]])])]),r[9]||(r[9]=(0,o.Lk)("div",null,[(0,o.Lk)("button",{type:"submit"},"Сохранить")],-1))],32))])],64))}};const ia=sa;var da=ia;const pa={class:"template-edit"},ca={key:0},va={class:"form-checkbox"},ma={class:"operations-table"},ka=["onUpdate:modelValue"],ya=["onUpdate:modelValue"],La=["onUpdate:modelValue"],_a=["onUpdate:modelValue"],ha=["onUpdate:modelValue"],ba=["onUpdate:modelValue"],fa=["onClick"],ga={class:"form-actions"};var Ca={__name:"AdminTemplateEdit",setup(e){const l=(0,h.lq)(),t=(0,h.rd)(),n=(0,f.KR)({code:"",name:"",category:"",systema:"",type_izd:"",profile:"",is_active:1,operations:[],rules:null}),u=(0,f.KR)(!1);async function r(e){u.value=!0;try{const l=await fetch(`http://localhost:8080/api/admin/template?code=${e}`);if(!l.ok)throw new Error(`HTTP ${l.status}`);n.value=await l.json()}catch(l){console.error("Ошибка загрузки шаблона:",l),alert("Не удалось загрузить шаблон"),t.push("/admin/templates")}finally{u.value=!1}}function s(){n.value.operations.push({label:"",name:"",count:0,value:0,minutes:0,group:"",type:"number",required:!0})}function i(e){n.value.operations.splice(e,1)}async function d(){try{const e={...n.value,operations:n.value.operations};console.log("PAYYY",e);const a=await fetch(`http://localhost:8080/api/admin/template/update/${l.params.code}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error(`HTTP ${a.status}`);alert("Шаблон сохранён"),t.push("/admin/templates")}catch(e){console.error("Ошибка сохранения:",e),alert("Не удалось сохранить шаблон")}}return(0,o.sV)(()=>{const e=l.params.code;e?r(e):s()}),(e,l)=>{const t=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",pa,[l[17]||(l[17]=(0,o.Lk)("h2",null,"Редактирование шаблона",-1)),u.value?((0,o.uX)(),(0,o.CE)("div",ca,"Загрузка...")):((0,o.uX)(),(0,o.CE)("form",{key:1,onSubmit:(0,a.D$)(d,["prevent"])},[(0,o.Lk)("div",null,[l[6]||(l[6]=(0,o.Lk)("label",null,"Название для шаблона:",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>n.value.name=e),required:""},null,512),[[a.Jo,n.value.name]])]),(0,o.Lk)("div",va,[l[7]||(l[7]=(0,o.Lk)("label",{for:"is_active"},"Использовать шаблон",-1)),(0,o.bo)((0,o.Lk)("input",{type:"checkbox",id:"is_active","onUpdate:modelValue":l[1]||(l[1]=e=>n.value.is_active=e)},null,512),[[a.lH,n.value.is_active]])]),(0,o.Lk)("div",null,[l[9]||(l[9]=(0,o.Lk)("label",null,"Категория:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.category=e)},l[8]||(l[8]=[(0,o.Lk)("option",{value:"window"},"Окно",-1),(0,o.Lk)("option",{value:"door"},"Дверь",-1),(0,o.Lk)("option",{value:"glyhar"},"Гляхарь",-1)]),512),[[a.u1,n.value.category]])]),(0,o.Lk)("div",null,[l[10]||(l[10]=(0,o.Lk)("label",null,"Система(т-теплая,х-холодная, писать т или х):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>n.value.systema=e)},null,512),[[a.Jo,n.value.systema]])]),(0,o.Lk)("div",null,[l[11]||(l[11]=(0,o.Lk)("label",null,"Тип изделия(окно гл., окно пов.-отк., 1П, 1.5П,2П,1Пт,1.5Пт,2Пт):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>n.value.type_izd=e)},null,512),[[a.Jo,n.value.type_izd]])]),(0,o.Lk)("div",null,[l[12]||(l[12]=(0,o.Lk)("label",null,"Профиль(сх,ст,ах,ат,ш):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.profile=e)},null,512),[[a.Jo,n.value.profile]])]),l[16]||(l[16]=(0,o.Lk)("h3",null,"Операции",-1)),(0,o.Lk)("table",ma,[l[13]||(l[13]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",{class:"col-label"},"Название"),(0,o.Lk)("th",null,"Название транскрипт"),(0,o.Lk)("th",null,"Количество"),(0,o.Lk)("th",null,"Значения(н/ч)"),(0,o.Lk)("th",null,"Значения(н/м)"),(0,o.Lk)("th",null,"Группа"),(0,o.Lk)("th")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.value.operations,(e,l)=>((0,o.uX)(),(0,o.CE)("tr",{key:l},[(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.label=l},null,8,ka),[[a.Jo,e.label]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.name=l},null,8,ya),[[a.Jo,e.name]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"number",step:"1",min:"0","onUpdate:modelValue":l=>e.count=l},null,8,La),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.value=l},null,8,_a),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.minutes=l},null,8,ha),[[a.Jo,e.minutes,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.group=l},null,8,ba),[[a.Jo,e.group]])]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{type:"button",onClick:e=>i(l)},"Удалить",8,fa)])]))),128))])]),(0,o.Lk)("button",{type:"button",onClick:s,class:"btn"},"+ Добавить операцию"),(0,o.Lk)("div",ga,[l[15]||(l[15]=(0,o.Lk)("button",{type:"submit"},"Сохранить",-1)),(0,o.bF)(t,{to:"/admin/templates",class:"btn btn-outline"},{default:(0,o.k6)(()=>l[14]||(l[14]=[(0,o.eW)("Отмена")])),_:1,__:[14]})])],32))])}}};const wa=(0,y.A)(Ca,[["__scopeId","data-v-8771a654"]]);var Fa=wa;const Ea={class:"template-edit"},xa={key:0},Xa={class:"form-checkbox"},za={class:"operations-table"},Va=["onUpdate:modelValue"],Ua=["onUpdate:modelValue"],Ia=["onUpdate:modelValue"],Ka=["onUpdate:modelValue"],qa=["onUpdate:modelValue"],Ra=["onUpdate:modelValue"],$a=["onClick"],Sa={class:"form-actions"};var Wa={__name:"AdminTemplateCreate",setup(e){const l=(0,h.rd)(),t=(0,f.KR)({code:"",name:"",category:"",systema:"",type_izd:"",profile:"",is_active:1,operations:[],rules:null,head_name:""}),n=(0,f.KR)(!1);function u(){t.value.operations.push({label:"",name:"",count:0,value:0,minutes:0,group:"",type:"number",required:!1})}function r(e){t.value.operations.splice(e,1)}async function s(){try{const e={...t.value,operations:t.value.operations};console.log("PAYYY",e);const a=await fetch("http://localhost:8080/api/admin/template/new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error(`HTTP ${a.status}`);alert("Шаблон сохранён"),l.push("/admin/templates")}catch(e){console.error("Ошибка сохранения:",e),alert("Не удалось сохранить шаблон")}}return(0,o.sV)(()=>{u()}),(e,l)=>{const i=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",Ea,[l[21]||(l[21]=(0,o.Lk)("h2",null,"Создание нового шаблона",-1)),n.value?((0,o.uX)(),(0,o.CE)("div",xa,"Загрузка...")):((0,o.uX)(),(0,o.CE)("form",{key:1,onSubmit:(0,a.D$)(s,["prevent"])},[(0,o.Lk)("div",null,[l[8]||(l[8]=(0,o.Lk)("label",null,"Код шаблона",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.code=e),required:""},null,512),[[a.Jo,t.value.code]])]),(0,o.Lk)("div",null,[l[9]||(l[9]=(0,o.Lk)("label",null,"Название для шаблона:",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.name=e),required:""},null,512),[[a.Jo,t.value.name]])]),(0,o.Lk)("div",Xa,[l[10]||(l[10]=(0,o.Lk)("label",{for:"is_active"},"Использовать шаблон",-1)),(0,o.bo)((0,o.Lk)("input",{type:"checkbox",id:"is_active","onUpdate:modelValue":l[2]||(l[2]=e=>t.value.is_active=e)},null,512),[[a.lH,t.value.is_active]])]),(0,o.Lk)("div",null,[l[12]||(l[12]=(0,o.Lk)("label",null,"Категория:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.category=e)},l[11]||(l[11]=[(0,o.Lk)("option",{value:"window"},"Окно",-1),(0,o.Lk)("option",{value:"door"},"Дверь",-1),(0,o.Lk)("option",{value:"glyhar"},"Гляхарь",-1)]),512),[[a.u1,t.value.category]])]),(0,o.Lk)("div",null,[l[13]||(l[13]=(0,o.Lk)("label",null,"Система(т-теплая,х-холодная, писать т или х):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.systema=e)},null,512),[[a.Jo,t.value.systema]])]),(0,o.Lk)("div",null,[l[14]||(l[14]=(0,o.Lk)("label",null,"Тип изделия(окно гл., окно пов.-отк., 1П, 1.5П,2П,1Пт,1.5Пт,2Пт):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.type_izd=e)},null,512),[[a.Jo,t.value.type_izd]])]),(0,o.Lk)("div",null,[l[15]||(l[15]=(0,o.Lk)("label",null,"Профиль(сх,ст,ах,ат,ш):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.profile=e)},null,512),[[a.Jo,t.value.profile]])]),(0,o.Lk)("div",null,[l[16]||(l[16]=(0,o.Lk)("label",null,"Заголовок для страницы печати(изготовление П-образ системы Алютех):",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l[7]||(l[7]=e=>t.value.head_name=e)},null,512),[[a.Jo,t.value.head_name]])]),l[20]||(l[20]=(0,o.Lk)("h3",null,"Операции",-1)),(0,o.Lk)("table",za,[l[17]||(l[17]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",{class:"col-label"},"Название"),(0,o.Lk)("th",null,"Название транскрипт"),(0,o.Lk)("th",null,"Количество"),(0,o.Lk)("th",null,"Значения(н/ч)"),(0,o.Lk)("th",null,"Значения(н/м)"),(0,o.Lk)("th",null,"Группа"),(0,o.Lk)("th")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.value.operations,(e,l)=>((0,o.uX)(),(0,o.CE)("tr",{key:l},[(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.label=l},null,8,Va),[[a.Jo,e.label]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.name=l},null,8,Ua),[[a.Jo,e.name]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"number",step:"1",min:"0","onUpdate:modelValue":l=>e.count=l},null,8,Ia),[[a.Jo,e.count,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.value=l},null,8,Ka),[[a.Jo,e.value,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{type:"number",step:"0.001",min:"0","onUpdate:modelValue":l=>e.minutes=l},null,8,qa),[[a.Jo,e.minutes,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":l=>e.group=l},null,8,Ra),[[a.Jo,e.group]])]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{type:"button",onClick:e=>r(l)},"Удалить",8,$a)])]))),128))])]),(0,o.Lk)("button",{type:"button",onClick:u,class:"btn"},"+ Добавить операцию"),(0,o.Lk)("div",Sa,[l[19]||(l[19]=(0,o.Lk)("button",{type:"submit"},"Сохранить",-1)),(0,o.bF)(i,{to:"/admin/templates",class:"btn btn-outline"},{default:(0,o.k6)(()=>l[18]||(l[18]=[(0,o.eW)("Отмена")])),_:1,__:[18]})])],32))])}}};const Ja=(0,y.A)(Wa,[["__scopeId","data-v-402cc431"]]);var Na=Ja;const Oa=[{path:"/orders/order-norm/:id",name:"OrdersDetails",component:_e,props:!0},{path:"/orders/order-norm/form/:id",name:"FormPagePeo",component:re},{path:"/norm/order-norm/print/:id",name:"FormPrintNorm",component:Ne},{path:"/orders",component:I},{path:"/norm/orders",name:"NormOrdersList",component:ll},{path:"/norm/orders/order-norm/edit/:id",name:"EditNormOrder",component:hl},{path:"/norm/workers/:id",name:"AssignWorkers",component:Jl},{path:"/final/orders",name:"FinalNormOrdersList",component:Wt},{path:"/admin",component:At,children:[{path:"",redirect:"admin/templates"},{path:"templates",component:Gt},{path:"peo",component:da}]},{path:"/admin/templates/edit/:code",name:"AdminTemplateEdit",component:Fa},{path:"/admin/templates/new",name:"AdminTemplateCreate",component:Na}],Ta=(0,h.aE)({history:(0,h.LA)(),routes:Oa});var Aa=Ta;const Da=(0,a.Ef)(_);Da.use(Aa),Da.mount("#app")}},l={};function t(a){var o=l[a];if(void 0!==o)return o.exports;var n=l[a]={exports:{}};return e[a].call(n.exports,n,n.exports,t),n.exports}t.m=e,function(){var e=[];t.O=function(l,a,o,n){if(!a){var u=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],n=e[d][2];for(var r=!0,s=0;s<a.length;s++)(!1&n||u>=n)&&Object.keys(t.O).every(function(e){return t.O[e](a[s])})?a.splice(s--,1):(r=!1,n<u&&(u=n));if(r){e.splice(d--,1);var i=o();void 0!==i&&(l=i)}}return l}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,o,n]}}(),function(){t.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(l,{a:l}),l}}(),function(){t.d=function(e,l){for(var a in l)t.o(l,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:l[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){var e={524:0};t.O.j=function(l){return 0===e[l]};var l=function(l,a){var o,n,u=a[0],r=a[1],s=a[2],i=0;if(u.some(function(l){return 0!==e[l]})){for(o in r)t.o(r,o)&&(t.m[o]=r[o]);if(s)var d=s(t)}for(l&&l(a);i<u.length;i++)n=u[i],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(d)},a=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];a.forEach(l.bind(null,0)),a.push=l.bind(null,a.push.bind(a))}();var a=t.O(void 0,[504],function(){return t(3084)});a=t.O(a)})();
//# sourceMappingURL=app.443f27ce.js.map